<!DOCTYPE html><html lang='en'><head><title>[diff.cpp.defaultconstruct]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:73pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>C.1</a> C++ and Ranges <a class='abbr_ref' href='diff.cpp#defaultconstruct'>[diff.cpp]</a></h2><div id='diff.cpp.defaultconstruct'><h3 ><a class='secnum' style='min-width:103pt'>C.1.4</a> Iterators and Default-Constructibility <a class='abbr_ref'>[diff.cpp.defaultconstruct]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >In today's STL, iterators need not be default-constructible. The <span class='texttt'>Iterator</span> concept described
in this document requires default-constructibility. This could potentially cause breakage in users'
code. Also, it makes the implementation of some types of iterators more complicated. Any iterator
that has members that are not default constructible (e.g., an iterator that contains a lambda that
has captured by reference) must take special steps to provide default-constructibility (e.g.,
by wrapping non-default-constructible types in something like <span class='texttt'>std::optional</span>, as specified
in the C++17 Working Draft N4618 &sect;20.6). This can weaken class invariants.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >The guarantee of default-constructibility simplifies the implementation of much iterator- and
range-based code that would otherwise need to wrap iterators in <span class='texttt'>std::optional</span>. But the
needs of backward-compatibliity, the extra complexity to iterator implementors, and the weakened
invariants may prove to be too great a burden.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><p >We may in fact go even farther and remove the requirement of default-constructibility from the
<span class='texttt'>Semiregular</span> concept. Time and experience will give us guidance here.</p></div></div></div></body></html>