<!DOCTYPE html><html lang='en'><head><title>[futures.promise]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>33</a> Thread support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>33.6</a> Futures <a class='abbr_ref' href='futures#promise'>[futures]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>33.6.6</a> Class template <span class='texttt'>promise</span> <a class='abbr_ref'>[futures.promise]</a></h3><span class='indexparent'><a class='index' id='lib:promise'></a></span><pre class='codeblock'>
namespace std {
  template&lt;class R&gt;
  class promise {
  public:
    promise();
    template&lt;class Allocator&gt;
      promise(allocator_arg_t, const Allocator&amp; a);
    promise(promise&amp;&amp; rhs) noexcept;
    promise(const promise&amp; rhs) = delete;
    ~promise();

    <span class='comment'>// assignment
</span>    promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
    promise&amp; operator=(const promise&amp; rhs) = delete;
    void swap(promise&amp; other) noexcept;

    <span class='comment'>// retrieving the result
</span>    future&lt;R&gt; get_future();

    <span class='comment'>// setting the result
</span>    void set_value(<span class='textit'><span class='texttt'>see below</span></span>);
    void set_exception(exception_ptr p);

    <span class='comment'>// setting the result with deferred notification
</span>    void set_value_at_thread_exit(<span class='textit'><span class='texttt'>see below</span></span>);
    void set_exception_at_thread_exit(exception_ptr p);
  };

  template&lt;class R&gt;
    void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;

  template&lt;class R, class Alloc&gt;
    struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;;
}</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3918'>#</a></div><div id='1.sentence-1' class='sentence'>The implementation shall provide the template <span class='texttt'>promise</span> and two specializations,
<span class='texttt'>promise&lt;R&amp;&gt;</span> and <span class='texttt'>promise&lt;&#x200b;void&gt;</span><a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>These differ only in the argument type
of the member functions <span class='texttt'>set_&shy;value</span> and <span class='texttt'>set_&shy;value_&shy;at_&shy;thread_&shy;exit</span>,
as set out in their descriptions, below<a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3924'>#</a></div><div id='2.sentence-1' class='sentence'>The <span class='texttt'>set_&shy;value</span>, <span class='texttt'>set_&shy;exception</span>, <span class='texttt'>set_&shy;value_&shy;at_&shy;thread_&shy;exit</span>,
and <span class='texttt'>set_&shy;exception_&shy;at_&shy;thread_&shy;exit</span> member functions behave as though
they acquire a single mutex associated with the promise object while updating the
promise object<a class='hidden_link' href='#2.sentence-1'>.</a></div> <span class='indexparent'><a class='index' id='lib:uses_allocator,promise'></a></span></div><div class='itemdecl' id='itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'>template&lt;class R, class Alloc&gt;
  struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;
    : true_type { };
</code></div><div class='itemdescr'></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3938'>#</a></div><div id='3.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>Alloc</span> shall be an <a href='allocator.requirements'>Allocator</a><a class='hidden_link' href='#3.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,constructor'></a></span><div class='itemdecl' id='itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'>promise();
template&lt;class Allocator&gt;
  promise(allocator_arg_t, const Allocator&amp; a);
</code></div><div class='itemdescr'></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3951'>#</a></div><div id='4.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a <span class='texttt'>promise</span> object and a shared state<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>The second
constructor uses the allocator <span class='texttt'>a</span> to allocate memory for the shared
state<a class='hidden_link' href='#4.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,constructor_'></a></span><div class='itemdecl' id='itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'>promise(promise&amp;&amp; rhs) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3963'>#</a></div><div id='5.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a new <span class='texttt'>promise</span> object and transfers ownership of the shared state
of <span class='texttt'>rhs</span> (if any) to the newly-constructed object<a class='hidden_link' href='#5.sentence-1'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3967'>#</a></div><div id='6.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#6.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,destructor'></a></span><div class='itemdecl' id='itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'>~promise();
</code></div><div class='itemdescr'></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3977'>#</a></div><div id='7.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Abandons any shared state (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#7.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,operator='></a></span><div class='itemdecl' id='itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'>promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3988'>#</a></div><div id='8.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Abandons any shared state (<a href='futures.state'>[futures.state]</a>) and then as if
<span class='texttt'>promise(std&#x200b;::&#x200b;move(rhs)).swap(*this)</span><a class='hidden_link' href='#8.sentence-1'>.</a></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L3993'>#</a></div><div id='9.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>*this</span><a class='hidden_link' href='#9.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:swap,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,swap'></a></span><div class='itemdecl' id='itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'>void swap(promise&amp; other) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4003'>#</a></div><div id='10.sentence-1' class='sentence'><span class='textit'>Effects:</span> Exchanges the shared state of <span class='texttt'>*this</span> and <span class='texttt'>other</span><a class='hidden_link' href='#10.sentence-1'>.</a></div></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4006'>#</a></div><div id='11.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>*this</span> has the shared state (if any) that <span class='texttt'>other</span> had
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#11.sentence-1'>.</a></div> <div id='11.sentence-2' class='sentence'><span class='texttt'>other</span> has the shared state (if any) that
<span class='texttt'>*this</span> had prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#11.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:get_future,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,get_future'></a></span><div class='itemdecl' id='itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'>future&lt;R&gt; get_future();
</code></div><div class='itemdescr'></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4018'>#</a></div><div id='12.sentence-1' class='sentence'><span class='textit'>Returns:</span> A <span class='texttt'>future&lt;R&gt;</span> object with the same shared state as
<span class='texttt'>*this</span><a class='hidden_link' href='#12.sentence-1'>.</a></div></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4022'>#</a></div><div id='13.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if <span class='texttt'>*this</span> has no shared state or if
<span class='texttt'>get_&shy;future</span> has already been called on a <span class='texttt'>promise</span> with the same
shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#13.sentence-1'>.</a></div></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4027'>#</a></div><div id='14.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> </div><div id='14.sentence-2' class='sentence'><ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#14.1'>(14.1)</a></div><div id='14.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;already_&shy;retrieved</span> if <span class='texttt'>get_&shy;future</span> has already been called on
a <span class='texttt'>promise</span> with the same shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#14.1.sentence-1'>.</a></div></li><li id='14.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#14.2'>(14.2)</a></div><div id='14.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#14.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_value,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_value'></a></span><div class='itemdecl' id='itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:8'>ðŸ”—</a></div><code class='itemdeclcode'>void promise::set_value(const R&amp; r);
void promise::set_value(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value(R&amp; r);
void promise&lt;void&gt;::set_value();
</code></div><div class='itemdescr'></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4047'>#</a></div><div id='15.sentence-1' class='sentence'><span class='textit'>Effects:</span> Atomically stores the value <span class='texttt'>r</span> in the shared state and
makes that state ready (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#15.sentence-1'>.</a></div></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4051'>#</a></div><div id='16.sentence-1' class='sentence'><span class='textit'>Throws:</span> </div><div id='16.sentence-2' class='sentence'><ul class='itemize'><li id='16.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#16.1'>(16.1)</a></div><div id='16.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception, or</div></li><li id='16.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#16.2'>(16.2)</a></div><div id='16.2.sentence-1' class='sentence'>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</div></li><li id='16.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#16.3'>(16.3)</a></div><div id='16.3.sentence-1' class='sentence'>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#16.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4061'>#</a></div><div id='17.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='17.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#17.1'>(17.1)</a></div><div id='17.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#17.1.sentence-1'>.</a></div></li><li id='17.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#17.2'>(17.2)</a></div><div id='17.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#17.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_exception,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_exception'></a></span><div class='itemdecl' id='itemdecl:9'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:9'>ðŸ”—</a></div><code class='itemdeclcode'>void set_exception(exception_ptr p);
</code></div><div class='itemdescr'></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4076'>#</a></div><div id='18.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>p</span> is not null<a class='hidden_link' href='#18.sentence-1'>.</a></div></div></div><div class='para' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4079'>#</a></div><div id='19.sentence-1' class='sentence'><span class='textit'>Effects:</span> Atomically stores the exception pointer <span class='texttt'>p</span> in the shared state
and makes that state ready (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#19.sentence-1'>.</a></div></div></div><div class='para' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4083'>#</a></div><div id='20.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#20.sentence-1'>.</a></div></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4087'>#</a></div><div id='21.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> </div><div id='21.sentence-2' class='sentence'><ul class='itemize'><li id='21.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#21.1'>(21.1)</a></div><div id='21.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#21.1.sentence-1'>.</a></div></li><li id='21.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#21.2'>(21.2)</a></div><div id='21.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#21.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_value_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_value_at_thread_exit'></a></span><div class='itemdecl' id='itemdecl:10'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:10'>ðŸ”—</a></div><code class='itemdeclcode'>void promise::set_value_at_thread_exit(const R&amp; r);
void promise::set_value_at_thread_exit(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value_at_thread_exit(R&amp; r);
void promise&lt;void&gt;::set_value_at_thread_exit();
</code></div><div class='itemdescr'></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4106'>#</a></div><div id='22.sentence-1' class='sentence'><span class='textit'>Effects:</span> Stores the value <span class='texttt'>r</span> in the shared state without making that
state ready immediately<a class='hidden_link' href='#22.sentence-1'>.</a></div> <div id='22.sentence-2' class='sentence'>Schedules that state to be made ready when the current
thread exits, after all objects of thread storage duration associated with the
current thread have been destroyed<a class='hidden_link' href='#22.sentence-2'>.</a></div></div></div><div class='para' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4112'>#</a></div><div id='23.sentence-1' class='sentence'><span class='textit'>Throws:</span> </div><div id='23.sentence-2' class='sentence'><ul class='itemize'><li id='23.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#23.1'>(23.1)</a></div><div id='23.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception, or</div></li><li id='23.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#23.2'>(23.2)</a></div><div id='23.2.sentence-1' class='sentence'>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</div></li><li id='23.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#23.3'>(23.3)</a></div><div id='23.3.sentence-1' class='sentence'>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#23.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4122'>#</a></div><div id='24.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='24.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#24.1'>(24.1)</a></div><div id='24.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#24.1.sentence-1'>.</a></div></li><li id='24.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#24.2'>(24.2)</a></div><div id='24.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#24.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_exception_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_exception_at_thread_exit'></a></span><div class='itemdecl' id='itemdecl:11'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:11'>ðŸ”—</a></div><code class='itemdeclcode'>void set_exception_at_thread_exit(exception_ptr p);
</code></div><div class='itemdescr'></div><div class='para' id='25'><div class='marginalizedparent'><a class='marginalized' href='#25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4137'>#</a></div><div id='25.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>p</span> is not null<a class='hidden_link' href='#25.sentence-1'>.</a></div></div></div><div class='para' id='26'><div class='marginalizedparent'><a class='marginalized' href='#26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4140'>#</a></div><div id='26.sentence-1' class='sentence'><span class='textit'>Effects:</span> Stores the exception pointer <span class='texttt'>p</span> in the shared state without
making that state ready immediately<a class='hidden_link' href='#26.sentence-1'>.</a></div> <div id='26.sentence-2' class='sentence'>Schedules that state to be made ready when
the current thread exits, after all objects of thread storage duration
associated with the current thread have been destroyed<a class='hidden_link' href='#26.sentence-2'>.</a></div></div></div><div class='para' id='27'><div class='marginalizedparent'><a class='marginalized' href='#27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4146'>#</a></div><div id='27.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if an error condition occurs<a class='hidden_link' href='#27.sentence-1'>.</a></div></div></div><div class='para' id='28'><div class='marginalizedparent'><a class='marginalized' href='#28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4149'>#</a></div><div id='28.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='28.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#28.1'>(28.1)</a></div><div id='28.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#28.1.sentence-1'>.</a></div></li><li id='28.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#28.2'>(28.2)</a></div><div id='28.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#28.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:swap,promise_'></a></span><span class='indexparent'><a class='index' id='lib:promise,swap_'></a></span><div class='itemdecl' id='itemdecl:12'><div class='marginalizedparent'><a class='itemDeclLink' href='#itemdecl:12'>ðŸ”—</a></div><code class='itemdeclcode'>template&lt;class R&gt;
  void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='29'><div class='marginalizedparent'><a class='marginalized' href='#29'>29</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a257a072efe2b6f2fe2dbdc5529b14315b08fbd8/source/threads.tex#L4165'>#</a></div><div id='29.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'>x.swap(y)</span><a class='hidden_link' href='#29.sentence-1'>.</a></div></div></div></div></body></html>