<!DOCTYPE html><html lang='en'><head><title>[facets.examples]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>25</a> Localization library <a class='abbr_ref' href='./#localization'>[localization]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>25.4</a> Standard <span class='texttt'>locale</span> categories <a class='abbr_ref' href='locale.categories#facets.examples'>[locale.categories]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>25.4.8</a> Program-defined facets <a class='abbr_ref'>[facets.examples]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5027'>#</a></div><div id='1.sentence-1' class='sentence'>A C++ program may define facets to be added to a locale and used identically as
the built-in facets<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>To create a new facet interface, C++ programs simply derive from
<span class='texttt'>locale&#x200b;::&#x200b;facet</span>
a class containing a static member:
<span class='texttt'>static locale&#x200b;::&#x200b;id id</span><a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5035'>#</a></div><div id='2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-1' class='sentence'>The locale member function templates verify its type and storage class<a class='hidden_link' href='#2.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5040'>#</a></div><div id='3.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='3.sentence-1' class='sentence'>Traditional global localization is still easy:</div><pre class='codeblock'>
#include &lt;iostream&gt;
#include &lt;locale&gt;
int main(int argc, char** argv) {
  using namespace std;
  locale::global(locale(""));           <span class='comment'>// set the global locale
</span>                                        <span class='comment'>// imbue it on all the std streams
</span>  cin.imbue(locale());
  cout.imbue(locale());
  cerr.imbue(locale());
  wcin.imbue(locale());
  wcout.imbue(locale());
  wcerr.imbue(locale());

  return MyObject(argc, argv).doit();
}</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5063'>#</a></div><div id='4.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='4.sentence-1' class='sentence'>Greater flexibility is possible:</div><pre class='codeblock'>
#include &lt;iostream&gt;
#include &lt;locale&gt;
int main() {
  using namespace std;
  cin.imbue(locale(""));        <span class='comment'>// the user's preferred locale
</span>  cout.imbue(locale::classic());
  double f;
  while (cin &gt;&gt; f) cout &lt;&lt; f &lt;&lt; endl;
  return (cin.fail() != 0);
}</pre><div id='4.sentence-2' class='sentence'>In a European locale, with input
<span class='texttt'>3.456,78</span>,
output is
<span class='texttt'>3456.78</span><a class='hidden_link' href='#4.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5086'>#</a></div><div id='5.sentence-1' class='sentence'>This can be important even for simple programs, which may need to
write a data file in a fixed format, regardless of a user's preference<a class='hidden_link' href='#5.sentence-1'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5090'>#</a></div><div id='6.sentence-1' class='sentence'>[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
Here is an example of the use of locales in a library interface<a class='hidden_link' href='#6.sentence-1'>.</a></div><pre class='codeblock'>
<span class='comment'>// file: <span class='tcode_in_codeblock'>Date.h</span>
</span>#include &lt;iosfwd&gt;
#include &lt;string&gt;
#include &lt;locale&gt;

class Date {
public:
  Date(unsigned day, unsigned month, unsigned year);
  std::string asString(const std::locale&amp; = std::locale());
};

std::istream&amp; operator&gt;&gt;(std::istream&amp; s, Date&amp; d);
std::ostream&amp; operator&lt;&lt;(std::ostream&amp; s, Date d);</pre></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5110'>#</a></div><div id='7.sentence-1' class='sentence'>This example illustrates two architectural uses of class
<span class='texttt'>locale</span><a class='hidden_link' href='#7.sentence-1'>.</a></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5114'>#</a></div><div id='8.sentence-1' class='sentence'>The first is as a default argument in
<span class='texttt'>Date&#x200b;::&#x200b;asString()</span>,
where the
default is the global (presumably user-preferred) locale<a class='hidden_link' href='#8.sentence-1'>.</a></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5120'>#</a></div><div id='9.sentence-1' class='sentence'>The second is in the operators
<span class='texttt'>&lt;&lt;</span> and <span class='texttt'>&gt;&gt;</span>,
where a locale “hitchhikes”
on another object, in this case a stream, to the point where it
is needed<a class='hidden_link' href='#9.sentence-1'>.</a></div><pre class='codeblock'>
<span class='comment'>// file: <span class='tcode_in_codeblock'>Date.C</span>
</span>#include "Date"                 <span class='comment'>// includes <span class='tcode_in_codeblock'>&lt;ctime&gt;</span>
</span>#include &lt;sstream&gt;
std::string Date::asString(const std::locale&amp; l) {
  using namespace std;
  ostringstream s; s.imbue(l);
  s &lt;&lt; *this; return s.str();
}

std::istream&amp; operator&gt;&gt;(std::istream&amp; s, Date&amp; d) {
  using namespace std;
  istream::sentry cerberos(s);
  if (cerberos) {
    ios_base::iostate err = goodbit;
    struct tm t;
    use_facet&lt;time_get&lt;char&gt;&gt;(s.getloc()).get_date(s, 0, s, err, &amp;t);
    if (!err) d = Date(t.tm_day, t.tm_mon + 1, t.tm_year + 1900);
    s.setstate(err);
  }
  return s;
}</pre> <div id='9.sentence-2' class='sentence'><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>]</div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5152'>#</a></div><div id='10.sentence-1' class='sentence'>A locale object may be extended with a new facet simply by constructing
it with an instance of a class derived from
<span class='texttt'>locale&#x200b;::&#x200b;facet</span><a class='hidden_link' href='#10.sentence-1'>.</a></div> <div id='10.sentence-2' class='sentence'>The only member a C++ program must define is the static member
<span class='texttt'>id</span>,
which identifies your class interface as a new facet<a class='hidden_link' href='#10.sentence-2'>.</a></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5160'>#</a></div><div id='11.sentence-1' class='sentence'>[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
Classifying Japanese characters:</div><pre class='codeblock'>
<span class='comment'>// file: <span class='tcode_in_codeblock'>&lt;jctype&gt;</span>
</span>#include &lt;locale&gt;
namespace My {
  using namespace std;
  class JCtype : public locale::facet {
  public:
    static locale::id id;       <span class='comment'>// required for use as a new locale facet
</span>    bool is_kanji (wchar_t c) const;
    JCtype() { }
  protected:
    ~JCtype() { }
  };
}

<span class='comment'>// file: <span class='tcode_in_codeblock'>filt.C</span>
</span>#include &lt;iostream&gt;
#include &lt;locale&gt;
#include "jctype"               <span class='comment'>// above
</span>std::locale::id My::JCtype::id; <span class='comment'>// the static <span class='tcode_in_codeblock'>JCtype</span> member declared above.
</span>
int main() {
  using namespace std;
  using wctype = ctype&lt;wchar_t&gt;;
  locale loc(locale(""),        <span class='comment'>// the user's preferred locale ...
</span>         new My::JCtype);       <span class='comment'>// and a new feature ...
</span>  wchar_t c = use_facet&lt;wctype&gt;(loc).widen('!');
  if (!use_facet&lt;My::JCtype&gt;(loc).is_kanji(c))
    cout &lt;&lt; "no it isn't!" &lt;&lt; endl;
}</pre></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5196'>#</a></div><div id='12.sentence-1' class='sentence'>The new facet is used exactly like the built-in facets<a class='hidden_link' href='#12.sentence-1'>.</a></div> <div id='12.sentence-2' class='sentence'><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>]</div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/78f8e15e9acb75272c0c32cd7df9085e81668b1e/source/locales.tex#L5200'>#</a></div><div id='13.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#13.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='13.sentence-1' class='sentence'>Replacing an existing facet is even easier<a class='hidden_link' href='#13.sentence-1'>.</a></div> <div id='13.sentence-2' class='sentence'>The code does not define a member
<span class='texttt'>id</span>
because it is reusing the
<span class='texttt'>numpunct&lt;charT&gt;</span>
facet interface:</div><pre class='codeblock'>
<span class='comment'>// file: <span class='tcode_in_codeblock'>my_&shy;bool.C</span>
</span>#include &lt;iostream&gt;
#include &lt;locale&gt;
#include &lt;string&gt;
namespace My {
  using namespace std;
  using cnumpunct = numpunct_byname&lt;char&gt;;
  class BoolNames : public cnumpunct {
  protected:
    string do_truename()  const { return "Oui Oui!"; }
    string do_falsename() const { return "Mais Non!"; }
    ~BoolNames() { }
  public:
    BoolNames(const char* name) : cnumpunct(name) { }
  };
}

int main(int argc, char** argv) {
  using namespace std;
  <span class='comment'>// make the user's preferred locale, except for...
</span>  locale loc(locale(""), new My::BoolNames(""));
  cout.imbue(loc);
  cout &lt;&lt; boolalpha &lt;&lt; "Any arguments today? " &lt;&lt; (argc &gt; 1) &lt;&lt; endl;
}</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></body></html>