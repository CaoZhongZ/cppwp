<!DOCTYPE html><html lang='en'><head><title>[class.temporary]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>15</a> Special member functions <a class='abbr_ref' href='./#special'>[special]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>15.2</a> Temporary objects <a class='abbr_ref'>[class.temporary]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L360'>#</a></div><div id='1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':temporary'></a></span><span class='indexparent'><a class='index' id=':temporary,elimination_of'></a></span><span class='indexparent'><a class='index' id=':temporary,implementation-defined_generation_of'></a></span>Temporary objects are created
<ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.1'>(1.1)</a></div><div id='1.1.sentence-1' class='sentence'>when a prvalue is materialized so that it can be used as a <a href='conv.rval#def:glvalue'>glvalue</a>,</div></li><li id='1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.2'>(1.2)</a></div><div id='1.2.sentence-1' class='sentence'>when needed by the implementation to pass or return an object of trivially-copyable type (see below),
and</div></li><li id='1.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.3'>(1.3)</a></div><div id='1.3.sentence-1' class='sentence'>when <a href='except.throw'>throwing an exception</a><a class='hidden_link' href='#1.3.sentence-1'>.</a></div> <div id='1.3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#1.3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.3.sentence-2' class='sentence'>The lifetime of exception objects is described in <a href='except.throw'>[except.throw]</a><a class='hidden_link' href='#1.3.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </li></ul>
Even when the creation of the temporary object is
unevaluated (<a href='expr.prop'>[expr.prop]</a>),
all the semantic restrictions shall be respected as if the temporary object
had been created and later destroyed<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#1.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.sentence-2' class='sentence'>This includes <a href='class.access'>accessibility</a> and whether it is deleted,
for the constructor selected and for the destructor<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>However, in the special
case of the operand of a
<i ><a href='dcl.type.simple#nt:decltype-specifier'>decltype-specifier</a></i> (<a href='expr.call'>[expr.call]</a>), no temporary is introduced,
so the foregoing does not apply to such a prvalue<a class='hidden_link' href='#1.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L391'>#</a></div><div id='2.sentence-1' class='sentence'>The materialization of a temporary object is generally
delayed as long as possible
in order to avoid creating unnecessary temporary objects<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-2' class='sentence'>Temporary objects are materialized:
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div><div id='2.1.sentence-1' class='sentence'>when binding a reference to a prvalue (<a href='dcl.init.ref'>[dcl.init.ref]</a>, <a href='expr.type.conv'>[expr.type.conv]</a>,
<a href='expr.dynamic.cast'>[expr.dynamic.cast]</a>, <a href='expr.static.cast'>[expr.static.cast]</a>, <a href='expr.const.cast'>[expr.const.cast]</a>, <a href='expr.cast'>[expr.cast]</a>),</div></li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div><div id='2.2.sentence-1' class='sentence'>when performing member access on a class prvalue (<a href='expr.ref'>[expr.ref]</a>, <a href='expr.mptr.oper'>[expr.mptr.oper]</a>),</div></li><li id='2.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.3'>(2.3)</a></div><div id='2.3.sentence-1' class='sentence'>when performing an <a href='conv.array'>array-to-pointer conversion</a> or <a href='expr.sub'>subscripting</a> on an array prvalue,</div></li><li id='2.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.4'>(2.4)</a></div><div id='2.4.sentence-1' class='sentence'>when initializing an object of type <span class='texttt'>std&#x200b;::&#x200b;initializer_&shy;list&lt;T&gt;</span> from a <i ><a href='dcl.init#nt:braced-init-list'>braced-init-list</a></i> (<a href='dcl.init.list'>[dcl.init.list]</a>),</div></li><li id='2.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.5'>(2.5)</a></div><div id='2.5.sentence-1' class='sentence'>for certain unevaluated operands (<a href='expr.typeid'>[expr.typeid]</a>, <a href='expr.sizeof'>[expr.sizeof]</a>), and</div></li><li id='2.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.6'>(2.6)</a></div><div id='2.6.sentence-1' class='sentence'>when a prvalue appears as a <a href='expr.prop#def:discarded-value_expression'>discarded-value expression</a><a class='hidden_link' href='#2.6.sentence-1'>.</a></div></li></ul></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='2.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#2.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='2.sentence-3' class='sentence'>Consider the following code:
<pre class='codeblock'>
class X {
public:
  X(int);
  X(const X&amp;);
  X&amp; operator=(const X&amp;);
  ~X();
};

class Y {
public:
  Y(int);
  Y(Y&amp;&amp;);
  ~Y();
};

X f(X);
Y g(Y);

void h() {
  X a(1);
  X b = f(X(2));
  Y c = g(Y(3));
  a = f(a);
}</pre></div><div id='2.sentence-4' class='sentence'><span class='indexparent'><a class='index' id=':constructor,copy'></a></span><span class='texttt'>X(2)</span> is constructed in the space used to hold <span class='texttt'>f()</span>'s argument and
<span class='texttt'>Y(3)</span> is constructed in the space used to hold <span class='texttt'>g()</span>'s argument<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>Likewise,
<span class='texttt'>f()</span>'s result is constructed directly in <span class='texttt'>b</span> and
<span class='texttt'>g()</span>'s result is constructed directly in <span class='texttt'>c</span><a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'>On the other hand, the expression
<span class='texttt'>a = f(a)</span>
requires a temporary for
the result of <span class='texttt'>f(a)</span>,
which is materialized so that the reference parameter
of <span class='texttt'>A&#x200b;::&#x200b;operator=(const A&amp;)</span> can bind to it<a class='hidden_link' href='#2.sentence-6'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L456'>#</a></div><div id='3.sentence-1' class='sentence'>When an object of class type <span class='texttt'>X</span>
is passed to or returned from a function,
if each copy constructor, move constructor, and destructor of <span class='texttt'>X</span>
is either trivial or deleted,
and <span class='texttt'>X</span>
has at least one non-deleted copy or move constructor,
implementations are permitted
to create a temporary object
to hold the function parameter or result object<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>The temporary object is constructed
from the function argument or return value, respectively,
and the function's parameter or return object
is initialized as if by
using the non-deleted trivial constructor to copy the temporary
(even if that constructor is inaccessible
or would not be selected by overload resolution
to perform a copy or move of the object)<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-3' class='sentence'>This latitude is granted to allow objects of class type to be passed to or returned from functions in registers<a class='hidden_link' href='#3.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L478'>#</a></div><div id='4.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':temporary,constructor_for'></a></span><span class='indexparent'><a class='index' id=':temporary,destructor_for'></a></span><span class='indexparent'><a class='index' id=':temporary,destruction_of'></a></span>When an implementation introduces a temporary object of a class that has a
non-trivial constructor (<a href='class.ctor'>[class.ctor]</a>, <a href='class.copy'>[class.copy]</a>), it shall ensure that
a constructor is called for the temporary object<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>Similarly, the destructor shall be called for a temporary with a non-trivial
destructor (<a href='class.dtor'>[class.dtor]</a>)<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>Temporary objects are destroyed as the last step
in evaluating
the <a href='intro.execution#def:full-expression'>full-expression</a>
that (lexically) contains the point where
they were created<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'>This is true even if that evaluation ends in throwing an exception<a class='hidden_link' href='#4.sentence-4'>.</a></div> <div id='4.sentence-5' class='sentence'>The
<span class='indexparent'><a class='index' id=':value_computation'></a></span>value computations and
<span class='indexparent'><a class='index' id=':side_effects'></a></span>side effects of destroying a temporary object
are associated only with the full-expression, not with any specific
subexpression<a class='hidden_link' href='#4.sentence-5'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L501'>#</a></div><div id='5.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':initializer,temporary_and_declarator'></a></span><span class='indexparent'><a class='index' id=':temporary,order_of_destruction_of'></a></span>There are three contexts in which temporaries are destroyed at a different
point than the end of the full-expression<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>The first context is when a default constructor is called to initialize
an element of an array with no corresponding initializer (<a href='dcl.init'>[dcl.init]</a>)<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>The second context is when a copy constructor is called to copy an element of
an array while the entire array is copied (<a href='expr.prim.lambda.capture'>[expr.prim.lambda.capture]</a>, <a href='class.copy'>[class.copy]</a>)<a class='hidden_link' href='#5.sentence-3'>.</a></div> <div id='5.sentence-4' class='sentence'>In either case, if the constructor has one or more default arguments,
the destruction of every temporary created in a default argument is
sequenced before the construction of the next array element, if any<a class='hidden_link' href='#5.sentence-4'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L514'>#</a></div><div id='6.sentence-1' class='sentence'>The third context is when a reference is bound to a
temporary object<a class='hidden_link' href='#6.sentence-1'>.</a><a class='footnotenum' href='#footnote-116'>116</a></div> <div id='6.sentence-2' class='sentence'>
The temporary object to which the reference is bound or the temporary object
that is the complete object of a subobject to which the reference is bound
persists for the lifetime of the reference if the glvalue
to which the reference is bound
was obtained through one of the following:
<ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.1'>(6.1)</a></div><div id='6.1.sentence-1' class='sentence'>a temporary materialization conversion (<a href='conv.rval'>[conv.rval]</a>),</div></li><li id='6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.2'>(6.2)</a></div><div id='6.2.sentence-1' class='sentence'><span class='texttt'>(</span> <i ><a href='expr.comma#nt:expression'>expression</a></i> <span class='texttt'>)</span>,
  where <i ><a href='expr.comma#nt:expression'>expression</a></i> is one of these expressions,</div></li><li id='6.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.3'>(6.3)</a></div><div id='6.3.sentence-1' class='sentence'>subscripting (<a href='expr.sub'>[expr.sub]</a>) of an array operand,
  where that operand is one of these expressions,</div></li><li id='6.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.4'>(6.4)</a></div><div id='6.4.sentence-1' class='sentence'>a class member access (<a href='expr.ref'>[expr.ref]</a>) using the <span class='texttt'>.</span> operator
  where the left operand is one of these expressions and
  the right operand designates a non-static data member of non-reference type,</div></li><li id='6.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.5'>(6.5)</a></div><div id='6.5.sentence-1' class='sentence'>a pointer-to-member operation (<a href='expr.mptr.oper'>[expr.mptr.oper]</a>) using the <span class='texttt'>.*</span> operator
  where the left operand is one of these expressions and
  the right operand is a pointer to data member of non-reference type,</div></li><li id='6.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.6'>(6.6)</a></div><div id='6.6.sentence-1' class='sentence'>a
  <ul class='itemize'><li id='6.6.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#6.6.1'>(6.6.1)</a></div><div id='6.6.1.sentence-1' class='sentence'>
  <span class='texttt'>const_&shy;cast</span> (<a href='expr.const.cast'>[expr.const.cast]</a>),</div></li><li id='6.6.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#6.6.2'>(6.6.2)</a></div><div id='6.6.2.sentence-1' class='sentence'><span class='texttt'>static_&shy;cast</span> (<a href='expr.static.cast'>[expr.static.cast]</a>),</div></li><li id='6.6.3'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#6.6.3'>(6.6.3)</a></div><div id='6.6.3.sentence-1' class='sentence'><span class='texttt'>dynamic_&shy;cast</span> (<a href='expr.dynamic.cast'>[expr.dynamic.cast]</a>), or</div></li><li id='6.6.4'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#6.6.4'>(6.6.4)</a></div><div id='6.6.4.sentence-1' class='sentence'><span class='texttt'>reinterpret_&shy;cast</span> (<a href='expr.reinterpret.cast'>[expr.reinterpret.cast]</a>)</div></li></ul>
  converting, without a user-defined conversion,
  a glvalue operand that is one of these expressions
  to a glvalue that refers
  to the object designated by the operand, or
  to its complete object or a subobject thereof,</div></li><li id='6.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.7'>(6.7)</a></div><div id='6.7.sentence-1' class='sentence'>a conditional expression (<a href='expr.cond'>[expr.cond]</a>) that is a glvalue
  where the second or third operand is one of these expressions, or</div></li><li id='6.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.8'>(6.8)</a></div><div id='6.8.sentence-1' class='sentence'>a comma expression (<a href='expr.comma'>[expr.comma]</a>) that is a glvalue
  where the right operand is one of these expressions<a class='hidden_link' href='#6.8.sentence-1'>.</a></div></li></ul></div> <div id='6.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
template&lt;typename T&gt; using id = T;

int i = 1;
int&amp;&amp; a = id&lt;int[3]&gt;{1, 2, 3}[i];          <span class='comment'>// temporary array has same lifetime as <span class='tcode_in_codeblock'>a</span>
</span>const int&amp; b = static_cast&lt;const int&amp;&gt;(0); <span class='comment'>// temporary <span class='tcode_in_codeblock'>int</span> has same lifetime as <span class='tcode_in_codeblock'>b</span>
</span>int&amp;&amp; c = cond ? id&lt;int[3]&gt;{1, 2, 3}[i] : static_cast&lt;int&amp;&amp;&gt;(0);
                                           <span class='comment'>// exactly one of the two temporaries is lifetime-extended
</span></pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='6.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#6.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='6.sentence-3' class='sentence'>An explicit type conversion (<a href='expr.type.conv'>[expr.type.conv]</a>, <a href='expr.cast'>[expr.cast]</a>)
is interpreted as
a sequence of elementary casts,
covered above<a class='hidden_link' href='#6.sentence-3'>.</a></div> <div id='6.example-2' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
const int&amp; x = (const int&amp;)1;  <span class='comment'>// temporary for value 1 has same lifetime as x
</span></pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div>  —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='6.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#6.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='6.sentence-4' class='sentence'>If a temporary object has a reference member initialized by another temporary object,
lifetime extension applies recursively to such a member's initializer<a class='hidden_link' href='#6.sentence-4'>.</a></div> <div id='6.example-3' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.example-3'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
struct S {
  const int&amp; m;
};
const S&amp; s = S{1};             <span class='comment'>// both <span class='tcode_in_codeblock'>S</span> and <span class='tcode_in_codeblock'>int</span> temporaries have lifetime of <span class='tcode_in_codeblock'>s</span>
</span></pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div>  —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> <div id='6.sentence-5' class='sentence'>The exceptions to this lifetime rule are:
<ul class='itemize'><li id='6.9'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.9'>(6.9)</a></div><div id='6.9.sentence-1' class='sentence'>A temporary object bound to a reference parameter in a <a href='expr.call'>function call</a>
persists until the completion of the full-expression containing the call<a class='hidden_link' href='#6.9.sentence-1'>.</a></div></li><li id='6.10'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.10'>(6.10)</a></div><div id='6.10.sentence-1' class='sentence'>The lifetime of a temporary bound to the returned value in a function <a href='stmt.return'><span class='texttt'>return</span> statement</a> is not extended; the temporary is destroyed at the end of the full-expression in the <span class='texttt'>return</span> statement<a class='hidden_link' href='#6.10.sentence-1'>.</a></div></li><li id='6.11'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.11'>(6.11)</a></div><div id='6.11.sentence-1' class='sentence'>A temporary bound to a reference in a <i ><a href='expr.new#nt:new-initializer'>new-initializer</a></i> persists until the completion of the full-expression containing the <i ><a href='expr.new#nt:new-initializer'>new-initializer</a></i><a class='hidden_link' href='#6.11.sentence-1'>.</a></div> <div id='6.11.note-3' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#6.11.note-3'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='6.11.sentence-2' class='sentence'>This may introduce a dangling reference<a class='hidden_link' href='#6.11.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='6.11.example-4' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.11.example-4'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
struct S { int mi; const std::pair&lt;int,int&gt;&amp; mp; };
S a { 1, {2,3} };
S* p = new S{ 1, {2,3} };      <span class='comment'>// creates dangling reference
</span></pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </li></ul></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L614'>#</a></div><div id='7.sentence-1' class='sentence'>The destruction of a temporary whose lifetime is not extended by being
bound to a reference is sequenced before the destruction of every
temporary which is constructed earlier in the same full-expression<a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.sentence-2' class='sentence'>If the lifetime of two or more temporaries to which references are bound ends
at the same point,
these temporaries are destroyed at that point in the reverse order of the
completion of their construction<a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='7.sentence-3' class='sentence'>In addition, the destruction of temporaries bound to references shall
take into account the ordering of destruction of objects with
<a href='basic.stc.static#def:static_storage_duration'>static</a>,
<a href='basic.stc.thread#def:thread_storage_duration'>thread</a>, or
<a href='basic.stc.auto#def:automatic_storage_duration'>automatic storage duration</a>;
that is, if
<span class='texttt'>obj1</span>
is an object with the same storage duration as the temporary and
created before the temporary is created
the temporary shall be destroyed before
<span class='texttt'>obj1</span>
is destroyed;
if
<span class='texttt'>obj2</span>
is an object with the same storage duration as the temporary and
created after the temporary is created
the temporary shall be destroyed after
<span class='texttt'>obj2</span>
is destroyed<a class='hidden_link' href='#7.sentence-3'>.</a></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/6d886642cd163af40ae8c5ec4f98f44acfe405f6/source/special.tex#L642'>#</a></div><div id='8.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#8.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
struct S {
  S();
  S(int);
  friend S operator+(const S&amp;, const S&amp;);
  ~S();
};
S obj1;
const S&amp; cr = S(16)+S(23);
S obj2;</pre><div id='8.sentence-1' class='sentence'>The expression
<span class='texttt'>S(16) + S(23)</span>
creates three temporaries:
a first temporary
<span class='texttt'>T1</span>
to hold the result of the expression
<span class='texttt'>S(16)</span>,
a second temporary
<span class='texttt'>T2</span>
to hold the result of the expression
<span class='texttt'>S(23)</span>,
and a third temporary
<span class='texttt'>T3</span>
to hold the result of the addition of these two expressions<a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='8.sentence-2' class='sentence'>The temporary
<span class='texttt'>T3</span>
is then bound to the reference
<span class='texttt'>cr</span><a class='hidden_link' href='#8.sentence-2'>.</a></div> <div id='8.sentence-3' class='sentence'>It is unspecified whether
<span class='texttt'>T1</span>
or
<span class='texttt'>T2</span>
is created first<a class='hidden_link' href='#8.sentence-3'>.</a></div> <div id='8.sentence-4' class='sentence'>On an implementation where
<span class='texttt'>T1</span>
is created before
<span class='texttt'>T2</span>,
<span class='texttt'>T2</span>
shall be destroyed before
<span class='texttt'>T1</span><a class='hidden_link' href='#8.sentence-4'>.</a></div> <div id='8.sentence-5' class='sentence'>The temporaries
<span class='texttt'>T1</span>
and
<span class='texttt'>T2</span>
are bound to the reference parameters of
<span class='texttt'>operator+</span>;
these temporaries are destroyed at the end of the full-expression
containing the call to
<span class='texttt'>operator+</span><a class='hidden_link' href='#8.sentence-5'>.</a></div> <div id='8.sentence-6' class='sentence'>The temporary
<span class='texttt'>T3</span>
bound to the reference
<span class='texttt'>cr</span>
is destroyed at the end of
<span class='texttt'>cr</span>'s
lifetime, that is, at the end of the program<a class='hidden_link' href='#8.sentence-6'>.</a></div> <div id='8.sentence-7' class='sentence'>In addition, the order in which
<span class='texttt'>T3</span>
is destroyed takes into account the destruction order of other objects with
static storage duration<a class='hidden_link' href='#8.sentence-7'>.</a></div> <div id='8.sentence-8' class='sentence'>That is, because
<span class='texttt'>obj1</span>
is constructed before
<span class='texttt'>T3</span>,
and
<span class='texttt'>T3</span>
is constructed before
<span class='texttt'>obj2</span>,
<span class='texttt'>obj2</span>
shall be destroyed before
<span class='texttt'>T3</span>,
and
<span class='texttt'>T3</span>
shall be destroyed before
<span class='texttt'>obj1</span><a class='hidden_link' href='#8.sentence-8'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='footnote' id='footnote-116'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-116'>116)</a></div><div id='footnote-116.sentence-1' class='sentence'>The same rules apply to initialization of an
  <span class='texttt'>initializer_&shy;list</span> object (<a href='dcl.init.list'>[dcl.init.list]</a>) with its
  underlying temporary array<a class='hidden_link' href='#footnote-116.sentence-1'>.</a></div></div></div></body></html>