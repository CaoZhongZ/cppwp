<!DOCTYPE html><html lang='en'><head><title>[except.spec]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>15</a> Exception handling <a class='abbr_ref' href='./#except'>[except]</a></h1><div id='except.spec'><h2 ><a class='secnum' style='min-width:88pt'>15.4</a> Exception specifications <a class='abbr_ref'>[except.spec]</a></h2><p ><span class='indexparent'><a class='index' id='exception_specification'></a></span></p><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >A function declaration lists exceptions
that its function might directly or indirectly throw
by using an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
as a suffix of its declarator.</p><pre class='bnf'><a id='nt:exception-specification'>exception-specification:</a>
    <i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specification</a></i>
    <i ><a href='except.spec#nt:noexcept-specification'>noexcept-specification</a></i></pre><pre class='bnf'><a id='nt:dynamic-exception-specification'>dynamic-exception-specification:</a>
    <span class='terminal'>throw (</span> <i ><a href='except.spec#nt:type-id-list'>type-id-list</a></i><span class='math'><sub ><span class='mathit'>opt</span></sub></span> <span class='terminal'>)</span></pre><pre class='bnf'><a id='nt:type-id-list'>type-id-list:</a>
    <i ><a href='dcl.name#nt:type-id'>type-id</a></i> <span class='terminal'>...</span><span class='math'><sub ><span class='mathit'>opt</span></sub></span>
    <i ><a href='except.spec#nt:type-id-list'>type-id-list</a></i> <span class='terminal'>,</span> <i ><a href='dcl.name#nt:type-id'>type-id</a></i> <span class='terminal'>...</span><span class='math'><sub ><span class='mathit'>opt</span></sub></span></pre><pre class='bnf'><a id='nt:noexcept-specification'>noexcept-specification:</a>
    <span class='terminal'>noexcept</span> <span class='terminal'>(</span> <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i> <span class='terminal'>)</span>
    <span class='terminal'>noexcept</span></pre><p ><span class='indexparent'><a class='index' id='exception_specification,noexcept,constant_expression_and'></a></span>In a <i ><a href='except.spec#nt:noexcept-specification'>noexcept-specification</a></i>, the <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i>,
if supplied, shall be a constant expression (<a href='expr.const'>[expr.const]</a>) that is contextually
converted to <span class='texttt'>bool</span> (Clause <a href='conv'>[conv]</a>). A <i ><a href='except.spec#nt:noexcept-specification'>noexcept-specification</a></i>
<span class='texttt'>noexcept</span> is equivalent to <span class='texttt'>noexcept(<span class='discretionary'></span>true)</span>.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >An
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
shall appear only on a function declarator for a function type,
pointer to function type, reference to function type, or pointer to
member function type that is the top-level type of a declaration or
definition, or on such a type appearing as a parameter or return type
in a function declarator.
An
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
shall not appear in a typedef declaration or <i ><a href='dcl.dcl#nt:alias-declaration'>alias-declaration</a></i>.
[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
void f() throw(int);                    <span class='comment'>// OK
</span>void (*fp)() throw (int);               <span class='comment'>// OK
</span>void g(void pfa() throw(int));          <span class='comment'>// OK
</span>typedef int (*pf)() throw(int);         <span class='comment'>// ill-formed
</span></pre><p ><i>&nbsp;—&nbsp;end example</i>&nbsp;]
<span class='indexparent'><a class='index' id='exception_specification,incomplete_type_and'></a></span>A type denoted in an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
shall not denote an incomplete type.
A type denoted in an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
shall not denote a pointer or reference to an incomplete type, other than
<span class='texttt'>void*</span>,
<span class='texttt'>const</span>
<span class='texttt'>void*</span>,
<span class='texttt'>volatile</span>
<span class='texttt'>void*</span>,
or
<span class='texttt'>const</span>
<span class='texttt'>volatile</span>
<span class='texttt'>void*</span>.
A type <i>cv</i> <span class='texttt'>T</span>, “array of <span class='texttt'>T</span>”, or “function returning <span class='texttt'>T</span>”
denoted in an <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> is adjusted to type <span class='texttt'>T</span>,
“pointer to <span class='texttt'>T</span>”, or “pointer to function returning <span class='texttt'>T</span>”, respectively.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><p ><span class='indexparent'><a class='index' id='exception_specification,compatible'></a></span>Two <i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i> are
<span class='indexparent'><a class='index' id='compatible'></a></span><a class='hidden_link' href='#def:compatible' id='def:compatible'><i>compatible</i></a> if:</p><ul ><li ><p >both are non-throwing (see below), regardless of their form,</p></li><li ><p >both have the form <span class='texttt'>noexcept(</span><i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i><span class='texttt'>)</span>
and the <i ><a href='expr.const#nt:constant-expression'>constant-expressions</a></i> are equivalent, or</p></li><li ><p >both are <i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specifications</a></i> that have the same
set of adjusted types.
</p></li></ul></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><p >If any declaration of a function has an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
that is not a <i ><a href='except.spec#nt:noexcept-specification'>noexcept-specification</a></i> allowing all exceptions,
all declarations, including the definition and any explicit specialization,
of that function shall have a compatible
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>.
If any declaration of a pointer to function, reference to function,
or pointer to member function has an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>,
all occurrences of that declaration shall have a compatible
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
In an explicit instantiation an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
may be specified, but is not required.
If an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
is specified in an explicit instantiation directive, it shall
be compatible with the <i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i> of
other declarations of that function.
A diagnostic is required only if the
<i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i> are not compatible
within a single translation unit.</p></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><p ><span class='indexparent'><a class='index' id='exception_specification,virtual_function_and'></a></span>If a virtual function has an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>,
all declarations, including the definition, of any function
that overrides that virtual function in any derived class
shall only allow exceptions that are allowed by the
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
of the base class virtual function.
[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
struct B {
  virtual void f() throw (int, double);
  virtual void g();
};

struct D: B {
  void f();                     <span class='comment'>// ill-formed
</span>  void g() throw (int);         <span class='comment'>// OK
</span>};
</pre><p >The declaration of
<span class='texttt'>D::f</span>
is ill-formed because it allows all exceptions, whereas
<span class='texttt'>B::f</span>
allows only
<span class='texttt'>int</span>
and
<span class='texttt'>double</span>.
<i>&nbsp;—&nbsp;end example</i>&nbsp;]
A similar restriction applies to assignment to and
initialization of pointers to functions, pointers
to member functions, and references to functions:
the target entity shall allow at least the exceptions
allowed by the source value in the assignment or
initialization.
[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
class A { <span class='comment'>/* ... */</span> };
void (*pf1)();      <span class='comment'>// no exception specification
</span>void (*pf2)() throw(A);

void f() {
  pf1 = pf2;        <span class='comment'>// OK: <span class='texttt'>pf1</span> is less restrictive
</span>  pf2 = pf1;        <span class='comment'>// error: <span class='texttt'>pf2</span> is more restrictive
</span>}
</pre><p ><i>&nbsp;—&nbsp;end example</i>&nbsp;]</p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><p >In such an assignment or initialization,
<i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i>
on return types and parameter types shall be compatible.
In other assignments or initializations,
<i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i>
shall be compatible.</p></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><p >An
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
can include the same type more than once
and can include classes that are related by inheritance,
even though doing so is redundant.
[&nbsp;<i>Note:</i> An
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
can also include the class
<span class='texttt'>std::bad_exception</span> (<a href='bad.exception'>[bad.exception]</a>).
<i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><p ><span class='indexparent'><a class='index' id='exception_handling,allowing_an_exception'></a></span><span class='indexparent'><a class='index' id='allowing_an_exception'></a></span>A function is said to
<a class='hidden_link' href='#def:allow' id='def:allow'><i>allow</i></a>
an exception of type
<span class='texttt'>E</span>
if
the <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i> in its <i ><a href='except.spec#nt:noexcept-specification'>noexcept-specification</a></i>
evaluates to <span class='texttt'>false</span> or
its
<i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specification</a></i>
contains a type
<span class='texttt'>T</span>
for which a handler of type
<span class='texttt'>T</span>
would be a match (<a href='except.handle'>[except.handle]</a>) for an exception of type
<span class='texttt'>E</span>.</p></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><p ><span class='indexparent'><a class='index' id='exception_handling,unexpected_called'></a></span><span class='indexparent'><a class='index' id='unexpected(),called'></a></span>Whenever an exception is thrown and the search for a handler (<a href='except.handle'>[except.handle]</a>)
encounters the outermost block of a function with an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> that does not allow the exception, then,</p><ul ><li ><p >if the <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> is a
<i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specification</a></i>, the function
<span class='texttt'>std::unexpected()</span> is called (<a href='except.unexpected'>[except.unexpected]</a>),</p><p ><span class='indexparent'><a class='index' id='exception_handling,terminate_called'></a></span><span class='indexparent'><a class='index' id='terminate(),called'></a></span></p></li><li ><p >otherwise, the function <span class='texttt'>std::terminate()</span> is called (<a href='except.terminate'>[except.terminate]</a>).
</p></li></ul><p >[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
class X { };
class Y { };
class Z: public X { };
class W { };

void f() throw (X, Y) {
  int n = 0;
  if (n) throw X();             <span class='comment'>// OK
</span>  if (n) throw Z();             <span class='comment'>// also OK
</span>  throw W();                    <span class='comment'>// will call <span class='texttt'>std::unexpected()</span>
</span>}
</pre><p ><i>&nbsp;—&nbsp;end example</i>&nbsp;]</p><p >[&nbsp;<i>Note:</i> A function can have multiple declarations with different non-throwing
<i ><a href='except.spec#nt:exception-specification'>exception-specifications</a></i>; for this purpose, the one on the
function definition is used. <i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><p ><span class='indexparent'><a class='index' id='unexpected()'></a></span>The function
<span class='texttt'>unexpected()</span>
may throw an exception that will satisfy the
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
for which it was invoked, and in this case the search for another handler
will continue at the call of the function with this
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
(see <a href='except.unexpected'>[except.unexpected]</a>), or it may call
<span class='texttt'>std::terminate()</span>.</p></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><p >An implementation shall not reject an expression merely because when
executed it throws or might
throw an exception that the containing function does not allow.
[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
extern void f() throw(X, Y);

void g() throw(X) {
  f();                          <span class='comment'>// OK
</span>}

</pre><p >the call to
<span class='texttt'>f</span>
is well-formed even though when called,
<span class='texttt'>f</span>
might throw exception
<span class='texttt'>Y</span>
that
<span class='texttt'>g</span>
does not allow.
<i>&nbsp;—&nbsp;end example</i>&nbsp;]</p></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><p >A function with no
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
or with an <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> of the form
<span class='texttt'>noexcept(</span><i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i><span class='texttt'>)</span> where
the <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i> yields <span class='texttt'>false</span>
allows all exceptions.
An <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> is <a class='hidden_link' href='#def:non-throwing' id='def:non-throwing'><i>non-throwing</i></a> if it is of the
form <span class='texttt'>throw()</span>, <span class='texttt'>noexcept</span>, or
<span class='texttt'>noexcept(</span><i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i><span class='texttt'>)</span> where the
<i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i> yields <span class='texttt'>true</span>.
A function with a non-throwing
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
does not allow any exceptions.</p></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><p >An
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
is not considered part of a function's type.</p></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><p >An implicitly declared special member function (Clause <a href='special'>[special]</a>) shall have an
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>.
If
<span class='texttt'>f</span>
is an implicitly declared default constructor, copy constructor,
move constructor,
destructor,
copy assignment operator,
or move assignment operator,
its implicit
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> specifies
the
<i ><a href='dcl.name#nt:type-id'>type-id</a></i>
<span class='texttt'>T</span>
if and only if
<span class='texttt'>T</span>
is allowed by the <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> of a function directly
invoked by <span class='texttt'>f</span>'s
implicit
definition;
<span class='texttt'>f</span>
shall allow all exceptions if any function it directly invokes allows all
exceptions, and
<span class='texttt'>f</span>
shall allow no exceptions if every function it directly invokes allows no
exceptions.
[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
struct A {
  A();
  A(const A&amp;) throw();
  A(A&amp;&amp;) throw();
  ~A() throw(X);
};
struct B {
  B() throw();
  B(const B&amp;) throw();
  B(B&amp;&amp;) throw(Y);
  ~B() throw(Y);
};
struct D : public A, public B {
    <span class='comment'>// Implicit declaration of <span class='texttt'>D::D();</span>
</span>    <span class='comment'>// Implicit declaration of <span class='texttt'>D::D(const D&amp;) throw();</span>
</span>    <span class='comment'>// Implicit declaration of <span class='texttt'>D::D(D&amp;&amp;) throw(Y);</span>
</span>    <span class='comment'>// Implicit declaration of <span class='texttt'>D::<span class='math'>~</span>D() throw(X, Y);</span>
</span>};
</pre><p >Furthermore, if
<span class='texttt'>A::~A()</span>
or
<span class='texttt'>B::~B()</span>
were virtual,
<span class='texttt'>D::~D()</span>
would not be as restrictive as that of
<span class='texttt'>A::~A</span>,
and the program would be ill-formed since a function that overrides a virtual
function from a base class shall have an <i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i>
 at least as restrictive as that in the base class.
<i>&nbsp;—&nbsp;end example</i>&nbsp;]</p></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><p >A deallocation function (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>) with no explicit 
<i ><a href='except.spec#nt:exception-specification'>exception-specification</a></i> is treated as if it were specified with
<span class='texttt'>noexcept(true)</span>.</p></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><p >In a <i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specification</a></i>, a
<i ><a href='dcl.name#nt:type-id'>type-id</a></i> followed by an ellipsis is a
pack expansion (<a href='temp.variadic'>[temp.variadic]</a>).</p></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><p >[&nbsp;<i>Note:</i> The use of <i ><a href='except.spec#nt:dynamic-exception-specification'>dynamic-exception-specifications</a></i> is deprecated
(see Annex <a href='depr'>[depr]</a>). <i>&nbsp;—&nbsp;end note</i>&nbsp;]<span class='indexparent'><a class='index' id='exception_specification'></a></span></p></div></div></div></body></html>