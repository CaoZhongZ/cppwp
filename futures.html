<!DOCTYPE html><html lang='en'><head><title>[futures]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>33</a> Thread support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>33.6</a> Futures <a class='abbr_ref'>[futures]</a></h2><div id='overview' class='section'><h3 ><a class='secnum' href='#overview' style='min-width:103pt'>33.6.1</a> Overview <a class='abbr_ref' href='futures.overview'>[futures.overview]</a></h3><div class='para' id='overview-1'><div class='marginalizedparent'><a class='marginalized' href='#overview-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3620'>#</a></div><div id='overview-1.sentence-1' class='sentence'><a href='futures'>[futures]</a> describes components that a C++ program can use to retrieve in one thread the
result (value or exception) from a function that has run in the same thread or another thread<a class='hidden_link' href='#overview-1.sentence-1'>.</a></div> <div id='overview-1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#overview-1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='overview-1.sentence-2' class='sentence'>These components are not restricted to multi-threaded programs but can be useful in
single-threaded programs as well<a class='hidden_link' href='#overview-1.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div id='future.syn' class='section'><h3 ><a class='secnum' href='#future.syn' style='min-width:103pt'>33.6.2</a> Header <span class='texttt'>&lt;future&gt;</span> synopsis <a class='abbr_ref' href='future.syn'>[future.syn]</a></h3><span class='indexparent'><a class='index' id=':<future>'></a></span><span class='indexparent'><a class='index' id='lib:<future>'></a></span><span class='indexparent'><a class='index' id='lib:future_errc'></a></span><pre class='codeblock'>
namespace std {
  enum class future_errc {
    broken_promise = <span class='textit'>implementation-defined</span>,
    future_already_retrieved = <span class='textit'>implementation-defined</span>,
    promise_already_satisfied = <span class='textit'>implementation-defined</span>,
    no_state = <span class='textit'>implementation-defined</span>
  };

  enum class launch : <span class='textit'><span class='texttt'>unspecified</span></span> {
    async = <span class='textit'><span class='texttt'>unspecified</span></span>,
    deferred = <span class='textit'><span class='texttt'>unspecified</span></span>,
    <span class='textit'>implementation-defined</span>
  };

  enum class future_status {
    ready,
    timeout,
    deferred
  };

  template &lt;&gt; struct is_error_code_enum&lt;future_errc&gt; : public true_type { };
  error_code make_error_code(future_errc e) noexcept;
  error_condition make_error_condition(future_errc e) noexcept;

  const error_category&amp; future_category() noexcept;

  class future_error;

  template &lt;class R&gt; class promise;
  template &lt;class R&gt; class promise&lt;R&amp;&gt;;
  template &lt;&gt; class promise&lt;void&gt;;

  template &lt;class R&gt;
    void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;

  template &lt;class R, class Alloc&gt;
    struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;;

  template &lt;class R&gt; class future;
  template &lt;class R&gt; class future&lt;R&amp;&gt;;
  template &lt;&gt; class future&lt;void&gt;;

  template &lt;class R&gt; class shared_future;
  template &lt;class R&gt; class shared_future&lt;R&amp;&gt;;
  template &lt;&gt; class shared_future&lt;void&gt;;

  template &lt;class&gt; class packaged_task;   <span class='comment'>// not defined
</span>  template &lt;class R, class... ArgTypes&gt;
    class packaged_task&lt;R(ArgTypes...)&gt;;

  template &lt;class R, class... ArgTypes&gt;
    void swap(packaged_task&lt;R(ArgTypes...)&gt;&amp;, packaged_task&lt;R(ArgTypes...)&gt;&amp;) noexcept;

  template &lt;class R, class Alloc&gt;
    struct uses_allocator&lt;packaged_task&lt;R&gt;, Alloc&gt;;

  template &lt;class F, class... Args&gt;
    future&lt;invoke_result_t&lt;decay_t&lt;F&gt;, decay_t&lt;Args&gt;...&gt;&gt;
    async(F&amp;&amp; f, Args&amp;&amp;... args);
  template &lt;class F, class... Args&gt;
    future&lt;invoke_result_t&lt;decay_t&lt;F&gt;, decay_t&lt;Args&gt;...&gt;&gt;
    async(launch policy, F&amp;&amp; f, Args&amp;&amp;... args);
}</pre><div class='para' id='future.syn-1'><div class='marginalizedparent'><a class='marginalized' href='#future.syn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3697'>#</a></div><div id='future.syn-1.sentence-1' class='sentence'>The <span class='texttt'>enum</span> type <span class='texttt'>launch</span> is a <a href='bitmask.types'>bitmask type</a> with
elements <span class='texttt'>launch&#x200b;::&#x200b;async</span> and <span class='texttt'>launch&#x200b;::&#x200b;deferred</span><a class='hidden_link' href='#future.syn-1.sentence-1'>.</a></div> <div id='future.syn-1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#future.syn-1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='future.syn-1.sentence-2' class='sentence'>Implementations can provide bitmasks to specify restrictions on task
interaction by functions launched by <span class='texttt'>async()</span> applicable to a
corresponding subset of available launch policies<a class='hidden_link' href='#future.syn-1.sentence-2'>.</a></div> <div id='future.syn-1.sentence-3' class='sentence'>Implementations can extend
the behavior of the first overload of <span class='texttt'>async()</span> by adding their extensions
to the launch policy under the “as if” rule<a class='hidden_link' href='#future.syn-1.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='future.syn-2'><div class='marginalizedparent'><a class='marginalized' href='#future.syn-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3706'>#</a></div><div id='future.syn-2.sentence-1' class='sentence'>The enum values of <span class='texttt'>future_&shy;errc</span> are distinct and not zero<a class='hidden_link' href='#future.syn-2.sentence-1'>.</a></div></div></div><div id='errors' class='section'><h3 ><a class='secnum' href='#errors' style='min-width:103pt'>33.6.3</a> Error handling <a class='abbr_ref' href='futures.errors'>[futures.errors]</a></h3><span class='indexparent'><a class='index' id='lib:future_category'></a></span><code class='itemdecl'>const error_category&amp; future_category() noexcept;
</code><div class='itemdescr'></div><div class='para' id='errors-1'><div class='marginalizedparent'><a class='marginalized' href='#errors-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3717'>#</a></div><div id='errors-1.sentence-1' class='sentence'><span class='textit'>Returns:</span> &nbsp;A reference to an object of a type derived from class <span class='texttt'>error_&shy;category</span><a class='hidden_link' href='#errors-1.sentence-1'>.</a></div></div></div><div class='para' id='errors-2'><div class='marginalizedparent'><a class='marginalized' href='#errors-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3720'>#</a></div><div id='errors-2.sentence-1' class='sentence'>The object's <span class='texttt'>default_&shy;error_&shy;condition</span> and equivalent virtual functions shall
behave as specified for the class <span class='texttt'>error_&shy;category</span><a class='hidden_link' href='#errors-2.sentence-1'>.</a></div> <div id='errors-2.sentence-2' class='sentence'>The object's <span class='texttt'>name</span>
virtual function shall return a pointer to the string <span class='texttt'>"future"</span><a class='hidden_link' href='#errors-2.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:make_error_code,future_errc'></a></span><span class='indexparent'><a class='index' id='lib:future_errc,make_error_code'></a></span><code class='itemdecl'>error_code make_error_code(future_errc e) noexcept;
</code><div class='itemdescr'></div><div class='para' id='errors-3'><div class='marginalizedparent'><a class='marginalized' href='#errors-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3732'>#</a></div><div id='errors-3.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>error_&shy;code(static_&shy;cast&lt;int&gt;(e), future_&shy;category())</span><a class='hidden_link' href='#errors-3.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:make_error_condition,future_errc'></a></span><span class='indexparent'><a class='index' id='lib:future_errc,make_error_condition'></a></span><code class='itemdecl'>error_condition make_error_condition(future_errc e) noexcept;
</code><div class='itemdescr'></div><div class='para' id='errors-4'><div class='marginalizedparent'><a class='marginalized' href='#errors-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3742'>#</a></div><div id='errors-4.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>error_&shy;condition(static_&shy;cast&lt;int&gt;(e), future_&shy;category())</span><a class='hidden_link' href='#errors-4.sentence-1'>.</a></div></div></div></div><div id='future_error' class='section'><h3 ><a class='secnum' href='#future_error' style='min-width:103pt'>33.6.4</a> Class <span class='texttt'>future_&shy;error</span> <a class='abbr_ref' href='futures.future_error'>[futures.future_error]</a></h3><span class='indexparent'><a class='index' id='lib:future_error'></a></span><pre class='codeblock'>
namespace std {
  class future_error : public logic_error {
  public:
    explicit future_error(future_errc e);

    const error_code&amp; code() const noexcept;
    const char*       what() const noexcept;
  private:
    error_code ec_;  <span class='comment'>// <span class='textit'>exposition only</span>
</span>  };
}</pre><span class='indexparent'><a class='index' id='lib:future_error,constructor'></a></span><code class='itemdecl'>explicit future_error(future_errc e);
</code><div class='itemdescr'></div><div class='para' id='future_error-1'><div class='marginalizedparent'><a class='marginalized' href='#future_error-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3769'>#</a></div><div id='future_error-1.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs an object of class <span class='texttt'>future_&shy;error</span>
and initializes <span class='texttt'>ec_&shy;</span> with <span class='texttt'>make_&shy;error_&shy;code(e)</span><a class='hidden_link' href='#future_error-1.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:code,future_error'></a></span><span class='indexparent'><a class='index' id='lib:future_error,code'></a></span><code class='itemdecl'>const error_code&amp; code() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='future_error-2'><div class='marginalizedparent'><a class='marginalized' href='#future_error-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3780'>#</a></div><div id='future_error-2.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>ec_&shy;</span><a class='hidden_link' href='#future_error-2.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:what,future_error'></a></span><span class='indexparent'><a class='index' id='lib:future_error,what'></a></span><code class='itemdecl'>const char* what() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='future_error-3'><div class='marginalizedparent'><a class='marginalized' href='#future_error-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3790'>#</a></div><div id='future_error-3.sentence-1' class='sentence'><span class='textit'>Returns:</span> An <span class='textsc'>ntbs</span> incorporating <span class='texttt'>code().message()</span><a class='hidden_link' href='#future_error-3.sentence-1'>.</a></div></div></div></div><div id='state' class='section'><h3 ><a class='secnum' href='#state' style='min-width:103pt'>33.6.5</a> Shared state <a class='abbr_ref' href='futures.state'>[futures.state]</a></h3><div class='para' id='state-1'><div class='marginalizedparent'><a class='marginalized' href='#state-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3796'>#</a></div><div id='state-1.sentence-1' class='sentence'>Many of the classes introduced in this subclause use some state to communicate results<a class='hidden_link' href='#state-1.sentence-1'>.</a></div> <div id='state-1.sentence-2' class='sentence'>This

<a class='hidden_link' href='#def:future,shared_state' id='def:future,shared_state'><i >shared state</i></a> consists of some state information and some (possibly not
yet evaluated) <a class='hidden_link' href='#def:result' id='def:result'><i>result</i></a>, which can be a (possibly void) value or an exception<a class='hidden_link' href='#state-1.sentence-2'>.</a></div> <div id='state-1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#state-1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='state-1.sentence-3' class='sentence'>Futures, promises, and tasks defined in this clause reference such shared state<a class='hidden_link' href='#state-1.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='state-2'><div class='marginalizedparent'><a class='marginalized' href='#state-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3803'>#</a></div><div id='state-2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#state-2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='state-2.sentence-1' class='sentence'>The result can be any kind of object including a function to compute that result,
as used by <span class='texttt'>async</span> when <span class='texttt'>policy</span> is <span class='texttt'>launch&#x200b;::&#x200b;deferred</span><a class='hidden_link' href='#state-2.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='state-3'><div class='marginalizedparent'><a class='marginalized' href='#state-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3807'>#</a></div><div id='state-3.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:asynchronous_return_object' id='def:asynchronous_return_object'><i >asynchronous return object</i></a> is an object that reads results from a
shared state<a class='hidden_link' href='#state-3.sentence-1'>.</a></div> <div id='state-3.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:waiting_function' id='def:waiting_function'><i >waiting function</i></a> of an asynchronous return object is one
that potentially blocks to wait for the shared state to be made
ready<a class='hidden_link' href='#state-3.sentence-2'>.</a></div> <div id='state-3.sentence-3' class='sentence'>If a waiting function can return before the state is made ready because of a
timeout (<a href='thread.req.lockable'>[thread.req.lockable]</a>), then it is a <a class='hidden_link' href='#def:timed_waiting_function' id='def:timed_waiting_function'><i>timed waiting function</i></a>, otherwise
it is a <a class='hidden_link' href='#def:non-timed_waiting_function' id='def:non-timed_waiting_function'><i>non-timed waiting function</i></a><a class='hidden_link' href='#state-3.sentence-3'>.</a></div></div><div class='para' id='state-4'><div class='marginalizedparent'><a class='marginalized' href='#state-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3816'>#</a></div><div id='state-4.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:asynchronous_provider' id='def:asynchronous_provider'><i >asynchronous provider</i></a> is an object that provides a result to a shared
state<a class='hidden_link' href='#state-4.sentence-1'>.</a></div> <div id='state-4.sentence-2' class='sentence'>The result of a shared state is set by
respective functions on the asynchronous provider<a class='hidden_link' href='#state-4.sentence-2'>.</a></div> <div id='state-4.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#state-4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='state-4.sentence-4' class='sentence'>Such as promises or tasks<a class='hidden_link' href='#state-4.sentence-4'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='state-4.sentence-3' class='sentence'> The means of setting the result of a shared state is specified
in the description of those classes and functions that create such a state object<a class='hidden_link' href='#state-4.sentence-3'>.</a></div></div><div class='para' id='state-5'><div class='marginalizedparent'><a class='marginalized' href='#state-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3824'>#</a></div><div id='state-5.sentence-1' class='sentence'>When an asynchronous return object or an asynchronous provider is said to release its
shared state, it means:</div><div id='state-5.sentence-2' class='sentence'><ul class='itemize'><li id='state-5.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-5.1'>(5.1)</a></div><div id='state-5.1.sentence-1' class='sentence'>if the return object or provider holds the last reference to its shared state,
the shared state is destroyed; and</div></li><li id='state-5.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-5.2'>(5.2)</a></div><div id='state-5.2.sentence-1' class='sentence'>the return object or provider gives up its reference to its shared state; and</div></li><li id='state-5.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-5.3'>(5.3)</a></div><div id='state-5.3.sentence-1' class='sentence'>these actions will not block for the shared state to become ready, except that it
may block if all of the following are true: the shared state was created by a call to
<span class='texttt'>std&#x200b;::&#x200b;async</span>, the shared state is not yet ready, and this was the last reference
to the shared state<a class='hidden_link' href='#state-5.3.sentence-1'>.</a></div></li></ul></div></div><div class='para' id='state-6'><div class='marginalizedparent'><a class='marginalized' href='#state-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3842'>#</a></div><div id='state-6.sentence-1' class='sentence'>When an asynchronous provider is said to make its shared state ready, it means:</div><div id='state-6.sentence-2' class='sentence'><ul class='itemize'><li id='state-6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-6.1'>(6.1)</a></div><div id='state-6.1.sentence-1' class='sentence'>first, the provider marks its shared state as ready; and</div></li><li id='state-6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-6.2'>(6.2)</a></div><div id='state-6.2.sentence-1' class='sentence'>second, the provider unblocks any execution agents waiting for its shared
state to become ready<a class='hidden_link' href='#state-6.2.sentence-1'>.</a></div></li></ul></div></div><div class='para' id='state-7'><div class='marginalizedparent'><a class='marginalized' href='#state-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3854'>#</a></div><div id='state-7.sentence-1' class='sentence'>When an asynchronous provider is said to abandon its shared state, it means:</div><div id='state-7.sentence-2' class='sentence'><ul class='itemize'><li id='state-7.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-7.1'>(7.1)</a></div><div id='state-7.1.sentence-1' class='sentence'>first, if that state is not ready, the provider</div><div id='state-7.1.sentence-2' class='sentence'><ul class='itemize'><li id='state-7.1.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#state-7.1.1'>(7.1.1)</a></div><div id='state-7.1.1.sentence-1' class='sentence'>stores an exception object of type <span class='texttt'>future_&shy;error</span> with an error condition of
<span class='texttt'>broken_&shy;promise</span> within its shared state; and then</div></li><li id='state-7.1.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#state-7.1.2'>(7.1.2)</a></div><div id='state-7.1.2.sentence-1' class='sentence'>makes its shared state ready;</div></li></ul></div></li><li id='state-7.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#state-7.2'>(7.2)</a></div><div id='state-7.2.sentence-1' class='sentence'>second, the provider releases its shared state<a class='hidden_link' href='#state-7.2.sentence-1'>.</a></div></li></ul></div></div><div class='para' id='state-8'><div class='marginalizedparent'><a class='marginalized' href='#state-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3874'>#</a></div><div id='state-8.sentence-1' class='sentence'>A shared state is <a class='hidden_link' href='#def:ready' id='def:ready'><i >ready</i></a> only if it holds a value or an exception ready for
retrieval<a class='hidden_link' href='#state-8.sentence-1'>.</a></div> <div id='state-8.sentence-2' class='sentence'>Waiting for a shared state to become ready may invoke code to compute the result on
the waiting thread if so specified in the description of the class or function that creates
the state object<a class='hidden_link' href='#state-8.sentence-2'>.</a></div></div><div class='para' id='state-9'><div class='marginalizedparent'><a class='marginalized' href='#state-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3881'>#</a></div><div id='state-9.sentence-1' class='sentence'>Calls to functions that successfully set the stored result of a shared
state <a href='intro.multithread#def:synchronize_with'>synchronize with</a> calls to functions
successfully detecting the ready state resulting from that setting<a class='hidden_link' href='#state-9.sentence-1'>.</a></div> <div id='state-9.sentence-2' class='sentence'>The storage of the result
(whether normal or exceptional) into the shared state
<a href='intro.multithread#def:synchronize_with'>synchronizes with</a>
the successful return from a call to a waiting function on the shared state<a class='hidden_link' href='#state-9.sentence-2'>.</a></div></div><div class='para' id='state-10'><div class='marginalizedparent'><a class='marginalized' href='#state-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3890'>#</a></div><div id='state-10.sentence-1' class='sentence'>Some functions (e.g., <span class='texttt'>promise&#x200b;::&#x200b;set_&shy;value_&shy;at_&shy;thread_&shy;exit</span>) delay making
the shared state ready until the calling thread exits<a class='hidden_link' href='#state-10.sentence-1'>.</a></div> <div id='state-10.sentence-2' class='sentence'>The destruction of
each of that thread's objects with <a href='basic.stc.thread'>thread storage duration</a>
is sequenced before making that shared state ready<a class='hidden_link' href='#state-10.sentence-2'>.</a></div></div><div class='para' id='state-11'><div class='marginalizedparent'><a class='marginalized' href='#state-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3896'>#</a></div><div id='state-11.sentence-1' class='sentence'>Access to the result of the same shared state may <a href='intro.multithread#def:conflict'>conflict</a><a class='hidden_link' href='#state-11.sentence-1'>.</a></div> <div id='state-11.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#state-11.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='state-11.sentence-2' class='sentence'>This explicitly specifies that the result of the shared state is
visible in the objects that reference this state in the sense of <a href='res.on.data.races'>data race
avoidance</a><a class='hidden_link' href='#state-11.sentence-2'>.</a></div> <div id='state-11.sentence-3' class='sentence'>For example, concurrent accesses through
references returned by <span class='texttt'>shared_&shy;future&#x200b;::&#x200b;get()</span> (<a href='futures.shared_future'>[futures.shared_future]</a>) must either use read-only operations or provide additional synchronization<a class='hidden_link' href='#state-11.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div id='promise' class='section'><h3 ><a class='secnum' href='#promise' style='min-width:103pt'>33.6.6</a> Class template <span class='texttt'>promise</span> <a class='abbr_ref' href='futures.promise'>[futures.promise]</a></h3><span class='indexparent'><a class='index' id='lib:promise'></a></span><pre class='codeblock'>
namespace std {
  template &lt;class R&gt;
  class promise {
  public:
    promise();
    template &lt;class Allocator&gt;
      promise(allocator_arg_t, const Allocator&amp; a);
    promise(promise&amp;&amp; rhs) noexcept;
    promise(const promise&amp; rhs) = delete;
    ~promise();

    <span class='comment'>// assignment
</span>    promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
    promise&amp; operator=(const promise&amp; rhs) = delete;
    void swap(promise&amp; other) noexcept;

    <span class='comment'>// retrieving the result
</span>    future&lt;R&gt; get_future();

    <span class='comment'>// setting the result
</span>    void set_value(<span class='textit'><span class='texttt'>see below</span></span>);
    void set_exception(exception_ptr p);

    <span class='comment'>// setting the result with deferred notification
</span>    void set_value_at_thread_exit(<span class='textit'><span class='texttt'>see below</span></span>);
    void set_exception_at_thread_exit(exception_ptr p);
  };
  template &lt;class R&gt;
    void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;
  template &lt;class R, class Alloc&gt;
    struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;;
}</pre><div class='para' id='promise-1'><div class='marginalizedparent'><a class='marginalized' href='#promise-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3943'>#</a></div><div id='promise-1.sentence-1' class='sentence'>The implementation shall provide the template <span class='texttt'>promise</span> and two specializations,
<span class='texttt'>promise&lt;R&amp;&gt;</span> and <span class='texttt'>promise&lt;&#x200b;void&gt;</span><a class='hidden_link' href='#promise-1.sentence-1'>.</a></div> <div id='promise-1.sentence-2' class='sentence'>These differ only in the argument type
of the member functions <span class='texttt'>set_&shy;value</span> and <span class='texttt'>set_&shy;value_&shy;at_&shy;thread_&shy;exit</span>,
as set out in their descriptions, below<a class='hidden_link' href='#promise-1.sentence-2'>.</a></div></div><div class='para' id='promise-2'><div class='marginalizedparent'><a class='marginalized' href='#promise-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3949'>#</a></div><div id='promise-2.sentence-1' class='sentence'>The <span class='texttt'>set_&shy;value</span>, <span class='texttt'>set_&shy;exception</span>, <span class='texttt'>set_&shy;value_&shy;at_&shy;thread_&shy;exit</span>,
and <span class='texttt'>set_&shy;exception_&shy;at_&shy;thread_&shy;exit</span> member functions behave as though
they acquire a single mutex associated with the promise object while updating the
promise object<a class='hidden_link' href='#promise-2.sentence-1'>.</a></div> <span class='indexparent'><a class='index' id='lib:uses_allocator,promise'></a></span></div><code class='itemdecl'>template &lt;class R, class Alloc&gt;
  struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;
    : true_type { };
</code><div class='itemdescr'></div><div class='para' id='promise-3'><div class='marginalizedparent'><a class='marginalized' href='#promise-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3963'>#</a></div><div id='promise-3.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>Alloc</span> shall be an <a href='allocator.requirements'>Allocator</a><a class='hidden_link' href='#promise-3.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,constructor'></a></span><code class='itemdecl'>promise();
template &lt;class Allocator&gt;
  promise(allocator_arg_t, const Allocator&amp; a);
</code><div class='itemdescr'></div><div class='para' id='promise-4'><div class='marginalizedparent'><a class='marginalized' href='#promise-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3976'>#</a></div><div id='promise-4.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a <span class='texttt'>promise</span> object and a shared state<a class='hidden_link' href='#promise-4.sentence-1'>.</a></div> <div id='promise-4.sentence-2' class='sentence'>The second
constructor uses the allocator <span class='texttt'>a</span> to allocate memory for the shared
state<a class='hidden_link' href='#promise-4.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,constructor_'></a></span><code class='itemdecl'>promise(promise&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='promise-5'><div class='marginalizedparent'><a class='marginalized' href='#promise-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3988'>#</a></div><div id='promise-5.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a new <span class='texttt'>promise</span> object and transfers ownership of the shared state
of <span class='texttt'>rhs</span> (if any) to the newly-constructed object<a class='hidden_link' href='#promise-5.sentence-1'>.</a></div></div></div><div class='para' id='promise-6'><div class='marginalizedparent'><a class='marginalized' href='#promise-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L3992'>#</a></div><div id='promise-6.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#promise-6.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:promise,destructor'></a></span><code class='itemdecl'>~promise();
</code><div class='itemdescr'></div><div class='para' id='promise-7'><div class='marginalizedparent'><a class='marginalized' href='#promise-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4002'>#</a></div><div id='promise-7.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Abandons any shared state (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#promise-7.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,operator='></a></span><code class='itemdecl'>promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='promise-8'><div class='marginalizedparent'><a class='marginalized' href='#promise-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4013'>#</a></div><div id='promise-8.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Abandons any shared state (<a href='futures.state'>[futures.state]</a>) and then as if
<span class='texttt'>promise(std&#x200b;::&#x200b;move(rhs)).swap(*this)</span><a class='hidden_link' href='#promise-8.sentence-1'>.</a></div></div></div><div class='para' id='promise-9'><div class='marginalizedparent'><a class='marginalized' href='#promise-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4018'>#</a></div><div id='promise-9.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>*this</span><a class='hidden_link' href='#promise-9.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:swap,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,swap'></a></span><code class='itemdecl'>void swap(promise&amp; other) noexcept;
</code><div class='itemdescr'></div><div class='para' id='promise-10'><div class='marginalizedparent'><a class='marginalized' href='#promise-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4028'>#</a></div><div id='promise-10.sentence-1' class='sentence'><span class='textit'>Effects:</span> Exchanges the shared state of <span class='texttt'>*this</span> and <span class='texttt'>other</span><a class='hidden_link' href='#promise-10.sentence-1'>.</a></div></div></div><div class='para' id='promise-11'><div class='marginalizedparent'><a class='marginalized' href='#promise-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4031'>#</a></div><div id='promise-11.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>*this</span> has the shared state (if any) that <span class='texttt'>other</span> had
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#promise-11.sentence-1'>.</a></div> <div id='promise-11.sentence-2' class='sentence'><span class='texttt'>other</span> has the shared state (if any) that
<span class='texttt'>*this</span> had prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#promise-11.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:get_future,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,get_future'></a></span><code class='itemdecl'>future&lt;R&gt; get_future();
</code><div class='itemdescr'></div><div class='para' id='promise-12'><div class='marginalizedparent'><a class='marginalized' href='#promise-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4043'>#</a></div><div id='promise-12.sentence-1' class='sentence'><span class='textit'>Returns:</span> A <span class='texttt'>future&lt;R&gt;</span> object with the same shared state as
<span class='texttt'>*this</span><a class='hidden_link' href='#promise-12.sentence-1'>.</a></div></div></div><div class='para' id='promise-13'><div class='marginalizedparent'><a class='marginalized' href='#promise-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4047'>#</a></div><div id='promise-13.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if <span class='texttt'>*this</span> has no shared state or if
<span class='texttt'>get_&shy;future</span> has already been called on a <span class='texttt'>promise</span> with the same
shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#promise-13.sentence-1'>.</a></div></div></div><div class='para' id='promise-14'><div class='marginalizedparent'><a class='marginalized' href='#promise-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4052'>#</a></div><div id='promise-14.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> </div><div id='promise-14.sentence-2' class='sentence'><ul class='itemize'><li id='promise-14.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-14.1'>(14.1)</a></div><div id='promise-14.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;already_&shy;retrieved</span> if <span class='texttt'>get_&shy;future</span> has already been called on
a <span class='texttt'>promise</span> with the same shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#promise-14.1.sentence-1'>.</a></div></li><li id='promise-14.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-14.2'>(14.2)</a></div><div id='promise-14.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#promise-14.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_value,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_value'></a></span><code class='itemdecl'>void promise::set_value(const R&amp; r);
void promise::set_value(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value(R&amp; r);
void promise&lt;void&gt;::set_value();
</code><div class='itemdescr'></div><div class='para' id='promise-15'><div class='marginalizedparent'><a class='marginalized' href='#promise-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4072'>#</a></div><div id='promise-15.sentence-1' class='sentence'><span class='textit'>Effects:</span> Atomically stores the value <span class='texttt'>r</span> in the shared state and
makes that state ready (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#promise-15.sentence-1'>.</a></div></div></div><div class='para' id='promise-16'><div class='marginalizedparent'><a class='marginalized' href='#promise-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4076'>#</a></div><div id='promise-16.sentence-1' class='sentence'><span class='textit'>Throws:</span> </div><div id='promise-16.sentence-2' class='sentence'><ul class='itemize'><li id='promise-16.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-16.1'>(16.1)</a></div><div id='promise-16.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception, or</div></li><li id='promise-16.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-16.2'>(16.2)</a></div><div id='promise-16.2.sentence-1' class='sentence'>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</div></li><li id='promise-16.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-16.3'>(16.3)</a></div><div id='promise-16.3.sentence-1' class='sentence'>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#promise-16.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='promise-17'><div class='marginalizedparent'><a class='marginalized' href='#promise-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4086'>#</a></div><div id='promise-17.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='promise-17.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-17.1'>(17.1)</a></div><div id='promise-17.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-17.1.sentence-1'>.</a></div></li><li id='promise-17.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-17.2'>(17.2)</a></div><div id='promise-17.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#promise-17.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_exception,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_exception'></a></span><code class='itemdecl'>void set_exception(exception_ptr p);
</code><div class='itemdescr'></div><div class='para' id='promise-18'><div class='marginalizedparent'><a class='marginalized' href='#promise-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4101'>#</a></div><div id='promise-18.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>p</span> is not null<a class='hidden_link' href='#promise-18.sentence-1'>.</a></div></div></div><div class='para' id='promise-19'><div class='marginalizedparent'><a class='marginalized' href='#promise-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4104'>#</a></div><div id='promise-19.sentence-1' class='sentence'><span class='textit'>Effects:</span> Atomically stores the exception pointer <span class='texttt'>p</span> in the shared state
and makes that state ready (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#promise-19.sentence-1'>.</a></div></div></div><div class='para' id='promise-20'><div class='marginalizedparent'><a class='marginalized' href='#promise-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4108'>#</a></div><div id='promise-20.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-20.sentence-1'>.</a></div></div></div><div class='para' id='promise-21'><div class='marginalizedparent'><a class='marginalized' href='#promise-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4112'>#</a></div><div id='promise-21.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> </div><div id='promise-21.sentence-2' class='sentence'><ul class='itemize'><li id='promise-21.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-21.1'>(21.1)</a></div><div id='promise-21.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-21.1.sentence-1'>.</a></div></li><li id='promise-21.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-21.2'>(21.2)</a></div><div id='promise-21.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#promise-21.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_value_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_value_at_thread_exit'></a></span><code class='itemdecl'>void promise::set_value_at_thread_exit(const R&amp; r);
void promise::set_value_at_thread_exit(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value_at_thread_exit(R&amp; r);
void promise&lt;void&gt;::set_value_at_thread_exit();
</code><div class='itemdescr'></div><div class='para' id='promise-22'><div class='marginalizedparent'><a class='marginalized' href='#promise-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4131'>#</a></div><div id='promise-22.sentence-1' class='sentence'><span class='textit'>Effects:</span> Stores the value <span class='texttt'>r</span> in the shared state without making that
state ready immediately<a class='hidden_link' href='#promise-22.sentence-1'>.</a></div> <div id='promise-22.sentence-2' class='sentence'>Schedules that state to be made ready when the current
thread exits, after all objects of thread storage duration associated with the
current thread have been destroyed<a class='hidden_link' href='#promise-22.sentence-2'>.</a></div></div></div><div class='para' id='promise-23'><div class='marginalizedparent'><a class='marginalized' href='#promise-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4137'>#</a></div><div id='promise-23.sentence-1' class='sentence'><span class='textit'>Throws:</span> </div><div id='promise-23.sentence-2' class='sentence'><ul class='itemize'><li id='promise-23.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-23.1'>(23.1)</a></div><div id='promise-23.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;error</span> if its shared state
already has a stored value or exception, or</div></li><li id='promise-23.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-23.2'>(23.2)</a></div><div id='promise-23.2.sentence-1' class='sentence'>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</div></li><li id='promise-23.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-23.3'>(23.3)</a></div><div id='promise-23.3.sentence-1' class='sentence'>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#promise-23.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='promise-24'><div class='marginalizedparent'><a class='marginalized' href='#promise-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4147'>#</a></div><div id='promise-24.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='promise-24.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-24.1'>(24.1)</a></div><div id='promise-24.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-24.1.sentence-1'>.</a></div></li><li id='promise-24.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-24.2'>(24.2)</a></div><div id='promise-24.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#promise-24.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:set_exception_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='lib:promise,set_exception_at_thread_exit'></a></span><code class='itemdecl'>void set_exception_at_thread_exit(exception_ptr p);
</code><div class='itemdescr'></div><div class='para' id='promise-25'><div class='marginalizedparent'><a class='marginalized' href='#promise-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4162'>#</a></div><div id='promise-25.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>p</span> is not null<a class='hidden_link' href='#promise-25.sentence-1'>.</a></div></div></div><div class='para' id='promise-26'><div class='marginalizedparent'><a class='marginalized' href='#promise-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4165'>#</a></div><div id='promise-26.sentence-1' class='sentence'><span class='textit'>Effects:</span> Stores the exception pointer <span class='texttt'>p</span> in the shared state without
making that state ready immediately<a class='hidden_link' href='#promise-26.sentence-1'>.</a></div> <div id='promise-26.sentence-2' class='sentence'>Schedules that state to be made ready when
the current thread exits, after all objects of thread storage duration
associated with the current thread have been destroyed<a class='hidden_link' href='#promise-26.sentence-2'>.</a></div></div></div><div class='para' id='promise-27'><div class='marginalizedparent'><a class='marginalized' href='#promise-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4171'>#</a></div><div id='promise-27.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if an error condition occurs<a class='hidden_link' href='#promise-27.sentence-1'>.</a></div></div></div><div class='para' id='promise-28'><div class='marginalizedparent'><a class='marginalized' href='#promise-28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4174'>#</a></div><div id='promise-28.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='promise-28.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-28.1'>(28.1)</a></div><div id='promise-28.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-28.1.sentence-1'>.</a></div></li><li id='promise-28.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#promise-28.2'>(28.2)</a></div><div id='promise-28.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#promise-28.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:swap,promise_'></a></span><span class='indexparent'><a class='index' id='lib:promise,swap_'></a></span><code class='itemdecl'>template &lt;class R&gt;
  void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;
</code><div class='itemdescr'></div><div class='para' id='promise-29'><div class='marginalizedparent'><a class='marginalized' href='#promise-29'>29</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4190'>#</a></div><div id='promise-29.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'>x.swap(y)</span><a class='hidden_link' href='#promise-29.sentence-1'>.</a></div></div></div></div><div id='unique_future' class='section'><h3 ><a class='secnum' href='#unique_future' style='min-width:103pt'>33.6.7</a> Class template <span class='texttt'>future</span> <a class='abbr_ref' href='futures.unique_future'>[futures.unique_future]</a></h3><div class='para' id='unique_future-1'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4196'>#</a></div><div id='unique_future-1.sentence-1' class='sentence'>The class template <span class='texttt'>future</span> defines a type for asynchronous return objects which
do not share their shared state with other asynchronous return objects<a class='hidden_link' href='#unique_future-1.sentence-1'>.</a></div> <div id='unique_future-1.sentence-2' class='sentence'>A default-constructed <span class='texttt'>future</span> object has no
shared state<a class='hidden_link' href='#unique_future-1.sentence-2'>.</a></div> <div id='unique_future-1.sentence-3' class='sentence'>A <span class='texttt'>future</span> object with shared state can be created by
functions on <a href='futures.state#def:asynchronous_provider'>asynchronous providers</a>
or by the move constructor and shares its shared state with
the original asynchronous provider<a class='hidden_link' href='#unique_future-1.sentence-3'>.</a></div> <div id='unique_future-1.sentence-4' class='sentence'>The result (value or exception) of
a <span class='texttt'>future</span> object
can be
set by
calling a respective function on an
object that shares the same
shared state<a class='hidden_link' href='#unique_future-1.sentence-4'>.</a></div></div><div class='para' id='unique_future-2'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4211'>#</a></div><div id='unique_future-2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#unique_future-2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='unique_future-2.sentence-1' class='sentence'>Member functions of <span class='texttt'>future</span> do not synchronize with themselves or with
member functions of <span class='texttt'>shared_&shy;future</span><a class='hidden_link' href='#unique_future-2.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='unique_future-3'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4215'>#</a></div><div id='unique_future-3.sentence-1' class='sentence'>The effect of calling any member function other than the destructor, the
move-assignment operator, <span class='texttt'>share</span>, or <span class='texttt'>valid</span> on a <span class='texttt'>future</span> object for which
<span class='texttt'>valid() == false</span>
is undefined<a class='hidden_link' href='#unique_future-3.sentence-1'>.</a></div> <div id='unique_future-3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#unique_future-3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='unique_future-3.sentence-2' class='sentence'>It is valid to move from a future object for which <span class='texttt'>valid() == false</span><a class='hidden_link' href='#unique_future-3.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='unique_future-3.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#unique_future-3.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='unique_future-3.sentence-3' class='sentence'>Implementations should detect this case and throw an object of type
<span class='texttt'>future_&shy;error</span> with an error condition of <span class='texttt'>future_&shy;errc&#x200b;::&#x200b;no_&shy;state</span><a class='hidden_link' href='#unique_future-3.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> <span class='indexparent'><a class='index' id='lib:future'></a></span><pre class='codeblock'>
namespace std {
  template &lt;class R&gt;
  class future {
  public:
    future() noexcept;
    future(future&amp;&amp;) noexcept;
    future(const future&amp; rhs) = delete;
    ~future();
    future&amp; operator=(const future&amp; rhs) = delete;
    future&amp; operator=(future&amp;&amp;) noexcept;
    shared_future&lt;R&gt; share() noexcept;

    <span class='comment'>// retrieving the value
</span>    <span class='textit'><span class='texttt'>see below</span></span> get();

    <span class='comment'>// functions to check state
</span>    bool valid() const noexcept;

    void wait() const;
    template &lt;class Rep, class Period&gt;
      future_status wait_for(const chrono::duration&lt;Rep, Period&gt;&amp; rel_time) const;
    template &lt;class Clock, class Duration&gt;
      future_status wait_until(const chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time) const;
  };
}</pre></div><div class='para' id='unique_future-4'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4254'>#</a></div><div id='unique_future-4.sentence-1' class='sentence'>The implementation shall provide the template <span class='texttt'>future</span> and two specializations,
<span class='texttt'>future&lt;R&amp;&gt;</span> and <span class='texttt'>future&lt;&#x200b;void&gt;</span><a class='hidden_link' href='#unique_future-4.sentence-1'>.</a></div> <div id='unique_future-4.sentence-2' class='sentence'>These differ only in the return type and return
value of the member function <span class='texttt'>get</span>, as set out in its description, below<a class='hidden_link' href='#unique_future-4.sentence-2'>.</a></div> <span class='indexparent'><a class='index' id='lib:future,constructor'></a></span></div><code class='itemdecl'>future() noexcept;
</code><div class='itemdescr'></div><div class='para' id='unique_future-5'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4265'>#</a></div><div id='unique_future-5.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs an <a class='hidden_link' href='#def:empty_future_object' id='def:empty_future_object'><i >empty</i></a>
<span class='texttt'>future</span> object that does not refer to a
shared state<a class='hidden_link' href='#unique_future-5.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-6'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4270'>#</a></div><div id='unique_future-6.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid() == false</span><a class='hidden_link' href='#unique_future-6.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:future,constructor_'></a></span><code class='itemdecl'>future(future&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='unique_future-7'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4280'>#</a></div><div id='unique_future-7.sentence-1' class='sentence'><span class='textit'>Effects:</span> Move constructs a <span class='texttt'>future</span> object that refers to the shared
state that
was originally referred to by <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#unique_future-7.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-8'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4285'>#</a></div><div id='unique_future-8.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> 
<ul class='itemize'><li id='unique_future-8.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-8.1'>(8.1)</a></div><div id='unique_future-8.1.sentence-1' class='sentence'><span class='texttt'>valid()</span> returns the same value as <span class='texttt'>rhs.valid()</span> prior to the
constructor invocation<a class='hidden_link' href='#unique_future-8.1.sentence-1'>.</a></div></li><li id='unique_future-8.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-8.2'>(8.2)</a></div><div id='unique_future-8.2.sentence-1' class='sentence'><span class='texttt'>rhs.valid() == false</span><a class='hidden_link' href='#unique_future-8.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:future,constructor__'></a></span><code class='itemdecl'>~future();
</code><div class='itemdescr'></div><div class='para' id='unique_future-9'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4300'>#</a></div><div id='unique_future-9.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='unique_future-9.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-9.1'>(9.1)</a></div><div id='unique_future-9.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>);</div></li><li id='unique_future-9.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-9.2'>(9.2)</a></div><div id='unique_future-9.2.sentence-1' class='sentence'>destroys <span class='texttt'>*this</span><a class='hidden_link' href='#unique_future-9.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,future'></a></span><span class='indexparent'><a class='index' id='lib:future,operator='></a></span><code class='itemdecl'>future&amp; operator=(future&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='unique_future-10'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4316'>#</a></div><div id='unique_future-10.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='unique_future-10.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-10.1'>(10.1)</a></div><div id='unique_future-10.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#unique_future-10.1.sentence-1'>.</a></div></li><li id='unique_future-10.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-10.2'>(10.2)</a></div><div id='unique_future-10.2.sentence-1' class='sentence'>move assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'>*this</span><a class='hidden_link' href='#unique_future-10.2.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='unique_future-11'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4325'>#</a></div><div id='unique_future-11.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> 
<ul class='itemize'><li id='unique_future-11.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-11.1'>(11.1)</a></div><div id='unique_future-11.1.sentence-1' class='sentence'><span class='texttt'>valid()</span> returns the same value as <span class='texttt'>rhs.valid()</span> prior to the
assignment<a class='hidden_link' href='#unique_future-11.1.sentence-1'>.</a></div></li><li id='unique_future-11.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-11.2'>(11.2)</a></div><div id='unique_future-11.2.sentence-1' class='sentence'><span class='texttt'>rhs.valid() == false</span><a class='hidden_link' href='#unique_future-11.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:share,future'></a></span><span class='indexparent'><a class='index' id='lib:future,share'></a></span><code class='itemdecl'>shared_future&lt;R&gt; share() noexcept;
</code><div class='itemdescr'></div><div class='para' id='unique_future-12'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4343'>#</a></div><div id='unique_future-12.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>shared_&shy;future&lt;R&gt;(std&#x200b;::&#x200b;move(*this))</span><a class='hidden_link' href='#unique_future-12.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-13'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4346'>#</a></div><div id='unique_future-13.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid() == false</span><a class='hidden_link' href='#unique_future-13.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:get,future'></a></span><span class='indexparent'><a class='index' id='lib:future,get'></a></span><code class='itemdecl'>R future::get();
R&amp; future&lt;R&amp;&gt;::get();
void future&lt;void&gt;::get();
</code><div class='itemdescr'></div><div class='para' id='unique_future-14'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4358'>#</a></div><div id='unique_future-14.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#unique_future-14.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='unique_future-14.sentence-1' class='sentence'>As described above, the template and its two required specializations differ only in
the return type and return value of the member function <span class='texttt'>get</span><a class='hidden_link' href='#unique_future-14.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='unique_future-15'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4364'>#</a></div><div id='unique_future-15.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='unique_future-15.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-15.1'>(15.1)</a></div><div id='unique_future-15.1.sentence-1' class='sentence'><span class='texttt'>wait()</span>s until the shared state is ready, then retrieves the
value stored in the shared state;</div></li><li id='unique_future-15.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-15.2'>(15.2)</a></div><div id='unique_future-15.2.sentence-1' class='sentence'>releases any shared state (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#unique_future-15.2.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='unique_future-16'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4372'>#</a></div><div id='unique_future-16.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<ul class='itemize'><li id='unique_future-16.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-16.1'>(16.1)</a></div><div id='unique_future-16.1.sentence-1' class='sentence'><span class='texttt'>future&#x200b;::&#x200b;get()</span> returns the value <span class='texttt'>v</span> stored in the object's shared state as
<span class='texttt'>std&#x200b;::&#x200b;move(v)</span><a class='hidden_link' href='#unique_future-16.1.sentence-1'>.</a></div></li><li id='unique_future-16.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-16.2'>(16.2)</a></div><div id='unique_future-16.2.sentence-1' class='sentence'><span class='texttt'>future&lt;R&amp;&gt;&#x200b;::&#x200b;get()</span> returns the reference stored as value in the object's shared state<a class='hidden_link' href='#unique_future-16.2.sentence-1'>.</a></div></li><li id='unique_future-16.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-16.3'>(16.3)</a></div><div id='unique_future-16.3.sentence-1' class='sentence'><span class='texttt'>future&lt;void&gt;&#x200b;::&#x200b;get()</span> returns nothing<a class='hidden_link' href='#unique_future-16.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='unique_future-17'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4386'>#</a></div><div id='unique_future-17.sentence-1' class='sentence'><span class='textit'>Throws:</span> The stored exception, if an exception was stored in the shared state<a class='hidden_link' href='#unique_future-17.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-18'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4389'>#</a></div><div id='unique_future-18.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid() == false</span><a class='hidden_link' href='#unique_future-18.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:valid,future'></a></span><span class='indexparent'><a class='index' id='lib:future,valid'></a></span><code class='itemdecl'>bool valid() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='unique_future-19'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4399'>#</a></div><div id='unique_future-19.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>true</span> only if <span class='texttt'>*this</span> refers to a shared state<a class='hidden_link' href='#unique_future-19.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait,future'></a></span><span class='indexparent'><a class='index' id='lib:future,wait'></a></span><code class='itemdecl'>void wait() const;
</code><div class='itemdescr'></div><div class='para' id='unique_future-20'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4409'>#</a></div><div id='unique_future-20.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Blocks until the shared state is ready<a class='hidden_link' href='#unique_future-20.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait_for,future'></a></span><span class='indexparent'><a class='index' id='lib:future,wait_for'></a></span><code class='itemdecl'>template &lt;class Rep, class Period&gt;
  future_status wait_for(const chrono::duration&lt;Rep, Period&gt;&amp; rel_time) const;
</code><div class='itemdescr'></div><div class='para' id='unique_future-21'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4421'>#</a></div><div id='unique_future-21.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
None if the shared state contains a deferred function (<a href='futures.async'>[futures.async]</a>),
otherwise
blocks until the shared state is ready or until
the relative timeout (<a href='thread.req.timing'>[thread.req.timing]</a>) specified by <span class='texttt'>rel_&shy;time</span> has expired<a class='hidden_link' href='#unique_future-21.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-22'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4428'>#</a></div><div id='unique_future-22.sentence-1' class='sentence'><span class='textit'>Returns:</span> </div><div id='unique_future-22.sentence-2' class='sentence'><ul class='itemize'><li id='unique_future-22.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-22.1'>(22.1)</a></div><div id='unique_future-22.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#unique_future-22.1.sentence-1'>.</a></div></li><li id='unique_future-22.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-22.2'>(22.2)</a></div><div id='unique_future-22.2.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;ready</span> if the shared state is ready<a class='hidden_link' href='#unique_future-22.2.sentence-1'>.</a></div></li><li id='unique_future-22.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-22.3'>(22.3)</a></div><div id='unique_future-22.3.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;timeout</span> if the function is returning because the
relative timeout (<a href='thread.req.timing'>[thread.req.timing]</a>)
specified by <span class='texttt'>rel_&shy;time</span> has expired<a class='hidden_link' href='#unique_future-22.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='unique_future-23'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4442'>#</a></div><div id='unique_future-23.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
timeout-related exceptions (<a href='thread.req.timing'>[thread.req.timing]</a>)<a class='hidden_link' href='#unique_future-23.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait_until,future'></a></span><span class='indexparent'><a class='index' id='lib:future,wait_until'></a></span><code class='itemdecl'>template &lt;class Clock, class Duration&gt;
  future_status wait_until(const chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time) const;
</code><div class='itemdescr'></div><div class='para' id='unique_future-24'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4454'>#</a></div><div id='unique_future-24.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
None if the shared state contains a deferred function (<a href='futures.async'>[futures.async]</a>),
otherwise
blocks until the shared state is ready or until
the absolute timeout (<a href='thread.req.timing'>[thread.req.timing]</a>) specified by <span class='texttt'>abs_&shy;time</span> has expired<a class='hidden_link' href='#unique_future-24.sentence-1'>.</a></div></div></div><div class='para' id='unique_future-25'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4461'>#</a></div><div id='unique_future-25.sentence-1' class='sentence'><span class='textit'>Returns:</span> </div><div id='unique_future-25.sentence-2' class='sentence'><ul class='itemize'><li id='unique_future-25.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-25.1'>(25.1)</a></div><div id='unique_future-25.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#unique_future-25.1.sentence-1'>.</a></div></li><li id='unique_future-25.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-25.2'>(25.2)</a></div><div id='unique_future-25.2.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;ready</span> if the shared state is ready<a class='hidden_link' href='#unique_future-25.2.sentence-1'>.</a></div></li><li id='unique_future-25.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#unique_future-25.3'>(25.3)</a></div><div id='unique_future-25.3.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;timeout</span> if the function is returning because the
absolute timeout (<a href='thread.req.timing'>[thread.req.timing]</a>)
specified by <span class='texttt'>abs_&shy;time</span> has expired<a class='hidden_link' href='#unique_future-25.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='unique_future-26'><div class='marginalizedparent'><a class='marginalized' href='#unique_future-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4475'>#</a></div><div id='unique_future-26.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
timeout-related exceptions (<a href='thread.req.timing'>[thread.req.timing]</a>)<a class='hidden_link' href='#unique_future-26.sentence-1'>.</a></div></div></div></div><div id='shared_future' class='section'><h3 ><a class='secnum' href='#shared_future' style='min-width:103pt'>33.6.8</a> Class template <span class='texttt'>shared_&shy;future</span> <a class='abbr_ref' href='futures.shared_future'>[futures.shared_future]</a></h3><div class='para' id='shared_future-1'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4483'>#</a></div><div id='shared_future-1.sentence-1' class='sentence'>The class template <span class='texttt'>shared_&shy;future</span> defines a type for asynchronous return objects
which may share their shared state with other asynchronous return
objects<a class='hidden_link' href='#shared_future-1.sentence-1'>.</a></div> <div id='shared_future-1.sentence-2' class='sentence'>A default-constructed <span class='texttt'>shared_&shy;future</span>
object has no shared state<a class='hidden_link' href='#shared_future-1.sentence-2'>.</a></div> <div id='shared_future-1.sentence-3' class='sentence'>A <span class='texttt'>shared_&shy;future</span> object with
shared state can
be created
by conversion from a <span class='texttt'>future</span> object and shares its shared state with the
original <a href='futures.state#def:asynchronous_provider'>asynchronous provider</a> of the shared state<a class='hidden_link' href='#shared_future-1.sentence-3'>.</a></div> <div id='shared_future-1.sentence-4' class='sentence'>The result (value or exception) of a <span class='texttt'>shared_&shy;future</span> object
can be set by
calling a respective function on an
object that shares the same shared state<a class='hidden_link' href='#shared_future-1.sentence-4'>.</a></div></div><div class='para' id='shared_future-2'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4497'>#</a></div><div id='shared_future-2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-2.sentence-1' class='sentence'>Member functions of <span class='texttt'>shared_&shy;future</span> do not synchronize with themselves,
but they synchronize with the shared state<a class='hidden_link' href='#shared_future-2.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='shared_future-3'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4501'>#</a></div><div id='shared_future-3.sentence-1' class='sentence'>The effect of calling any member function other than the destructor,
the move-assignment operator, the copy-assignment operator, or
<span class='texttt'>valid()</span> on a <span class='texttt'>shared_&shy;future</span> object for which <span class='texttt'>valid() == false</span> is undefined<a class='hidden_link' href='#shared_future-3.sentence-1'>.</a></div> <div id='shared_future-3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-3.sentence-2' class='sentence'>It is valid to copy or move from a <span class='texttt'>shared_&shy;future</span>
object for which <span class='texttt'>valid()</span> is <span class='texttt'>false</span><a class='hidden_link' href='#shared_future-3.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='shared_future-3.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-3.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-3.sentence-3' class='sentence'>Implementations should detect this case and throw an object of type
<span class='texttt'>future_&shy;error</span> with an error condition of <span class='texttt'>future_&shy;errc&#x200b;::&#x200b;no_&shy;state</span><a class='hidden_link' href='#shared_future-3.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> <span class='indexparent'><a class='index' id='lib:shared_future'></a></span><pre class='codeblock'>
namespace std {
  template &lt;class R&gt;
  class shared_future {
  public:
    shared_future() noexcept;
    shared_future(const shared_future&amp; rhs) noexcept;
    shared_future(future&lt;R&gt;&amp;&amp;) noexcept;
    shared_future(shared_future&amp;&amp; rhs) noexcept;
    ~shared_future();
    shared_future&amp; operator=(const shared_future&amp; rhs) noexcept;
    shared_future&amp; operator=(shared_future&amp;&amp; rhs) noexcept;

    <span class='comment'>// retrieving the value
</span>    <span class='textit'><span class='texttt'>see below</span></span> get() const;

    <span class='comment'>// functions to check state
</span>    bool valid() const noexcept;

    void wait() const;
    template &lt;class Rep, class Period&gt;
      future_status wait_for(const chrono::duration&lt;Rep, Period&gt;&amp; rel_time) const;
    template &lt;class Clock, class Duration&gt;
      future_status wait_until(const chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time) const;
  };
}</pre></div><div class='para' id='shared_future-4'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4539'>#</a></div><div id='shared_future-4.sentence-1' class='sentence'>The implementation shall provide the template <span class='texttt'>shared_&shy;future</span> and two
specializations, <span class='texttt'>shared_&shy;future&lt;R&amp;&gt;</span> and <span class='texttt'>shared_&shy;future&lt;void&gt;</span><a class='hidden_link' href='#shared_future-4.sentence-1'>.</a></div> <div id='shared_future-4.sentence-2' class='sentence'>These
differ only in the return type and return value of the member function <span class='texttt'>get</span>, as
set out in its description, below<a class='hidden_link' href='#shared_future-4.sentence-2'>.</a></div> <span class='indexparent'><a class='index' id='lib:shared_future,constructor'></a></span></div><code class='itemdecl'>shared_future() noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-5'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4551'>#</a></div><div id='shared_future-5.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs an <a class='hidden_link' href='#def:empty_shared_future_object' id='def:empty_shared_future_object'><i >empty</i></a>
<span class='texttt'>shared_&shy;future</span> object that does not refer to a
shared state<a class='hidden_link' href='#shared_future-5.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-6'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4556'>#</a></div><div id='shared_future-6.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid() == false</span><a class='hidden_link' href='#shared_future-6.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:shared_future,constructor_'></a></span><code class='itemdecl'>shared_future(const shared_future&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-7'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4566'>#</a></div><div id='shared_future-7.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a <span class='texttt'>shared_&shy;future</span> object that refers to the same
shared state as <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#shared_future-7.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-8'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4570'>#</a></div><div id='shared_future-8.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid()</span> returns the same value as <span class='texttt'>rhs.valid()</span><a class='hidden_link' href='#shared_future-8.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:shared_future,constructor__'></a></span><code class='itemdecl'>shared_future(future&lt;R&gt;&amp;&amp; rhs) noexcept;
shared_future(shared_future&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-9'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4581'>#</a></div><div id='shared_future-9.sentence-1' class='sentence'><span class='textit'>Effects:</span> Move constructs a <span class='texttt'>shared_&shy;future</span> object that refers to the
shared state that was originally referred to by <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#shared_future-9.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-10'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4585'>#</a></div><div id='shared_future-10.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> 
<ul class='itemize'><li id='shared_future-10.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-10.1'>(10.1)</a></div><div id='shared_future-10.1.sentence-1' class='sentence'><span class='texttt'>valid()</span> returns the same value as <span class='texttt'>rhs.valid()</span> returned prior to
the constructor invocation<a class='hidden_link' href='#shared_future-10.1.sentence-1'>.</a></div></li><li id='shared_future-10.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-10.2'>(10.2)</a></div><div id='shared_future-10.2.sentence-1' class='sentence'><span class='texttt'>rhs.valid() == false</span><a class='hidden_link' href='#shared_future-10.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:shared_future,destructor'></a></span><code class='itemdecl'>~shared_future();
</code><div class='itemdescr'></div><div class='para' id='shared_future-11'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4600'>#</a></div><div id='shared_future-11.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='shared_future-11.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-11.1'>(11.1)</a></div><div id='shared_future-11.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>);</div></li><li id='shared_future-11.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-11.2'>(11.2)</a></div><div id='shared_future-11.2.sentence-1' class='sentence'>destroys <span class='texttt'>*this</span><a class='hidden_link' href='#shared_future-11.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,operator='></a></span><code class='itemdecl'>shared_future&amp; operator=(shared_future&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-12'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4616'>#</a></div><div id='shared_future-12.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='shared_future-12.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-12.1'>(12.1)</a></div><div id='shared_future-12.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>);</div></li><li id='shared_future-12.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-12.2'>(12.2)</a></div><div id='shared_future-12.2.sentence-1' class='sentence'>move assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'>*this</span><a class='hidden_link' href='#shared_future-12.2.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='shared_future-13'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4625'>#</a></div><div id='shared_future-13.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> 
<ul class='itemize'><li id='shared_future-13.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-13.1'>(13.1)</a></div><div id='shared_future-13.1.sentence-1' class='sentence'><span class='texttt'>valid()</span> returns the same value as <span class='texttt'>rhs.valid()</span> returned prior to
the assignment<a class='hidden_link' href='#shared_future-13.1.sentence-1'>.</a></div></li><li id='shared_future-13.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-13.2'>(13.2)</a></div><div id='shared_future-13.2.sentence-1' class='sentence'><span class='texttt'>rhs.valid() == false</span><a class='hidden_link' href='#shared_future-13.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,shared_future_'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,operator=_'></a></span><code class='itemdecl'>shared_future&amp; operator=(const shared_future&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-14'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4643'>#</a></div><div id='shared_future-14.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='shared_future-14.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-14.1'>(14.1)</a></div><div id='shared_future-14.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>);</div></li><li id='shared_future-14.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-14.2'>(14.2)</a></div><div id='shared_future-14.2.sentence-1' class='sentence'>assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'>*this</span><a class='hidden_link' href='#shared_future-14.2.sentence-1'>.</a></div> <div id='shared_future-14.2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-14.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-14.2.sentence-2' class='sentence'>As a result,
<span class='texttt'>*this</span> refers to the same shared state as <span class='texttt'>rhs</span>
(if any)<a class='hidden_link' href='#shared_future-14.2.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </li></ul></div></div></div><div class='para' id='shared_future-15'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4654'>#</a></div><div id='shared_future-15.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>valid() == rhs.valid()</span><a class='hidden_link' href='#shared_future-15.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:get,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,get'></a></span><code class='itemdecl'>const R&amp; shared_future::get() const;
R&amp; shared_future&lt;R&amp;&gt;::get() const;
void shared_future&lt;void&gt;::get() const;
</code><div class='itemdescr'></div><div class='para' id='shared_future-16'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4666'>#</a></div><div id='shared_future-16.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-16.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-16.sentence-1' class='sentence'>As described above, the template and its two required specializations differ only in
the return type and return value of the member function <span class='texttt'>get</span><a class='hidden_link' href='#shared_future-16.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='shared_future-17'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4672'>#</a></div><div id='shared_future-17.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-17.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-17.sentence-1' class='sentence'>Access to a value object stored in the shared state is
unsynchronized, so programmers should apply only those operations on <span class='texttt'>R</span> that do not
introduce a data race (<a href='intro.multithread'>[intro.multithread]</a>)<a class='hidden_link' href='#shared_future-17.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='shared_future-18'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4679'>#</a></div><div id='shared_future-18.sentence-1' class='sentence'><span class='textit'>Effects:</span> <span class='texttt'>wait()</span>s until the shared state is ready, then retrieves the
value stored in the shared state<a class='hidden_link' href='#shared_future-18.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-19'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4683'>#</a></div><div id='shared_future-19.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<ul class='itemize'><li id='shared_future-19.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-19.1'>(19.1)</a></div><div id='shared_future-19.1.sentence-1' class='sentence'><span class='texttt'>shared_&shy;future&#x200b;::&#x200b;get()</span> returns a const reference to the value stored in the object's
shared state<a class='hidden_link' href='#shared_future-19.1.sentence-1'>.</a></div> <div id='shared_future-19.1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#shared_future-19.1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='shared_future-19.1.sentence-2' class='sentence'>Access through that reference after the shared state has been
destroyed produces undefined behavior; this can be avoided by not storing the reference in any
storage with a greater lifetime than the <span class='texttt'>shared_&shy;future</span> object that returned the
reference<a class='hidden_link' href='#shared_future-19.1.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </li><li id='shared_future-19.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-19.2'>(19.2)</a></div><div id='shared_future-19.2.sentence-1' class='sentence'><span class='texttt'>shared_&shy;future&lt;R&amp;&gt;&#x200b;::&#x200b;get()</span> returns the reference stored as value in the object's
shared state<a class='hidden_link' href='#shared_future-19.2.sentence-1'>.</a></div></li><li id='shared_future-19.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-19.3'>(19.3)</a></div><div id='shared_future-19.3.sentence-1' class='sentence'><span class='texttt'>shared_&shy;future&lt;void&gt;&#x200b;::&#x200b;get()</span> returns nothing<a class='hidden_link' href='#shared_future-19.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='shared_future-20'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4702'>#</a></div><div id='shared_future-20.sentence-1' class='sentence'><span class='textit'>Throws:</span> The stored exception, if an exception was stored in the shared state<a class='hidden_link' href='#shared_future-20.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:valid,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,valid'></a></span><code class='itemdecl'>bool valid() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='shared_future-21'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4712'>#</a></div><div id='shared_future-21.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>true</span> only if <span class='texttt'>*this</span> refers to a shared state<a class='hidden_link' href='#shared_future-21.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,wait'></a></span><code class='itemdecl'>void wait() const;
</code><div class='itemdescr'></div><div class='para' id='shared_future-22'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4722'>#</a></div><div id='shared_future-22.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Blocks until the shared state is ready<a class='hidden_link' href='#shared_future-22.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait_for,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,wait_for'></a></span><code class='itemdecl'>template &lt;class Rep, class Period&gt;
  future_status wait_for(const chrono::duration&lt;Rep, Period&gt;&amp; rel_time) const;
</code><div class='itemdescr'></div><div class='para' id='shared_future-23'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4734'>#</a></div><div id='shared_future-23.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
None if the shared state contains a deferred function (<a href='futures.async'>[futures.async]</a>),
otherwise
blocks until the shared state is ready or until
the relative timeout (<a href='thread.req.timing'>[thread.req.timing]</a>) specified by
<span class='texttt'>rel_&shy;time</span> has expired<a class='hidden_link' href='#shared_future-23.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-24'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4742'>#</a></div><div id='shared_future-24.sentence-1' class='sentence'><span class='textit'>Returns:</span> </div><div id='shared_future-24.sentence-2' class='sentence'><ul class='itemize'><li id='shared_future-24.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-24.1'>(24.1)</a></div><div id='shared_future-24.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#shared_future-24.1.sentence-1'>.</a></div></li><li id='shared_future-24.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-24.2'>(24.2)</a></div><div id='shared_future-24.2.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;ready</span> if the shared state is ready<a class='hidden_link' href='#shared_future-24.2.sentence-1'>.</a></div></li><li id='shared_future-24.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-24.3'>(24.3)</a></div><div id='shared_future-24.3.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;timeout</span> if the function is returning because the
relative timeout (<a href='thread.req.timing'>[thread.req.timing]</a>)
specified by <span class='texttt'>rel_&shy;time</span> has expired<a class='hidden_link' href='#shared_future-24.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='shared_future-25'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4756'>#</a></div><div id='shared_future-25.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
timeout-related exceptions (<a href='thread.req.timing'>[thread.req.timing]</a>)<a class='hidden_link' href='#shared_future-25.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:wait_until,shared_future'></a></span><span class='indexparent'><a class='index' id='lib:shared_future,wait_until'></a></span><code class='itemdecl'>template &lt;class Clock, class Duration&gt;
  future_status wait_until(const chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time) const;
</code><div class='itemdescr'></div><div class='para' id='shared_future-26'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4768'>#</a></div><div id='shared_future-26.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
None if the shared state contains a deferred function (<a href='futures.async'>[futures.async]</a>),
otherwise
blocks until the shared state is ready or until the
absolute timeout (<a href='thread.req.timing'>[thread.req.timing]</a>) specified by
<span class='texttt'>abs_&shy;time</span> has expired<a class='hidden_link' href='#shared_future-26.sentence-1'>.</a></div></div></div><div class='para' id='shared_future-27'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4776'>#</a></div><div id='shared_future-27.sentence-1' class='sentence'><span class='textit'>Returns:</span> </div><div id='shared_future-27.sentence-2' class='sentence'><ul class='itemize'><li id='shared_future-27.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-27.1'>(27.1)</a></div><div id='shared_future-27.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#shared_future-27.1.sentence-1'>.</a></div></li><li id='shared_future-27.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-27.2'>(27.2)</a></div><div id='shared_future-27.2.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;ready</span> if the shared state is ready<a class='hidden_link' href='#shared_future-27.2.sentence-1'>.</a></div></li><li id='shared_future-27.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#shared_future-27.3'>(27.3)</a></div><div id='shared_future-27.3.sentence-1' class='sentence'><span class='texttt'>future_&shy;status&#x200b;::&#x200b;timeout</span> if the function is returning because the
absolute timeout (<a href='thread.req.timing'>[thread.req.timing]</a>)
specified by <span class='texttt'>abs_&shy;time</span> has expired<a class='hidden_link' href='#shared_future-27.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='shared_future-28'><div class='marginalizedparent'><a class='marginalized' href='#shared_future-28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4790'>#</a></div><div id='shared_future-28.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
timeout-related exceptions (<a href='thread.req.timing'>[thread.req.timing]</a>)<a class='hidden_link' href='#shared_future-28.sentence-1'>.</a></div></div></div></div><div id='async' class='section'><h3 ><a class='secnum' href='#async' style='min-width:103pt'>33.6.9</a> Function template <span class='texttt'>async</span> <a class='abbr_ref' href='futures.async'>[futures.async]</a></h3><div class='para' id='async-1'><div class='marginalizedparent'><a class='marginalized' href='#async-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4797'>#</a></div><div id='async-1.sentence-1' class='sentence'>The function template <span class='texttt'>async</span> provides a mechanism to launch a function potentially
in a new thread and provides the result of the function in a <span class='texttt'>future</span> object with which
it shares a shared state<a class='hidden_link' href='#async-1.sentence-1'>.</a></div> <span class='indexparent'><a class='index' id='lib:async'></a></span></div><code class='itemdecl'>template &lt;class F, class... Args&gt;
  future&lt;invoke_result_t&lt;decay_t&lt;F&gt;, decay_t&lt;Args&gt;...&gt;&gt;
    async(F&amp;&amp; f, Args&amp;&amp;... args);
template &lt;class F, class... Args&gt;
  future&lt;invoke_result_t&lt;decay_t&lt;F&gt;, decay_t&lt;Args&gt;...&gt;&gt;
    async(launch policy, F&amp;&amp; f, Args&amp;&amp;... args);
</code><div class='itemdescr'></div><div class='para' id='async-2'><div class='marginalizedparent'><a class='marginalized' href='#async-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4813'>#</a></div><div id='async-2.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>F</span> and each <span class='texttt'>Ti</span> in <span class='texttt'>Args</span> shall
satisfy the
<span class='texttt'>MoveConstructible</span> requirements, and
<pre class='codeblock'>
<span class='textit'>INVOKE</span>(<span class='textit'>DECAY_COPY</span>(std::forward&lt;F&gt;(f)),
       <span class='textit'>DECAY_COPY</span>(std::forward&lt;Args&gt;(args))...)     <span class='comment'>// see <a href='func.require'>[func.require]</a>, <a href='thread.thread.constr'>[thread.thread.constr]</a>
</span></pre>
shall be a valid expression<a class='hidden_link' href='#async-2.sentence-1'>.</a></div></div></div><div class='para' id='async-3'><div class='marginalizedparent'><a class='marginalized' href='#async-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4823'>#</a></div><div id='async-3.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
The first function
behaves the same as a call to the second function with a <span class='texttt'>policy</span> argument of
<span class='texttt'>launch&#x200b;::&#x200b;async | launch&#x200b;::&#x200b;deferred</span>
and the same arguments for <span class='texttt'>F</span> and <span class='texttt'>Args</span><a class='hidden_link' href='#async-3.sentence-1'>.</a></div> <div id='async-3.sentence-2' class='sentence'>The second function creates a shared state that is associated with
the returned <span class='texttt'>future</span> object<a class='hidden_link' href='#async-3.sentence-2'>.</a></div> <div id='async-3.sentence-3' class='sentence'>The further behavior
of the second function depends on the <span class='texttt'>policy</span> argument as follows (if
more than one of these conditions applies, the implementation may choose any of
the corresponding policies):</div><div id='async-3.sentence-4' class='sentence'><ul class='itemize'><li id='async-3.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-3.1'>(3.1)</a></div><div id='async-3.1.sentence-1' class='sentence'>If <span class='texttt'>launch&#x200b;::&#x200b;async</span> is set in <span class='texttt'>policy</span>, calls
<span class='texttt'><span class='textit'>INVOKE</span>(<span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;F&gt;(f)),</span>
<span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;Args&gt;(args))...)</span>
(<a href='func.require'>[func.require]</a>, <a href='thread.thread.constr'>[thread.thread.constr]</a>)
as if in a new thread of execution represented by a <span class='texttt'>thread</span> object
with the calls to <span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>()</span> being evaluated in the thread that called <span class='texttt'>async</span><a class='hidden_link' href='#async-3.1.sentence-1'>.</a></div> <div id='async-3.1.sentence-2' class='sentence'>Any return value
is stored as the result in the
shared state<a class='hidden_link' href='#async-3.1.sentence-2'>.</a></div> <div id='async-3.1.sentence-3' class='sentence'>Any exception propagated from
the execution of
<span class='texttt'><span class='textit'>INVOKE</span>(<span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;F&gt;(f)),
<span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;Args&gt;(args))...)</span>
is stored as the exceptional result in the shared state<a class='hidden_link' href='#async-3.1.sentence-3'>.</a></div> <div id='async-3.1.sentence-4' class='sentence'>The <span class='texttt'>thread</span> object is
stored in the shared state
and affects the behavior of any asynchronous return objects that
reference that state<a class='hidden_link' href='#async-3.1.sentence-4'>.</a></div></li><li id='async-3.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-3.2'>(3.2)</a></div><div id='async-3.2.sentence-1' class='sentence'>If <span class='texttt'>launch&#x200b;::&#x200b;deferred</span> is set in <span class='texttt'>policy</span>,
stores <span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;F&gt;(f))</span> and
<span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;Args&gt;(args))...</span>
in the shared state<a class='hidden_link' href='#async-3.2.sentence-1'>.</a></div> <div id='async-3.2.sentence-2' class='sentence'>These copies of <span class='texttt'>f</span> and <span class='texttt'>args</span> constitute
a <a class='hidden_link' href='#def:deferred_function' id='def:deferred_function'><i >deferred function</i></a><a class='hidden_link' href='#async-3.2.sentence-2'>.</a></div> <div id='async-3.2.sentence-3' class='sentence'>Invocation of the deferred function evaluates
<span class='texttt'><span class='textit'>INVOKE</span>(std&#x200b;::&#x200b;move(g), std&#x200b;::&#x200b;move(xyz))</span> where <span class='texttt'>g</span> is the stored value of
<span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;F&gt;(f))</span> and <span class='texttt'>xyz</span> is the stored copy of
<span class='texttt'><span class='textit'>DECAY_&shy;COPY</span>(std&#x200b;::&#x200b;forward&lt;Args&gt;(args))...</span><a class='hidden_link' href='#async-3.2.sentence-3'>.</a></div> <div id='async-3.2.sentence-4' class='sentence'>Any return value is stored
as the result in the shared state<a class='hidden_link' href='#async-3.2.sentence-4'>.</a></div> <div id='async-3.2.sentence-5' class='sentence'>Any exception propagated
from the execution
of the deferred function
is stored as the exceptional result
in the shared state<a class='hidden_link' href='#async-3.2.sentence-5'>.</a></div> <div id='async-3.2.sentence-6' class='sentence'>The shared state is not
made ready until the function has completed<a class='hidden_link' href='#async-3.2.sentence-6'>.</a></div> <div id='async-3.2.sentence-7' class='sentence'>The first call to a
non-timed waiting function (<a href='futures.state'>[futures.state]</a>)
on an asynchronous return object referring to
this shared state shall invoke the
deferred function in the thread that called the waiting function<a class='hidden_link' href='#async-3.2.sentence-7'>.</a></div> <div id='async-3.2.sentence-8' class='sentence'>Once evaluation of <span class='texttt'><span class='textit'>INVOKE</span>(std&#x200b;::&#x200b;move(g), std&#x200b;::&#x200b;move(xyz))</span> begins, the function is no longer
considered deferred<a class='hidden_link' href='#async-3.2.sentence-8'>.</a></div> <div id='async-3.2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#async-3.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='async-3.2.sentence-9' class='sentence'>If this policy is specified together with other policies, such as when using a
<span class='texttt'>policy</span> value of <span class='texttt'>launch&#x200b;::&#x200b;async | launch&#x200b;::&#x200b;deferred</span>, implementations should defer
invocation or the selection of the policy when no more concurrency can be effectively
exploited<a class='hidden_link' href='#async-3.2.sentence-9'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </li><li id='async-3.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-3.3'>(3.3)</a></div><div id='async-3.3.sentence-1' class='sentence'>If no value is set in the launch policy, or a value is set that is neither specified
in this International Standard nor by the implementation, the behavior is undefined<a class='hidden_link' href='#async-3.3.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='async-4'><div class='marginalizedparent'><a class='marginalized' href='#async-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4890'>#</a></div><div id='async-4.sentence-1' class='sentence'><span class='textit'>Returns:</span> An object of type
<span class='texttt'>future&lt;invoke_&shy;result_&shy;t&lt;decay_&shy;t&lt;F&gt;, decay_&shy;t&lt;Args&gt;...&gt;&gt;</span> that refers
to the shared state created by this call to <span class='texttt'>async</span><a class='hidden_link' href='#async-4.sentence-1'>.</a></div> <div id='async-4.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#async-4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='async-4.sentence-2' class='sentence'>If a future obtained from <span class='texttt'>async</span> is moved outside the local scope,
other code that uses the future must be aware that the future's destructor may
block for the shared state to become ready<a class='hidden_link' href='#async-4.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='async-5'><div class='marginalizedparent'><a class='marginalized' href='#async-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4898'>#</a></div><div id='async-5.sentence-1' class='sentence'><span class='textit'>Synchronization:</span> 
Regardless of the provided <span class='texttt'>policy</span> argument,
<ul class='itemize'><li id='async-5.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-5.1'>(5.1)</a></div><div id='async-5.1.sentence-1' class='sentence'>the invocation of <span class='texttt'>async</span>
<a href='intro.multithread#def:synchronize_with'>synchronizes with</a> the invocation of <span class='texttt'>f</span><a class='hidden_link' href='#async-5.1.sentence-1'>.</a></div> <div id='async-5.1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#async-5.1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='async-5.1.sentence-3' class='sentence'>This statement applies even when the corresponding <span class='texttt'>future</span> object is moved to
another thread<a class='hidden_link' href='#async-5.1.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='async-5.1.sentence-2' class='sentence'>; and</div></li><li id='async-5.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-5.2'>(5.2)</a></div><div id='async-5.2.sentence-1' class='sentence'>the completion of the function <span class='texttt'>f</span> is sequenced before (<a href='intro.multithread'>[intro.multithread]</a>) the shared state is made ready<a class='hidden_link' href='#async-5.2.sentence-1'>.</a></div> <div id='async-5.2.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#async-5.2.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='async-5.2.sentence-2' class='sentence'><span class='texttt'>f</span> might not be called at all,
so its completion might never happen<a class='hidden_link' href='#async-5.2.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </li></ul></div><div id='async-5.sentence-2' class='sentence'>If the implementation chooses the <span class='texttt'>launch&#x200b;::&#x200b;async</span> policy,</div><div id='async-5.sentence-3' class='sentence'><ul class='itemize'><li id='async-5.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-5.3'>(5.3)</a></div><div id='async-5.3.sentence-1' class='sentence'>a call to a waiting function on an asynchronous return
object that shares the shared state created by this <span class='texttt'>async</span> call shall
block until the associated thread has completed, as if joined, or else time
out (<a href='thread.thread.member'>[thread.thread.member]</a>);</div></li><li id='async-5.4'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-5.4'>(5.4)</a></div><div id='async-5.4.sentence-1' class='sentence'>the associated thread completion
<a href='intro.multithread#def:synchronize_with'>synchronizes with</a>
the return from
the first function
that successfully detects the ready status of the shared state or
with the return from the last
function that releases the shared state, whichever
happens first<a class='hidden_link' href='#async-5.4.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='async-6'><div class='marginalizedparent'><a class='marginalized' href='#async-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4935'>#</a></div><div id='async-6.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>system_&shy;error</span> if <span class='texttt'>policy == launch&#x200b;::&#x200b;async</span> and the
implementation is unable to start a new thread, or
<span class='texttt'>std&#x200b;::&#x200b;bad_&shy;alloc</span> if memory for the internal data structures
could not be allocated<a class='hidden_link' href='#async-6.sentence-1'>.</a></div></div></div><div class='para' id='async-7'><div class='marginalizedparent'><a class='marginalized' href='#async-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4941'>#</a></div><div id='async-7.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='async-7.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#async-7.1'>(7.1)</a></div><div id='async-7.1.sentence-1' class='sentence'><span class='texttt'>resource_&shy;unavailable_&shy;try_&shy;again</span> — if
<span class='texttt'>policy == launch&#x200b;::&#x200b;async</span> and the system is unable to start a new thread<a class='hidden_link' href='#async-7.1.sentence-1'>.</a></div></li></ul></div></div></div><div class='para' id='async-8'><div class='marginalizedparent'><a class='marginalized' href='#async-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4949'>#</a></div><div id='async-8.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#async-8.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
int work1(int value);
int work2(int value);
int work(int value) {
  auto handle = std::async([=]{ return work2(value); });
  int tmp = work1(value);
  return tmp + handle.get();    <span class='comment'>// #1
</span>}</pre><div id='async-8.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#async-8.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='async-8.sentence-1' class='sentence'>Line #1 might not result in concurrency because
the <span class='texttt'>async</span> call uses the default policy, which may use
<span class='texttt'>launch&#x200b;::&#x200b;deferred</span>, in which case the lambda might not be invoked until the
<span class='texttt'>get()</span> call; in that case, <span class='texttt'>work1</span> and <span class='texttt'>work2</span> are called on the
same thread and there is no concurrency<a class='hidden_link' href='#async-8.sentence-1'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div id='task' class='section'><h3 ><a class='secnum' href='#task' style='min-width:103pt'>33.6.10</a> Class template <span class='texttt'>packaged_&shy;task</span> <a class='abbr_ref' href='futures.task'>[futures.task]</a></h3><div class='para' id='task-1'><div class='marginalizedparent'><a class='marginalized' href='#task-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4971'>#</a></div><div id='task-1.sentence-1' class='sentence'>The class template <span class='texttt'>packaged_&shy;task</span> defines a type for wrapping a function or
callable object so that the return value of the function or callable object is stored in
a future when it is invoked<a class='hidden_link' href='#task-1.sentence-1'>.</a></div></div><div class='para' id='task-2'><div class='marginalizedparent'><a class='marginalized' href='#task-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L4976'>#</a></div><div id='task-2.sentence-1' class='sentence'>When the <span class='texttt'>packaged_&shy;task</span> object is invoked, its stored task is invoked and the
result (whether normal or exceptional) stored in the shared state<a class='hidden_link' href='#task-2.sentence-1'>.</a></div> <div id='task-2.sentence-2' class='sentence'>Any futures that
share the shared state will then be able to access the stored result<a class='hidden_link' href='#task-2.sentence-2'>.</a></div><span class='indexparent'><a class='index' id='lib:packaged_task'></a></span><pre class='codeblock'>
namespace std {
  template&lt;class&gt; class packaged_task; <span class='comment'>// not defined
</span>
  template&lt;class R, class... ArgTypes&gt;
  class packaged_task&lt;R(ArgTypes...)&gt; {
  public:
    <span class='comment'>// construction and destruction
</span>    packaged_task() noexcept;
    template &lt;class F&gt;
      explicit packaged_task(F&amp;&amp; f);
    ~packaged_task();

    <span class='comment'>// no copy
</span>    packaged_task(const packaged_task&amp;) = delete;
    packaged_task&amp; operator=(const packaged_task&amp;) = delete;

    <span class='comment'>// move support
</span>    packaged_task(packaged_task&amp;&amp; rhs) noexcept;
    packaged_task&amp; operator=(packaged_task&amp;&amp; rhs) noexcept;
    void swap(packaged_task&amp; other) noexcept;

    bool valid() const noexcept;

    <span class='comment'>// result retrieval
</span>    future&lt;R&gt; get_future();

    <span class='comment'>// execution
</span>    void operator()(ArgTypes... );
    void make_ready_at_thread_exit(ArgTypes...);

    void reset();
  };
  template &lt;class R, class... ArgTypes&gt;
    void swap(packaged_task&lt;R(ArgTypes...)&gt;&amp; x, packaged_task&lt;R(ArgTypes...)&gt;&amp; y) noexcept;
  template &lt;class R, class Alloc&gt;
    struct uses_allocator&lt;packaged_task&lt;R&gt;, Alloc&gt;;
}</pre></div><div id='task.members' class='section'><h4 ><a class='secnum' href='#task.members' style='min-width:118pt'>33.6.10.1</a> <span class='texttt'>packaged_&shy;task</span> member functions <a class='abbr_ref' href='futures.task.members'>[futures.task.members]</a></h4><span class='indexparent'><a class='index' id='lib:packaged_task,constructor'></a></span><code class='itemdecl'>packaged_task() noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.members-1'><div class='marginalizedparent'><a class='marginalized' href='#task.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5030'>#</a></div><div id='task.members-1.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a <span class='texttt'>packaged_&shy;task</span> object with no shared state and no stored task<a class='hidden_link' href='#task.members-1.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:packaged_task,constructor_'></a></span><code class='itemdecl'>template &lt;class F&gt;
  packaged_task(F&amp;&amp; f);
</code><div class='itemdescr'></div><div class='para' id='task.members-2'><div class='marginalizedparent'><a class='marginalized' href='#task.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5041'>#</a></div><div id='task.members-2.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
<span class='texttt'><span class='textit'>INVOKE</span>&lt;R&gt;(f, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span>)</span> (<a href='func.require'>[func.require]</a>), where <span class='texttt'>t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span> are values
of the corresponding types in <span class='texttt'>ArgTypes...</span>, shall be a valid expression<a class='hidden_link' href='#task.members-2.sentence-1'>.</a></div> <div id='task.members-2.sentence-2' class='sentence'>Invoking
a copy of <span class='texttt'>f</span> shall behave the same as invoking <span class='texttt'>f</span><a class='hidden_link' href='#task.members-2.sentence-2'>.</a></div></div></div><div class='para' id='task.members-3'><div class='marginalizedparent'><a class='marginalized' href='#task.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5047'>#</a></div><div id='task.members-3.sentence-1' class='sentence'><span class='textit'>Remarks:</span> 
This constructor shall not participate in overload resolution if <span class='texttt'>decay_&shy;t&lt;F&gt;</span>
is the same type as <span class='texttt'>packaged_&shy;task&lt;R(ArgTypes...)&gt;</span><a class='hidden_link' href='#task.members-3.sentence-1'>.</a></div></div></div><div class='para' id='task.members-4'><div class='marginalizedparent'><a class='marginalized' href='#task.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5052'>#</a></div><div id='task.members-4.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a new <span class='texttt'>packaged_&shy;task</span> object with a shared state and
initializes the object's stored task with <span class='texttt'>std&#x200b;::&#x200b;forward&lt;F&gt;(f)</span><a class='hidden_link' href='#task.members-4.sentence-1'>.</a></div></div></div><div class='para' id='task.members-5'><div class='marginalizedparent'><a class='marginalized' href='#task.members-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5056'>#</a></div><div id='task.members-5.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
<ul class='itemize'><li id='task.members-5.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-5.1'>(5.1)</a></div><div id='task.members-5.1.sentence-1' class='sentence'>Any exceptions thrown by the copy or move constructor of <span class='texttt'>f</span><a class='hidden_link' href='#task.members-5.1.sentence-1'>.</a></div></li><li id='task.members-5.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-5.2'>(5.2)</a></div><div id='task.members-5.2.sentence-1' class='sentence'>For the first version,
   <span class='texttt'>bad_&shy;alloc</span> if memory for the internal data structures could not be allocated<a class='hidden_link' href='#task.members-5.2.sentence-1'>.</a></div></li><li id='task.members-5.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-5.3'>(5.3)</a></div><div id='task.members-5.3.sentence-1' class='sentence'>For the second version,
   any exceptions thrown by <span class='texttt'>allocator_&shy;traits&lt;Allocator&gt;&#x200b;::&#x200b;template</span>
   <span class='texttt'>rebind_&shy;traits&lt;<span class='textit'><span class='texttt'>unspecified</span></span>&gt;&#x200b;::&#x200b;allocate</span><a class='hidden_link' href='#task.members-5.3.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:packaged_task,constructor__'></a></span><code class='itemdecl'>packaged_task(packaged_task&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.members-6'><div class='marginalizedparent'><a class='marginalized' href='#task.members-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5074'>#</a></div><div id='task.members-6.sentence-1' class='sentence'><span class='textit'>Effects:</span> Constructs a new <span class='texttt'>packaged_&shy;task</span> object and transfers ownership of
<span class='texttt'>rhs</span>'s shared state to <span class='texttt'>*this</span>, leaving <span class='texttt'>rhs</span> with no
shared state<a class='hidden_link' href='#task.members-6.sentence-1'>.</a></div> <div id='task.members-6.sentence-2' class='sentence'>Moves the stored task from <span class='texttt'>rhs</span> to <span class='texttt'>*this</span><a class='hidden_link' href='#task.members-6.sentence-2'>.</a></div></div></div><div class='para' id='task.members-7'><div class='marginalizedparent'><a class='marginalized' href='#task.members-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5079'>#</a></div><div id='task.members-7.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#task.members-7.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:operator=,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,operator='></a></span><code class='itemdecl'>packaged_task&amp; operator=(packaged_task&amp;&amp; rhs) noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.members-8'><div class='marginalizedparent'><a class='marginalized' href='#task.members-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5089'>#</a></div><div id='task.members-8.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
<ul class='itemize'><li id='task.members-8.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-8.1'>(8.1)</a></div><div id='task.members-8.1.sentence-1' class='sentence'>Releases any shared state (<a href='futures.state'>[futures.state]</a>);</div></li><li id='task.members-8.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-8.2'>(8.2)</a></div><div id='task.members-8.2.sentence-1' class='sentence'>calls <span class='texttt'>packaged_&shy;task(std&#x200b;::&#x200b;move(rhs)).swap(*this)</span><a class='hidden_link' href='#task.members-8.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:packaged_task,destructor'></a></span><code class='itemdecl'>~packaged_task();
</code><div class='itemdescr'></div><div class='para' id='task.members-9'><div class='marginalizedparent'><a class='marginalized' href='#task.members-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5105'>#</a></div><div id='task.members-9.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Abandons any shared state (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#task.members-9.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:swap,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,swap'></a></span><code class='itemdecl'>void swap(packaged_task&amp; other) noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.members-10'><div class='marginalizedparent'><a class='marginalized' href='#task.members-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5116'>#</a></div><div id='task.members-10.sentence-1' class='sentence'><span class='textit'>Effects:</span> Exchanges the shared states and stored tasks of <span class='texttt'>*this</span> and <span class='texttt'>other</span><a class='hidden_link' href='#task.members-10.sentence-1'>.</a></div></div></div><div class='para' id='task.members-11'><div class='marginalizedparent'><a class='marginalized' href='#task.members-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5119'>#</a></div><div id='task.members-11.sentence-1' class='sentence'><span class='textit'>Postconditions:</span> <span class='texttt'>*this</span> has the same shared state
and stored task (if any) as <span class='texttt'>other</span>
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#task.members-11.sentence-1'>.</a></div> <div id='task.members-11.sentence-2' class='sentence'><span class='texttt'>other</span> has the same shared state
and stored task (if any)
as <span class='texttt'>*this</span> prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#task.members-11.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:valid,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,valid'></a></span><code class='itemdecl'>bool valid() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.members-12'><div class='marginalizedparent'><a class='marginalized' href='#task.members-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5133'>#</a></div><div id='task.members-12.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>true</span> only if <span class='texttt'>*this</span> has a shared state<a class='hidden_link' href='#task.members-12.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:get_future,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,get_future'></a></span><code class='itemdecl'>future&lt;R&gt; get_future();
</code><div class='itemdescr'></div><div class='para' id='task.members-13'><div class='marginalizedparent'><a class='marginalized' href='#task.members-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5143'>#</a></div><div id='task.members-13.sentence-1' class='sentence'><span class='textit'>Returns:</span> A <span class='texttt'>future</span> object that shares the same shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#task.members-13.sentence-1'>.</a></div></div></div><div class='para' id='task.members-14'><div class='marginalizedparent'><a class='marginalized' href='#task.members-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5146'>#</a></div><div id='task.members-14.sentence-1' class='sentence'><span class='textit'>Throws:</span> A <span class='texttt'>future_&shy;error</span> object if an error occurs<a class='hidden_link' href='#task.members-14.sentence-1'>.</a></div></div></div><div class='para' id='task.members-15'><div class='marginalizedparent'><a class='marginalized' href='#task.members-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5149'>#</a></div><div id='task.members-15.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='task.members-15.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-15.1'>(15.1)</a></div><div id='task.members-15.1.sentence-1' class='sentence'><span class='texttt'>future_&shy;already_&shy;retrieved</span> if <span class='texttt'>get_&shy;future</span> has already been called on
a <span class='texttt'>packaged_&shy;task</span> object with the same shared state as <span class='texttt'>*this</span><a class='hidden_link' href='#task.members-15.1.sentence-1'>.</a></div></li><li id='task.members-15.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-15.2'>(15.2)</a></div><div id='task.members-15.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#task.members-15.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:operator(),packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,operator()'></a></span><code class='itemdecl'>void operator()(ArgTypes... args);
</code><div class='itemdescr'></div><div class='para' id='task.members-16'><div class='marginalizedparent'><a class='marginalized' href='#task.members-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5164'>#</a></div><div id='task.members-16.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'><span class='textit'>INVOKE</span>&lt;R&gt;(f, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span>)</span> (<a href='func.require'>[func.require]</a>),
where <span class='texttt'>f</span> is the
stored task of <span class='texttt'>*this</span> and
<span class='texttt'>t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span> are the values in <span class='texttt'>args...</span><a class='hidden_link' href='#task.members-16.sentence-1'>.</a></div> <div id='task.members-16.sentence-2' class='sentence'>If the task returns normally,
the return value is stored as the asynchronous result in the shared state of
<span class='texttt'>*this</span>, otherwise the exception thrown by the task is stored<a class='hidden_link' href='#task.members-16.sentence-2'>.</a></div> <div id='task.members-16.sentence-3' class='sentence'>The
shared state of <span class='texttt'>*this</span> is made ready, and any threads blocked in a
function waiting for
the shared state of <span class='texttt'>*this</span> to become ready are unblocked<a class='hidden_link' href='#task.members-16.sentence-3'>.</a></div></div></div><div class='para' id='task.members-17'><div class='marginalizedparent'><a class='marginalized' href='#task.members-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5175'>#</a></div><div id='task.members-17.sentence-1' class='sentence'><span class='textit'>Throws:</span> A <span class='texttt'>future_&shy;error</span> exception object if there is no shared
state or the stored task has already been invoked<a class='hidden_link' href='#task.members-17.sentence-1'>.</a></div></div></div><div class='para' id='task.members-18'><div class='marginalizedparent'><a class='marginalized' href='#task.members-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5179'>#</a></div><div id='task.members-18.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='task.members-18.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-18.1'>(18.1)</a></div><div id='task.members-18.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if
the stored task has already been invoked<a class='hidden_link' href='#task.members-18.1.sentence-1'>.</a></div></li><li id='task.members-18.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-18.2'>(18.2)</a></div><div id='task.members-18.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#task.members-18.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:make_ready_at_thread_exit,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,make_ready_at_thread_exit'></a></span><code class='itemdecl'>void make_ready_at_thread_exit(ArgTypes... args);
</code><div class='itemdescr'></div><div class='para' id='task.members-19'><div class='marginalizedparent'><a class='marginalized' href='#task.members-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5194'>#</a></div><div id='task.members-19.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'><span class='textit'>INVOKE</span>&lt;R&gt;(f, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span>)</span> (<a href='func.require'>[func.require]</a>),
where <span class='texttt'>f</span> is the stored task and
<span class='texttt'>t<span class="mjx-chtml"><span class="mjx-math" aria-label="_1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math" aria-label="_N"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span> are the values in <span class='texttt'>args...</span><a class='hidden_link' href='#task.members-19.sentence-1'>.</a></div> <div id='task.members-19.sentence-2' class='sentence'>If the task returns normally,
the return value is stored as the asynchronous result in the shared state of
<span class='texttt'>*this</span>, otherwise the exception thrown by the task is stored<a class='hidden_link' href='#task.members-19.sentence-2'>.</a></div> <div id='task.members-19.sentence-3' class='sentence'>In either
case, this shall be done without making that state ready (<a href='futures.state'>[futures.state]</a>) immediately<a class='hidden_link' href='#task.members-19.sentence-3'>.</a></div> <div id='task.members-19.sentence-4' class='sentence'>Schedules
the shared state to be made ready when the current thread exits,
after all objects of thread storage duration associated with the current thread
have been destroyed<a class='hidden_link' href='#task.members-19.sentence-4'>.</a></div></div></div><div class='para' id='task.members-20'><div class='marginalizedparent'><a class='marginalized' href='#task.members-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5205'>#</a></div><div id='task.members-20.sentence-1' class='sentence'><span class='textit'>Throws:</span> <span class='texttt'>future_&shy;error</span> if an error condition occurs<a class='hidden_link' href='#task.members-20.sentence-1'>.</a></div></div></div><div class='para' id='task.members-21'><div class='marginalizedparent'><a class='marginalized' href='#task.members-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5208'>#</a></div><div id='task.members-21.sentence-1' class='sentence'><span class='textit'>Error conditions:</span> 
<ul class='itemize'><li id='task.members-21.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-21.1'>(21.1)</a></div><div id='task.members-21.1.sentence-1' class='sentence'><span class='texttt'>promise_&shy;already_&shy;satisfied</span> if the
stored task has already been invoked<a class='hidden_link' href='#task.members-21.1.sentence-1'>.</a></div></li><li id='task.members-21.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-21.2'>(21.2)</a></div><div id='task.members-21.2.sentence-1' class='sentence'><span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span> has no shared state<a class='hidden_link' href='#task.members-21.2.sentence-1'>.</a></div></li></ul></div></div></div><span class='indexparent'><a class='index' id='lib:reset,packaged_task'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,reset'></a></span><code class='itemdecl'>void reset();
</code><div class='itemdescr'></div><div class='para' id='task.members-22'><div class='marginalizedparent'><a class='marginalized' href='#task.members-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5223'>#</a></div><div id='task.members-22.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if <span class='texttt'>*this = packaged_&shy;task(std&#x200b;::&#x200b;move(f))</span>, where
<span class='texttt'>f</span> is the task stored in
<span class='texttt'>*this</span><a class='hidden_link' href='#task.members-22.sentence-1'>.</a></div> <div id='task.members-22.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#task.members-22.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='task.members-22.sentence-2' class='sentence'>This constructs a new shared state for <span class='texttt'>*this</span><a class='hidden_link' href='#task.members-22.sentence-2'>.</a></div> <div id='task.members-22.sentence-3' class='sentence'>The
old state is abandoned (<a href='futures.state'>[futures.state]</a>)<a class='hidden_link' href='#task.members-22.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='task.members-23'><div class='marginalizedparent'><a class='marginalized' href='#task.members-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5229'>#</a></div><div id='task.members-23.sentence-1' class='sentence'><span class='textit'>Throws:</span> 
<ul class='itemize'><li id='task.members-23.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-23.1'>(23.1)</a></div><div id='task.members-23.1.sentence-1' class='sentence'><span class='texttt'>bad_&shy;alloc</span> if memory for the new shared state could not be allocated<a class='hidden_link' href='#task.members-23.1.sentence-1'>.</a></div></li><li id='task.members-23.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-23.2'>(23.2)</a></div><div id='task.members-23.2.sentence-1' class='sentence'>any exception thrown by the move constructor of the task stored in the shared
state<a class='hidden_link' href='#task.members-23.2.sentence-1'>.</a></div></li><li id='task.members-23.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#task.members-23.3'>(23.3)</a></div><div id='task.members-23.3.sentence-1' class='sentence'><span class='texttt'>future_&shy;error</span> with an error condition of <span class='texttt'>no_&shy;state</span> if <span class='texttt'>*this</span>
has no shared state<a class='hidden_link' href='#task.members-23.3.sentence-1'>.</a></div></li></ul></div></div></div></div><div id='task.nonmembers' class='section'><h4 ><a class='secnum' href='#task.nonmembers' style='min-width:118pt'>33.6.10.2</a> <span class='texttt'>packaged_&shy;task</span> globals <a class='abbr_ref' href='futures.task.nonmembers'>[futures.task.nonmembers]</a></h4><span class='indexparent'><a class='index' id='lib:swap,packaged_task_'></a></span><span class='indexparent'><a class='index' id='lib:packaged_task,swap_'></a></span><code class='itemdecl'>template &lt;class R, class... ArgTypes&gt;
  void swap(packaged_task&lt;R(ArgTypes...)&gt;&amp; x, packaged_task&lt;R(ArgTypes...)&gt;&amp; y) noexcept;
</code><div class='itemdescr'></div><div class='para' id='task.nonmembers-1'><div class='marginalizedparent'><a class='marginalized' href='#task.nonmembers-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5249'>#</a></div><div id='task.nonmembers-1.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'>x.swap(y)</span><a class='hidden_link' href='#task.nonmembers-1.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:uses_allocator,packaged_task'></a></span><code class='itemdecl'>template &lt;class R, class Alloc&gt;
  struct uses_allocator&lt;packaged_task&lt;R&gt;, Alloc&gt;
    : true_type { };
</code><div class='itemdescr'></div><div class='para' id='task.nonmembers-2'><div class='marginalizedparent'><a class='marginalized' href='#task.nonmembers-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e3b4927ea0f4e8c8bf1f7461226c729b4e2c00be/source/threads.tex#L5261'>#</a></div><div id='task.nonmembers-2.sentence-1' class='sentence'><span class='textit'>Requires:</span> <span class='texttt'>Alloc</span> shall be an <a href='allocator.requirements'>Allocator</a><a class='hidden_link' href='#task.nonmembers-2.sentence-1'>.</a></div></div></div></div></div></div></body></html>