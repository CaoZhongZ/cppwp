<!DOCTYPE html><html lang='en'><head><title>[utility]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>19</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>19.2</a> Utility components <a class='abbr_ref'>[utility]</a></h2><span class='indexparent'><a class='index' id=':<utility>'></a></span><span class='indexparent'><a class='index' id=':<utility>'></a></span><span class='indexparent'><a class='index' id='lib:rel_ops'></a></span><div id='syn' class='section'><h3 ><a class='secnum' href='#syn' style='min-width:103pt'>19.2.1</a> Header <span class='texttt'>&lt;utility&gt;</span> synopsis <a class='abbr_ref' href='utility.syn'>[utility.syn]</a></h3><div class='para' id='syn-1'><div class='marginalizedparent'><a class='marginalized' href='#syn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L39'>#</a></div><div id='syn-1.sentence-1' class='sentence'>The header <span class='texttt'>&lt;utility&gt;</span>
contains some basic function and class templates that are used
throughout the rest of the library<a class='hidden_link' href='#syn-1.sentence-1'>.</a></div><pre class='codeblock'>
#include &lt;initializer_list&gt;     <span class='comment'>// see <a href='initializer_list.syn'>[initializer_list.syn]</a>
</span>
namespace std {
  <span class='comment'>// <a href='#swap'>[utility.swap]</a>, swap
</span>  template&lt;class T&gt;
    constexpr void swap(T&amp; a, T&amp; b) noexcept(<span class='textit'><span class='texttt'>see below</span></span>);
  template&lt;class T, size_t N&gt;
    constexpr void swap(T (&amp;a)[N], T (&amp;b)[N]) noexcept(is_nothrow_swappable_v&lt;T&gt;);

  <span class='comment'>// <a href='#exchange'>[utility.exchange]</a>, exchange
</span>  template&lt;class T, class U = T&gt;
    constexpr T exchange(T&amp; obj, U&amp;&amp; new_val);

  <span class='comment'>// <a href='#forward'>[forward]</a>, forward/move
</span>  template&lt;class T&gt;
    constexpr T&amp;&amp; forward(remove_reference_t&lt;T&gt;&amp; t) noexcept;
  template&lt;class T&gt;
    constexpr T&amp;&amp; forward(remove_reference_t&lt;T&gt;&amp;&amp; t) noexcept;
  template&lt;class T&gt;
    constexpr remove_reference_t&lt;T&gt;&amp;&amp; move(T&amp;&amp;) noexcept;
  template&lt;class T&gt;
    constexpr conditional_t&lt;
        !is_nothrow_move_constructible_v&lt;T&gt; &amp;&amp; is_copy_constructible_v&lt;T&gt;, const T&amp;, T&amp;&amp;&gt;
      move_if_noexcept(T&amp; x) noexcept;

  <span class='comment'>// <a href='#as_const'>[utility.as_const]</a>, <span class='tcode_in_codeblock'>as_&shy;const</span>
</span>  template&lt;class T&gt;
    constexpr add_const_t&lt;T&gt;&amp; as_const(T&amp; t) noexcept;
  template&lt;class T&gt;
    void as_const(const T&amp;&amp;) = delete;

  <span class='comment'>// <a href='#declval'>[declval]</a>, declval
</span>  template&lt;class T&gt;
    add_rvalue_reference_t&lt;T&gt; declval() noexcept;  <span class='comment'>// as unevaluated operand
</span>
  <span class='comment'>// <a href='intseq'>[intseq]</a>, Compile-time integer sequences
</span>  template&lt;class T, T...&gt;
    struct integer_sequence;
  template&lt;size_t... I&gt;
    using <span id='lib:index_sequence'><span class='tcode_in_codeblock'>index_&shy;sequence</span></span> = integer_sequence&lt;size_t, I...&gt;;

  template&lt;class T, T N&gt;
    using make_integer_sequence = integer_sequence&lt;T, <span class='textit'><span class='texttt'>see below</span></span>&gt;;
  template&lt;size_t N&gt;
    using <span id='lib:make_index_sequence'><span class='tcode_in_codeblock'>make_&shy;index_&shy;sequence</span></span> = make_integer_sequence&lt;size_t, N&gt;;

  template&lt;class... T&gt;
    using <span id='lib:index_sequence_for'><span class='tcode_in_codeblock'>index_&shy;sequence_&shy;for</span></span> = make_index_sequence&lt;sizeof...(T)&gt;;

  <span class='comment'>// <a href='pairs'>[pairs]</a>, class template <span class='tcode_in_codeblock'>pair</span>
</span>  template&lt;class T1, class T2&gt;
    struct pair;

  <span class='comment'>// <a href='pairs.spec'>[pairs.spec]</a>, pair specialized algorithms
</span>  template&lt;class T1, class T2&gt;
    constexpr bool operator==(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
  template&lt;class T1, class T2&gt;
    constexpr bool operator!=(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
  template&lt;class T1, class T2&gt;
    constexpr bool operator&lt; (const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
  template&lt;class T1, class T2&gt;
    constexpr bool operator&gt; (const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
  template&lt;class T1, class T2&gt;
    constexpr bool operator&lt;=(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
  template&lt;class T1, class T2&gt;
    constexpr bool operator&gt;=(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);

  template&lt;class T1, class T2&gt;
    void swap(pair&lt;T1, T2&gt;&amp; x, pair&lt;T1, T2&gt;&amp; y) noexcept(noexcept(x.swap(y)));

  template&lt;class T1, class T2&gt;
    constexpr <span class='textit'><span class='texttt'>see below</span></span> make_pair(T1&amp;&amp;, T2&amp;&amp;);

  <span class='comment'>// <a href='pair.astuple'>[pair.astuple]</a>, tuple-like access to pair
</span>  template&lt;class T&gt; class tuple_size;
  template&lt;size_t I, class T&gt; class tuple_element;

  template&lt;class T1, class T2&gt; struct tuple_size&lt;pair&lt;T1, T2&gt;&gt;;
  template&lt;size_t I, class T1, class T2&gt; struct tuple_element&lt;I, pair&lt;T1, T2&gt;&gt;;

  template&lt;size_t I, class T1, class T2&gt;
    constexpr tuple_element_t&lt;I, pair&lt;T1, T2&gt;&gt;&amp; get(pair&lt;T1, T2&gt;&amp;) noexcept;
  template&lt;size_t I, class T1, class T2&gt;
    constexpr tuple_element_t&lt;I, pair&lt;T1, T2&gt;&gt;&amp;&amp; get(pair&lt;T1, T2&gt;&amp;&amp;) noexcept;
  template&lt;size_t I, class T1, class T2&gt;
    constexpr const tuple_element_t&lt;I, pair&lt;T1, T2&gt;&gt;&amp; get(const pair&lt;T1, T2&gt;&amp;) noexcept;
  template&lt;size_t I, class T1, class T2&gt;
    constexpr const tuple_element_t&lt;I, pair&lt;T1, T2&gt;&gt;&amp;&amp; get(const pair&lt;T1, T2&gt;&amp;&amp;) noexcept;
  template&lt;class T1, class T2&gt;
    constexpr T1&amp; get(pair&lt;T1, T2&gt;&amp; p) noexcept;
  template&lt;class T1, class T2&gt;
    constexpr const T1&amp; get(const pair&lt;T1, T2&gt;&amp; p) noexcept;
  template&lt;class T1, class T2&gt;
    constexpr T1&amp;&amp; get(pair&lt;T1, T2&gt;&amp;&amp; p) noexcept;
  template&lt;class T1, class T2&gt;
    constexpr const T1&amp;&amp; get(const pair&lt;T1, T2&gt;&amp;&amp; p) noexcept;
  template&lt;class T2, class T1&gt;
    constexpr T2&amp; get(pair&lt;T1, T2&gt;&amp; p) noexcept;
  template&lt;class T2, class T1&gt;
    constexpr const T2&amp; get(const pair&lt;T1, T2&gt;&amp; p) noexcept;
  template&lt;class T2, class T1&gt;
    constexpr T2&amp;&amp; get(pair&lt;T1, T2&gt;&amp;&amp; p) noexcept;
  template&lt;class T2, class T1&gt;
    constexpr const T2&amp;&amp; get(const pair&lt;T1, T2&gt;&amp;&amp; p) noexcept;

  <span class='comment'>// <a href='pair.piecewise'>[pair.piecewise]</a>, pair piecewise construction
</span>  struct piecewise_construct_t {
    explicit piecewise_construct_t() = default;
  };
  inline constexpr piecewise_construct_t piecewise_construct{};
  template&lt;class... Types&gt; class tuple;        <span class='comment'>// defined in <a href='tuple.syn'><span class='tcode_in_codeblock'>&lt;tuple&gt;</span></a>
</span>
  <span class='comment'>// in-place construction
</span>  struct in_place_t {
    explicit in_place_t() = default;
  };
  inline constexpr in_place_t in_place{};
  template&lt;class T&gt;
    struct in_place_type_t {
      explicit in_place_type_t() = default;
    };
  template&lt;class T&gt; inline constexpr in_place_type_t&lt;T&gt; in_place_type{};
  template&lt;size_t I&gt;
    struct in_place_index_t {
      explicit in_place_index_t() = default;
    };
  template&lt;size_t I&gt; inline constexpr in_place_index_t&lt;I&gt; in_place_index{};
}</pre></div></div><div id='swap' class='section'><h3 ><a class='secnum' href='#swap' style='min-width:103pt'>19.2.2</a> <span class='texttt'>swap</span> <a class='abbr_ref' href='utility.swap'>[utility.swap]</a></h3><span class='indexparent'><a class='index' id='lib:swap'></a></span><div class='itemdecl' id='swap-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#swap-itemdecl:1'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt;
  constexpr void swap(T&amp; a, T&amp; b) noexcept(<span class='textit'><span class='texttt'>see below</span></span>);
</code></div><div class='itemdescr'></div><div class='para' id='swap-1'><div class='marginalizedparent'><a class='marginalized' href='#swap-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L184'>#</a></div><div id='swap-1.sentence-1' class='sentence'><span class='textit'>Remarks:</span> This function
is a designated customization point (<a href='namespace.std'>[namespace.std]</a>) and
shall not participate in overload resolution
unless <span class='texttt'>is_&shy;move_&shy;constructible_&shy;v&lt;T&gt;</span> is <span class='texttt'>true</span> and
<span class='texttt'>is_&shy;move_&shy;assignable_&shy;v&lt;T&gt;</span> is <span class='texttt'>true</span><a class='hidden_link' href='#swap-1.sentence-1'>.</a></div> <div id='swap-1.sentence-2' class='sentence'>The expression inside <span class='texttt'>noexcept</span> is equivalent to:</div><pre class='codeblock'>
is_nothrow_move_constructible_v&lt;T&gt; &amp;&amp; is_nothrow_move_assignable_v&lt;T&gt;</pre></div></div><div class='para' id='swap-2'><div class='marginalizedparent'><a class='marginalized' href='#swap-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L196'>#</a></div><div id='swap-2.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
Type
<span class='texttt'>T</span>
shall be
<span class='textit'>Cpp17MoveConstructible</span> (Table <a href='utility.arg.requirements#tab:moveconstructible'>25</a>)
and
<span class='textit'>Cpp17MoveAssignable</span> (Table <a href='utility.arg.requirements#tab:moveassignable'>27</a>)<a class='hidden_link' href='#swap-2.sentence-1'>.</a></div></div></div><div class='para' id='swap-3'><div class='marginalizedparent'><a class='marginalized' href='#swap-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L205'>#</a></div><div id='swap-3.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Exchanges values stored in two locations<a class='hidden_link' href='#swap-3.sentence-1'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:swap_'></a></span><div class='itemdecl' id='swap-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#swap-itemdecl:2'>🔗</a></div><code class='itemdeclcode'>template&lt;class T, size_t N&gt;
  constexpr void swap(T (&amp;a)[N], T (&amp;b)[N]) noexcept(is_nothrow_swappable_v&lt;T&gt;);
</code></div><div class='itemdescr'></div><div class='para' id='swap-4'><div class='marginalizedparent'><a class='marginalized' href='#swap-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L217'>#</a></div><div id='swap-4.sentence-1' class='sentence'><span class='textit'>Remarks:</span> 
This function shall not participate in overload resolution
unless <span class='texttt'>is_&shy;swappable_&shy;v&lt;T&gt;</span> is <span class='texttt'>true</span><a class='hidden_link' href='#swap-4.sentence-1'>.</a></div></div></div><div class='para' id='swap-5'><div class='marginalizedparent'><a class='marginalized' href='#swap-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L222'>#</a></div><div id='swap-5.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
<span class='texttt'>a[i]</span> shall be <a href='swappable.requirements#def:swappable_with'>swappable with</a> <span class='texttt'>b[i]</span>
for all <span class='texttt'>i</span> in the range <span class='texttt'>[0, N)</span><a class='hidden_link' href='#swap-5.sentence-1'>.</a></div></div></div><div class='para' id='swap-6'><div class='marginalizedparent'><a class='marginalized' href='#swap-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L227'>#</a></div><div id='swap-6.sentence-1' class='sentence'><span class='textit'>Effects:</span> As if by <span class='texttt'>swap_&shy;ranges(a, a + N, b)</span><a class='hidden_link' href='#swap-6.sentence-1'>.</a></div></div></div></div><div id='exchange' class='section'><h3 ><a class='secnum' href='#exchange' style='min-width:103pt'>19.2.3</a> <span class='texttt'>exchange</span> <a class='abbr_ref' href='utility.exchange'>[utility.exchange]</a></h3><span class='indexparent'><a class='index' id='lib:exchange'></a></span><div class='itemdecl' id='exchange-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exchange-itemdecl:1'>🔗</a></div><code class='itemdeclcode'>template&lt;class T, class U = T&gt;
  constexpr T exchange(T&amp; obj, U&amp;&amp; new_val);
</code></div><div class='itemdescr'></div><div class='para' id='exchange-1'><div class='marginalizedparent'><a class='marginalized' href='#exchange-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L240'>#</a></div><div id='exchange-1.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Equivalent to:
<pre class='codeblock'>
T old_val = std::move(obj);
obj = std::forward&lt;U&gt;(new_val);
return old_val;</pre></div></div></div></div><div id='forward' class='section'><h3 ><a class='secnum' href='#forward' style='min-width:103pt'>19.2.4</a> Forward/move helpers <a class='abbr_ref' href='forward'>[forward]</a></h3><div class='para' id='forward-1'><div class='marginalizedparent'><a class='marginalized' href='#forward-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L253'>#</a></div><div id='forward-1.sentence-1' class='sentence'>The library provides templated helper functions to simplify
applying move semantics to an lvalue and to simplify the implementation
of forwarding functions<a class='hidden_link' href='#forward-1.sentence-1'>.</a></div> <div id='forward-1.sentence-2' class='sentence'><span class='indexparent'><a class='index' id=':signal-safe,forward'></a></span><span class='indexparent'><a class='index' id=':signal-safe,move'></a></span><span class='indexparent'><a class='index' id=':signal-safe,move_if_noexcept'></a></span>All functions specified in this subclause are <a href='support.signal#def:evaluation,signal-safe'>signal-safe</a><a class='hidden_link' href='#forward-1.sentence-2'>.</a></div> <span class='indexparent'><a class='index' id='lib:forward'></a></span><span class='indexparent'><a class='index' id=':forward'></a></span></div><div class='itemdecl' id='forward-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#forward-itemdecl:1'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt; constexpr T&amp;&amp; forward(remove_reference_t&lt;T&gt;&amp; t) noexcept;
template&lt;class T&gt; constexpr T&amp;&amp; forward(remove_reference_t&lt;T&gt;&amp;&amp; t) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='forward-2'><div class='marginalizedparent'><a class='marginalized' href='#forward-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L270'>#</a></div><div id='forward-2.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>static_&shy;cast&lt;T&amp;&amp;&gt;(t)</span><a class='hidden_link' href='#forward-2.sentence-1'>.</a></div></div></div><div class='para' id='forward-3'><div class='marginalizedparent'><a class='marginalized' href='#forward-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L273'>#</a></div><div id='forward-3.sentence-1' class='sentence'><span class='textit'>Remarks:</span> If the second form is instantiated with an lvalue reference type, the program is ill-formed<a class='hidden_link' href='#forward-3.sentence-1'>.</a></div></div></div><div class='para' id='forward-4'><div class='marginalizedparent'><a class='marginalized' href='#forward-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L276'>#</a></div><div id='forward-4.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#forward-4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
template&lt;class T, class A1, class A2&gt;
shared_ptr&lt;T&gt; factory(A1&amp;&amp; a1, A2&amp;&amp; a2) {
  return shared_ptr&lt;T&gt;(new T(std::forward&lt;A1&gt;(a1), std::forward&lt;A2&gt;(a2)));
}

struct A {
  A(int&amp;, const double&amp;);
};

void g() {
  shared_ptr&lt;A&gt; sp1 = factory&lt;A&gt;(2, 1.414); <span class='comment'>// error: 2 will not bind to <span class='tcode_in_codeblock'>int&amp;</span>
</span>  int i = 2;
  shared_ptr&lt;A&gt; sp2 = factory&lt;A&gt;(i, 1.414); <span class='comment'>// OK
</span>}</pre> <div id='forward-4.sentence-1' class='sentence'>
In the first call to <span class='texttt'>factory</span>,
<span class='texttt'>A1</span> is deduced as <span class='texttt'>int</span>, so 2 is forwarded
to <span class='texttt'>A</span>'s constructor as an rvalue<a class='hidden_link' href='#forward-4.sentence-1'>.</a></div> <div id='forward-4.sentence-2' class='sentence'>In the second call to <span class='texttt'>factory</span>,
<span class='texttt'>A1</span> is deduced as <span class='texttt'>int&amp;</span>, so <span class='texttt'>i</span> is forwarded
to <span class='texttt'>A</span>'s constructor as an lvalue<a class='hidden_link' href='#forward-4.sentence-2'>.</a></div> <div id='forward-4.sentence-3' class='sentence'>In
both cases, <span class='texttt'>A2</span> is deduced as <span class='texttt'>double</span>, so
1.414 is forwarded to <span class='texttt'>A</span>'s constructor as an rvalue<a class='hidden_link' href='#forward-4.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><span class='indexparent'><a class='index' id='lib:move,function'></a></span><span class='indexparent'><a class='index' id=':move'></a></span><div class='itemdecl' id='forward-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#forward-itemdecl:2'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt; constexpr remove_reference_t&lt;T&gt;&amp;&amp; move(T&amp;&amp; t) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='forward-5'><div class='marginalizedparent'><a class='marginalized' href='#forward-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L312'>#</a></div><div id='forward-5.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<span class='texttt'>static_&shy;cast&lt;remove_&shy;reference_&shy;t&lt;T&gt;&amp;&amp;&gt;(t)</span><a class='hidden_link' href='#forward-5.sentence-1'>.</a></div></div></div><div class='para' id='forward-6'><div class='marginalizedparent'><a class='marginalized' href='#forward-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L316'>#</a></div><div id='forward-6.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#forward-6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
template&lt;class T, class A1&gt;
shared_ptr&lt;T&gt; factory(A1&amp;&amp; a1) {
  return shared_ptr&lt;T&gt;(new T(std::forward&lt;A1&gt;(a1)));
}

struct A {
  A();
  A(const A&amp;);      <span class='comment'>// copies from lvalues
</span>  A(A&amp;&amp;);           <span class='comment'>// moves from rvalues
</span>};

void g() {
  A a;
  shared_ptr&lt;A&gt; sp1 = factory&lt;A&gt;(a);                <span class='comment'>// “<span class='tcode_in_codeblock'>a</span>” binds to <span class='tcode_in_codeblock'>A(const A&amp;)</span>
</span>  shared_ptr&lt;A&gt; sp1 = factory&lt;A&gt;(std::move(a));     <span class='comment'>// “<span class='tcode_in_codeblock'>a</span>” binds to <span class='tcode_in_codeblock'>A(A&amp;&amp;)</span>
</span>}</pre> <div id='forward-6.sentence-1' class='sentence'>
In the first call to <span class='texttt'>factory</span>,
<span class='texttt'>A1</span> is deduced as <span class='texttt'>A&amp;</span>, so <span class='texttt'>a</span> is forwarded
as a non-const lvalue<a class='hidden_link' href='#forward-6.sentence-1'>.</a></div> <div id='forward-6.sentence-2' class='sentence'>This binds to the constructor <span class='texttt'>A(const A&amp;)</span>,
which copies the value from <span class='texttt'>a</span><a class='hidden_link' href='#forward-6.sentence-2'>.</a></div> <div id='forward-6.sentence-3' class='sentence'>In the second call to <span class='texttt'>factory</span>, because of the call
<span class='texttt'>std&#x200b;::&#x200b;move(a)</span>,
<span class='texttt'>A1</span> is deduced as <span class='texttt'>A</span>, so <span class='texttt'>a</span> is forwarded
as an rvalue<a class='hidden_link' href='#forward-6.sentence-3'>.</a></div> <div id='forward-6.sentence-4' class='sentence'>This binds to the constructor <span class='texttt'>A(A&amp;&amp;)</span>,
which moves the value from <span class='texttt'>a</span><a class='hidden_link' href='#forward-6.sentence-4'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><span class='indexparent'><a class='index' id='lib:move_if_noexcept'></a></span><div class='itemdecl' id='forward-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#forward-itemdecl:3'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt; constexpr conditional_t&lt;
    !is_nothrow_move_constructible_v&lt;T&gt; &amp;&amp; is_copy_constructible_v&lt;T&gt;, const T&amp;, T&amp;&amp;&gt;
  move_if_noexcept(T&amp; x) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='forward-7'><div class='marginalizedparent'><a class='marginalized' href='#forward-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L356'>#</a></div><div id='forward-7.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>std&#x200b;::&#x200b;move(x)</span><a class='hidden_link' href='#forward-7.sentence-1'>.</a></div></div></div></div><div id='as_const' class='section'><h3 ><a class='secnum' href='#as_const' style='min-width:103pt'>19.2.5</a> Function template <span class='texttt'>as_&shy;const</span> <a class='abbr_ref' href='utility.as_const'>[utility.as_const]</a></h3><span class='indexparent'><a class='index' id='lib:as_const'></a></span><div class='itemdecl' id='as_const-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#as_const-itemdecl:1'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt; constexpr add_const_t&lt;T&gt;&amp; as_const(T&amp; t) noexcept;
</code></div><div class='itemdescr'></div><div class='para' id='as_const-1'><div class='marginalizedparent'><a class='marginalized' href='#as_const-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L368'>#</a></div><div id='as_const-1.sentence-1' class='sentence'><span class='textit'>Returns:</span> <span class='texttt'>t</span><a class='hidden_link' href='#as_const-1.sentence-1'>.</a></div></div></div></div><div id='declval' class='section'><h3 ><a class='secnum' href='#declval' style='min-width:103pt'>19.2.6</a> Function template <span class='texttt'>declval</span> <a class='abbr_ref' href='declval'>[declval]</a></h3><div class='para' id='declval-1'><div class='marginalizedparent'><a class='marginalized' href='#declval-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L374'>#</a></div><div id='declval-1.sentence-1' class='sentence'>The library provides the function template <span class='texttt'>declval</span> to simplify the definition of
expressions which occur as <a href='expr.prop#def:unevaluated_operand'>unevaluated operands</a><a class='hidden_link' href='#declval-1.sentence-1'>.</a></div> <span class='indexparent'><a class='index' id='lib:declval'></a></span></div><div class='itemdecl' id='declval-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#declval-itemdecl:1'>🔗</a></div><code class='itemdeclcode'>template&lt;class T&gt; add_rvalue_reference_t&lt;T&gt; declval() noexcept;    <span class='comment'>// as unevaluated operand
</span></code></div><div class='itemdescr'></div><div class='para' id='declval-2'><div class='marginalizedparent'><a class='marginalized' href='#declval-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L384'>#</a></div><div id='declval-2.sentence-1' class='sentence'><span class='textit'>Remarks:</span> If this function is <a href='basic.def.odr'>odr-used</a>, the program is ill-formed<a class='hidden_link' href='#declval-2.sentence-1'>.</a></div></div></div><div class='para' id='declval-3'><div class='marginalizedparent'><a class='marginalized' href='#declval-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L387'>#</a></div><div id='declval-3.sentence-1' class='sentence'><span class='textit'>Remarks:</span> The template parameter <span class='texttt'>T</span> of <span class='texttt'>declval</span> may be an incomplete type<a class='hidden_link' href='#declval-3.sentence-1'>.</a></div></div></div><div class='para' id='declval-4'><div class='marginalizedparent'><a class='marginalized' href='#declval-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/utilities.tex#L391'>#</a></div><div id='declval-4.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#declval-4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
template&lt;class To, class From&gt; decltype(static_cast&lt;To&gt;(declval&lt;From&gt;())) convert(From&amp;&amp;);</pre> <div id='declval-4.sentence-1' class='sentence'>
declares a function template <span class='texttt'>convert</span> which only participates in overloading if the
type <span class='texttt'>From</span> can be explicitly converted to type <span class='texttt'>To</span><a class='hidden_link' href='#declval-4.sentence-1'>.</a></div> <div id='declval-4.sentence-2' class='sentence'>For another example see class
template <span class='texttt'>common_&shy;type</span> (<a href='meta.trans.other'>[meta.trans.other]</a>)<a class='hidden_link' href='#declval-4.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></div></body></html>