<!DOCTYPE html><html lang='en'><head><title>[new.delete.single]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>18</a> Language support library <a class='abbr_ref' href='./#language.support'>[language.support]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>18.6</a> Dynamic memory management <a class='abbr_ref' href='support.dynamic#new.delete.single'>[support.dynamic]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>18.6.2</a> Storage allocation and deallocation <a class='abbr_ref' href='new.delete#single'>[new.delete]</a></h3><div id='new.delete.single'><h4 ><a class='secnum' style='min-width:118pt'>18.6.2.1</a> Single-object forms <a class='abbr_ref'>[new.delete.single]</a></h4><p ><span class='indexparent'><a class='index' id='new,operator'></a></span><code class='itemdecl'>
void* operator new(std::size_t size);
void* operator new(std::size_t size, std::align_val_t alignment);
</code></p><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1704'>#</a></div><p ><i>Effects:</i>
The
allocation functions (<a href='basic.stc.dynamic.allocation'>[basic.stc.dynamic.allocation]</a>)
called by a
<i ><a href='expr.new#nt:new-expression'>new-expression</a></i> (<a href='expr.new'>[expr.new]</a>)
to allocate
<span class='texttt'>size</span> bytes of storage.
The second form is called for a type with new-extended alignment,
and allocates storage
with the specified alignment.
The first form is called otherwise,
and allocates storage
suitably aligned to represent any object of that size
provided the object's type does not have new-extended alignment.</p></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1720'>#</a></div><p ><i>Replaceable:</i>
A C++ program may define functions with either of these function signatures,
and thereby displace the default versions defined by the
C++ standard library.</p></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1724'>#</a></div><p ><i>Required behavior:</i> 
Return a non-null pointer to suitably aligned storage (<a href='basic.stc.dynamic'>[basic.stc.dynamic]</a>),
or else throw a
<span class='texttt'>bad_alloc</span>
<span class='indexparent'><a class='index' id='bad_alloc'></a></span>exception.
This requirement is binding on any replacement versions of these functions.</p></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1733'>#</a></div><p ><i>Default behavior:</i></p><ul class='itemize'><li id='4.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#4.1'>(4.1)</a></div><p >Executes a loop:
Within the loop, the function first attempts to allocate the requested storage.
Whether the attempt involves a call to the C standard library functions
<span class='texttt'>malloc</span> or <span class='texttt'>aligned_alloc</span>
is unspecified.
<span class='indexparent'><a class='index' id='unspecified'></a></span></p></li><li id='4.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#4.2'>(4.2)</a></div><p >Returns a pointer to the allocated storage if the attempt is successful.
Otherwise, if the
current <span class='texttt'>new_handler</span> (<a href='get.new.handler'>[get.new.handler]</a>) is
a null pointer value, throws
<span class='texttt'>bad_alloc</span>.
</p></li><li id='4.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#4.3'>(4.3)</a></div><p >Otherwise, the function calls the current
<span class='texttt'>new_handler</span> function (<a href='new.handler'>[new.handler]</a>).
If the called function returns, the loop repeats.
</p></li><li id='4.4'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#4.4'>(4.4)</a></div><p >The loop terminates when an attempt to allocate the requested storage is
successful or when a called
<span class='texttt'>new_handler</span>
function does not return.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='new,operator'></a></span><code class='itemdecl'>
void* operator new(std::size_t size, const std::nothrow_t&amp;) noexcept;
void* operator new(std::size_t size, std::align_val_t alignment, const std::nothrow_t&amp;) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1769'>#</a></div><p ><i>Effects:</i>
Same as above, except that these are called by a placement version of a
<i ><a href='expr.new#nt:new-expression'>new-expression</a></i>
when a C++ program prefers a null pointer result as an error indication,
instead of a
<span class='texttt'>bad_alloc</span>
exception.</p></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1778'>#</a></div><p ><i>Replaceable:</i>
A C++ program may define functions with either of these function signatures,
and thereby displace the default versions defined by the
C++ standard library.</p></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1782'>#</a></div><p ><i>Required behavior:</i>
Return a non-null pointer to suitably aligned storage (<a href='basic.stc.dynamic'>[basic.stc.dynamic]</a>),
or else return a null pointer.
Each of these nothrow versions of
<span class='texttt'>operator new</span>
returns a pointer obtained as if
acquired from the (possibly replaced)
corresponding non-placement function.
This requirement is binding on any replacement versions of these functions.</p></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1793'>#</a></div><p ><i>Default behavior:</i>
Calls <span class='texttt'>operator new(size)</span>,
or <span class='texttt'>operator new(size, alignment)</span>,
respectively.
If the call returns normally,
returns the result of that call.
Otherwise, returns a null pointer.</p></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1802'>#</a></div><p >[ <i>Example:</i>
</p><pre class='codeblock'>
T* p1 = new T;                  <span class='comment'>// throws <span class='texttt'>bad_alloc</span> if it fails
</span>T* p2 = new(nothrow) T;         <span class='comment'>// returns <span class='texttt'>nullptr</span> if it fails
</span></pre><p ><i> â€” end example</i> ]
</p></div></div><p ><span class='indexparent'><a class='index' id='delete,operator'></a></span><code class='itemdecl'>
void operator delete(void* ptr) noexcept;
void operator delete(void* ptr, std::size_t size) noexcept;
void operator delete(void* ptr, std::align_val_t alignment) noexcept;
void operator delete(void* ptr, std::size_t size, std::align_val_t alignment) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1820'>#</a></div><p ><i>Effects:</i>
The
deallocation functions (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>)
called by a
<i ><a href='expr.delete#nt:delete-expression'>delete-expression</a></i>
to render the value of <span class='texttt'>ptr</span> invalid.</p></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1828'>#</a></div><p ><i>Replaceable:</i>
A C++ program may define functions with any of these function signatures,
and thereby displace the default versions defined by the
C++ standard library.
If a function without a <span class='texttt'>size</span> parameter is defined,
the program should also define
the corresponding function with a <span class='texttt'>size</span> parameter.
If a function with a <span class='texttt'>size</span> parameter is defined,
the program shall also define
the corresponding version without the <span class='texttt'>size</span> parameter.
[ <i>Note:</i>
The default behavior below may change in the future, which will require
replacing both deallocation functions when replacing the allocation function.
<i> â€” end note</i> ]</p></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1842'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>ptr</span> shall be a null pointer or
its value shall represent the address of
a block of memory allocated by
an earlier call to a (possibly replaced)
<span class='texttt'>operator new(std::size_t)</span>
or
<span class='texttt'>operator new(std::size_t, std::align_val_t)</span>
which has not been invalidated by an intervening call to
<span class='texttt'>operator delete</span>.</p></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1854'>#</a></div><p ><i>Requires:</i>
If an implementation has strict pointer safety (<a href='basic.stc.dynamic.safety'>[basic.stc.dynamic.safety]</a>)
then <span class='texttt'>ptr</span> shall be a safely-derived pointer.</p></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1859'>#</a></div><p ><i>Requires:</i>
If the <span class='texttt'>alignment</span> parameter is not present,
<span class='texttt'>ptr</span> shall have been returned by an allocation function
without an <span class='texttt'>alignment</span> parameter.
If present, the <span class='texttt'>alignment</span> argument
shall equal the <span class='texttt'>alignment</span> argument
passed to the allocation function that returned <span class='texttt'>ptr</span>.
If present, the <span class='texttt'>size</span> argument
shall equal the <span class='texttt'>size</span> argument
passed to the allocation function that returned <span class='texttt'>ptr</span>.</p></div></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1871'>#</a></div><p ><i>Required behavior:</i>
A call to an <span class='texttt'>operator delete</span>
with a <span class='texttt'>size</span> parameter
may be changed to
a call to the corresponding <span class='texttt'>operator delete</span>
without a <span class='texttt'>size</span> parameter,
without affecting memory allocation.
[ <i>Note:</i> A conforming implementation is for
<span class='texttt'>operator delete(void* ptr, std::size_t size)</span> to simply call
<span class='texttt'>operator delete(ptr)</span>. <i> â€” end note</i> ]</p></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1883'>#</a></div><p ><i>Default behavior:</i>
The functions that have a <span class='texttt'>size</span> parameter
forward their other parameters
to the corresponding function without a <span class='texttt'>size</span> parameter.
[ <i>Note:</i> See the note in the above <i>Replaceable:</i> paragraph. <i> â€” end note</i> ]</p></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1890'>#</a></div><p ><i>Default behavior:</i>
If <span class='texttt'>ptr</span> is null, does nothing. Otherwise, reclaims the
storage allocated by the earlier call to <span class='texttt'>operator new</span>.</p></div></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1895'>#</a></div><p ><i>Remarks:</i>
It is unspecified under what conditions part or all of such
<span class='indexparent'><a class='index' id='unspecified'></a></span>reclaimed storage will be allocated by subsequent
calls to
<span class='texttt'>operator new</span>
or any of
<span class='texttt'>aligned_alloc</span>,
<span class='texttt'>calloc</span>,
<span class='texttt'>malloc</span>,
or
<span class='texttt'>realloc</span>,
declared in
<span class='texttt'>&lt;cstdlib&gt;</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='delete,operator'></a></span><code class='itemdecl'>
void operator delete(void* ptr, const std::nothrow_t&amp;) noexcept;
void operator delete(void* ptr, std::align_val_t alignment, const std::nothrow_t&amp;) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1919'>#</a></div><p ><i>Effects:</i>
The
deallocation functions (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>)
called by the implementation
to render the value of <span class='texttt'>ptr</span> invalid
when the constructor invoked from a nothrow
placement version of the <i ><a href='expr.new#nt:new-expression'>new-expression</a></i> throws an exception.</p></div></div><div class='para' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1928'>#</a></div><p ><i>Replaceable:</i>
A C++ program may define functions with either of these function signatures,
and thereby displace the default versions defined by the
C++ standard library.</p></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1932'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>ptr</span> shall be a null pointer or
its value shall represent the address of
a block of memory allocated by
an earlier call to a (possibly replaced)
<span class='texttt'>operator new(std::size_t)</span>
or
<span class='texttt'>operator new(std::size_t, std::align_val_t)</span>
which has not been invalidated by an intervening call to
<span class='texttt'>operator delete</span>.</p></div></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1944'>#</a></div><p ><i>Requires:</i>
If an implementation has strict pointer safety (<a href='basic.stc.dynamic.safety'>[basic.stc.dynamic.safety]</a>)
then <span class='texttt'>ptr</span> shall be a safely-derived pointer.</p></div></div><div class='para' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1949'>#</a></div><p ><i>Requires:</i>
If the <span class='texttt'>alignment</span> parameter is not present,
<span class='texttt'>ptr</span> shall have been returned by an allocation function
without an <span class='texttt'>alignment</span> parameter.
If present, the <span class='texttt'>alignment</span> argument
shall equal the <span class='texttt'>alignment</span> argument
passed to the allocation function that returned <span class='texttt'>ptr</span>.</p></div></div><div class='para' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/3acb49d296ba7efdc7542e943262138dc0eb9b74/source/support.tex#L1958'>#</a></div><p ><i>Default behavior:</i>
Calls <span class='texttt'>operator delete(ptr)</span>,
or <span class='texttt'>operator delete(ptr, alignment)</span>,
respectively.
</p></div></div></div></div></body></html>