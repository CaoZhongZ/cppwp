<!DOCTYPE html><html lang='en'><head><title>[re.grammar]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>28</a> Regular expressions library <a class='abbr_ref' href='./#re'>[re]</a></h1><div id='re.grammar'><h2 ><a class='secnum' style='min-width:88pt'>28.13</a> Modified ECMAScript regular expression grammar <a class='abbr_ref'>[re.grammar]</a></h2><p ><span class='indexparent'><a class='index' id='regular_expression,grammar'></a></span><span class='indexparent'><a class='index' id='grammar,regular_expression'></a></span>
</p><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4022'>#</a></div><p ><span class='indexparent'><a class='index' id='basic_regex'></a></span><span class='indexparent'><a class='index' id='ECMAScript'></a></span>The regular expression grammar recognized by
<span class='texttt'>basic_&shy;regex</span> objects constructed with the ECMAScript
flag is that specified by ECMA-262, except as specified below.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4029'>#</a></div><p ><span class='indexparent'><a class='index' id='locale'></a></span><span class='indexparent'><a class='index' id='regular_expression_traits'></a></span>Objects of type specialization of <span class='texttt'>basic_&shy;regex</span> store within themselves a
default-constructed instance of their <span class='texttt'>traits</span> template parameter, henceforth
referred to as <span class='texttt'>traits_&shy;inst</span>. This <span class='texttt'>traits_&shy;inst</span> object is used to support localization
of the regular expression; <span class='texttt'>basic_&shy;regex</span> member functions shall not call
any locale dependent C or C++ API, including the formatted string input functions.
Instead they shall call the appropriate traits member function to achieve the required effect.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4039'>#</a></div><p >The following productions within the ECMAScript grammar are modified as follows:</p><pre class='codeblock'>
ClassAtom ::
  -
  ClassAtomNoDash
  ClassAtomExClass
  ClassAtomCollatingElement
  ClassAtomEquivalence

IdentityEscape ::
  SourceCharacter but not c</pre></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4054'>#</a></div><p >The following new productions are then added:</p><pre class='codeblock'>
ClassAtomExClass ::
  [: ClassName :]

ClassAtomCollatingElement ::
  [. ClassName .]

ClassAtomEquivalence ::
  [= ClassName =]

ClassName ::
  ClassNameCharacter
  ClassNameCharacter ClassName

ClassNameCharacter ::
  SourceCharacter but not one of "." "=" ":"</pre></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4075'>#</a></div><p >The productions <span class='texttt'>ClassAtomExClass</span>, <span class='texttt'>ClassAtomCollatingElement</span>
and <span class='texttt'>ClassAtomEquivalence</span> provide functionality
equivalent to that of the same features in regular expressions in POSIX.</p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4080'>#</a></div><p >The regular expression grammar may be modified by
any <span class='texttt'>regex_&shy;constants&#x200b;::&#x200b;syntax_&shy;option_&shy;type</span> flags specified when
constructing an object of type specialization of <span class='texttt'>basic_&shy;regex</span>
according to the rules in Table <a href='re.synopt#tab:re:syntaxoption'>[tab:re:syntaxoption]</a>.</p></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4086'>#</a></div><p >A <span class='texttt'>ClassName</span> production, when used in <span class='texttt'>ClassAtomExClass</span>,
is not valid if <span class='texttt'>traits_&shy;inst.lookup_&shy;classname</span> returns zero for
that name.  The names recognized as valid <span class='texttt'>ClassName</span>s are
determined by the type of the traits class, but at least the following
names shall be recognized:
<span class='texttt'>alnum</span>, <span class='texttt'>alpha</span>, <span class='texttt'>blank</span>, <span class='texttt'>cntrl</span>, <span class='texttt'>digit</span>,
<span class='texttt'>graph</span>, <span class='texttt'>lower</span>, <span class='texttt'>print</span>, <span class='texttt'>punct</span>, <span class='texttt'>space</span>,
<span class='texttt'>upper</span>, <span class='texttt'>xdigit</span>, <span class='texttt'>d</span>, <span class='texttt'>s</span>, <span class='texttt'>w</span>.
In addition the following expressions shall be equivalent:</p><pre class='codeblock'>
\d and [[:digit:]]

\D and [^[:digit:]]

\s and [[:space:]]

\S and [^[:space:]]

\w and [_[:alnum:]]

\W and [^_[:alnum:]]</pre></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4111'>#</a></div><p ><span class='indexparent'><a class='index' id='regular_expression_traits,lookup_collatename'></a></span><span class='indexparent'><a class='index' id='lookup_collatename,regular_expression_traits'></a></span>A <span class='texttt'>ClassName</span> production when used in
a <span class='texttt'>ClassAtomCollatingElement</span> production is not valid
if the value returned by <span class='texttt'>traits_&shy;inst.lookup_&shy;collatename</span> for
that name is an empty string.</p></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4119'>#</a></div><p ><span class='indexparent'><a class='index' id='regular_expression_traits,isctype'></a></span><span class='indexparent'><a class='index' id='isctype,regular_expression_traits'></a></span><span class='indexparent'><a class='index' id='regular_expression_traits,lookup_classname'></a></span><span class='indexparent'><a class='index' id='lookup_classname,regular_expression_traits'></a></span>The results from multiple calls
to <span class='texttt'>traits_&shy;inst.lookup_&shy;classname</span> can be bitwise OR'ed
together and subsequently passed to <span class='texttt'>traits_&shy;inst.isctype</span>.</p></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4128'>#</a></div><p ><span class='indexparent'><a class='index' id='regular_expression_traits,transform_primary'></a></span><span class='indexparent'><a class='index' id='transform_primary,regular_expression_traits'></a></span>A <span class='texttt'>ClassName</span> production when used in
a <span class='texttt'>ClassAtomEquivalence</span> production is not valid if the value
returned by <span class='texttt'>traits_&shy;inst.lookup_&shy;collatename</span> for that name is an
empty string or if the value returned by <span class='texttt'>traits_&shy;inst&#x200b;.transform_&shy;primary</span>
for the result of the call to <span class='texttt'>traits_&shy;inst.lookup_&shy;collatename</span>
is an empty string.</p></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4138'>#</a></div><p ><span class='indexparent'><a class='index' id='regex_error'></a></span>When the sequence of characters being transformed to a finite state
machine contains an invalid class name the translator shall throw an
exception object of type <span class='texttt'>regex_&shy;error</span>.</p></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4144'>#</a></div><p ><span class='indexparent'><a class='index' id='regex_error'></a></span>If the <i>CV</i> of a <i>UnicodeEscapeSequence</i> is greater than the largest
value that can be held in an object of type <span class='texttt'>charT</span> the translator shall
throw an exception object of type <span class='texttt'>regex_&shy;error</span>. [<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
This means that values of the form <span class='texttt'>"uxxxx"</span> that do not fit in
a character are invalid.  <i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]</p></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4152'>#</a></div><p >Where the regular expression grammar requires the conversion of a sequence of characters
to an integral value, this is accomplished by calling <span class='texttt'>traits_&shy;inst.value</span>.</p></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/regex.tex#L4156'>#</a></div><p ><span class='indexparent'><a class='index' id='match_flag_type'></a></span>The behavior of the internal finite state machine representation when used to match a
sequence of characters is as described in ECMA-262.
The behavior is modified according
to any match_flag_type flags <a href='re.matchflag'>[re.matchflag]</a> specified when using the regular expression
object in one of the regular expression algorithms <a href='re.alg'>[re.alg]</a>. The behavior is also
localized by interaction with the traits class template parameter as follows:
</p><ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.1'>(14.1)</a></div><p >During matching of a regular expression finite state machine
against a sequence of characters, two characters <span class='texttt'>c</span>
and <span class='texttt'>d</span> are compared using the following rules:
</p><ul class='itemize'><li id='14.1.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#14.1.1'>(14.1.1)</a></div><p >if <span class='texttt'>(flags() &amp; regex_&shy;constants&#x200b;::&#x200b;icase)</span> the two characters are equal
if <span class='texttt'>traits_&shy;inst.translate_&shy;nocase(c) == traits_&shy;inst.translate_&shy;nocase(d)</span>;
<span class='indexparent'><a class='index' id='regular_expression_traits,translate_nocase'></a></span><span class='indexparent'><a class='index' id='translate_nocase,regular_expression_traits'></a></span></p></li><li id='14.1.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#14.1.2'>(14.1.2)</a></div><p >otherwise, if <span class='texttt'>flags() &amp; regex_&shy;constants&#x200b;::&#x200b;collate</span> the
two characters are equal if
<span class='texttt'>traits_&shy;inst&#x200b;.translate(c) == traits_&shy;inst&#x200b;.translate(d)</span>;
<span class='indexparent'><a class='index' id='syntax_option_type,collate'></a></span><span class='indexparent'><a class='index' id='regular_expression_traits,translate'></a></span><span class='indexparent'><a class='index' id='translate,regular_expression_traits'></a></span></p></li><li id='14.1.3'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#14.1.3'>(14.1.3)</a></div><p >otherwise, the two characters are equal if <span class='texttt'>c == d</span>.
</p></li></ul></li><li id='14.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.2'>(14.2)</a></div><p >During matching of a regular expression finite state machine
against a sequence of characters, comparison of a collating element
range <span class='texttt'>c1-c2</span> against a character <span class='texttt'>c</span> is
conducted as follows: if <span class='texttt'>flags() &amp; regex_&shy;constants&#x200b;::&#x200b;collate</span>
is false then the character <span class='texttt'>c</span> is matched if <span class='texttt'>c1
&lt;= c &amp;&amp; c &lt;= c2</span>, otherwise <span class='texttt'>c</span> is matched in
accordance with the following algorithm:</p><p ><span class='indexparent'><a class='index' id='regular_expression_traits,translate'></a></span><span class='indexparent'><a class='index' id='translate,regular_expression_traits'></a></span><span class='indexparent'><a class='index' id='regular_expression_traits,translate_nocase'></a></span><span class='indexparent'><a class='index' id='translate_nocase,regular_expression_traits'></a></span><span class='indexparent'><a class='index' id='regular_expression_traits,transform'></a></span><span class='indexparent'><a class='index' id='transform,regular_expression_traits'></a></span></p><pre class='codeblock'>
string_type str1 = string_type(1,
  flags() &amp; icase ?
    traits_inst.translate_nocase(c1) : traits_inst.translate(c1);
string_type str2 = string_type(1,
  flags() &amp; icase ?
    traits_inst.translate_nocase(c2) : traits_inst.translate(c2);
string_type str = string_type(1,
  flags() &amp; icase ?
    traits_inst.translate_nocase(c) : traits_inst.translate(c);
return traits_inst.transform(str1.begin(), str1.end())
      &lt;= traits_inst.transform(str.begin(), str.end())
  &amp;&amp; traits_inst.transform(str.begin(), str.end())
      &lt;= traits_inst.transform(str2.begin(), str2.end());</pre></li><li id='14.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.3'>(14.3)</a></div><p >During matching of a regular expression finite state machine against a sequence of
characters, testing whether a collating element is a member of a primary equivalence
class is conducted by first converting the collating element and the equivalence
class to sort keys using <span class='texttt'>traits&#x200b;::&#x200b;transform_&shy;primary</span>, and then comparing the sort
keys for equality.
<span class='indexparent'><a class='index' id='regular_expression_traits,transform_primary'></a></span><span class='indexparent'><a class='index' id='transform_primary,regular_expression_traits'></a></span>
</p></li><li id='14.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.4'>(14.4)</a></div><p >During matching of a regular expression finite state machine against a sequence
of characters, a character <span class='texttt'>c</span> is a member of a character class designated by an
iterator range <span class='texttt'>[first, last)</span> if
<span class='texttt'>traits_&shy;inst.isctype(c, traits_&shy;inst.lookup_&shy;classname(first, last, flags() &amp; icase))</span> is <span class='texttt'>true</span>.
<span class='indexparent'><a class='index' id='regular_expression_traits,lookup_classname'></a></span><span class='indexparent'><a class='index' id='lookup_classname,regular_expression_traits'></a></span></p></li></ul><p ><span class='indexparent'><a class='index' id='regular_expression'></a></span>
</p></div></div></div></body></html>