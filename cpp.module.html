<!DOCTYPE html><html lang='en'><head><title>[cpp.module]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>15</a> Preprocessing directives <a class='abbr_ref' href='./#cpp'>[cpp]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>15.4</a> Header units <a class='abbr_ref'>[cpp.module]</a></h2><span class='indexparent'><a class='index' id=':header_unit,preprocessing'></a></span><span class='indexparent'><a class='index' id=':macro_import'></a></span>
<pre class='bnf'><a class='nontermdef' href='#nt:import-seq' id='nt:import-seq'>import-seq:</a>
&#9;<i ><a href='#nt:top-level-token-seq'>top-level-token-seq</a></i><span class="mjx-chtml"><span class="mjx-math" aria-label="_\mathit{opt}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <span class='terminal'><span class='keyword'>export</span></span><span class="mjx-chtml"><span class="mjx-math" aria-label="_\mathit{opt}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <span class='terminal'><span class='keyword'>import</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:top-level-token-seq' id='nt:top-level-token-seq'>top-level-token-seq:</a>
&#9;<span class='descr'>any <span class='grammarterm'><i ><a href='#nt:pp-balanced-token-seq'>pp-balanced-token-seq</a></i></span> ending in <span class='terminal'>;</span> or <span class='terminal'>}</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-import' id='nt:pp-import'>pp-import:</a>
&#9;<span class='terminal'><span class='keyword'>import</span></span> <i ><a href='lex.header#nt:header-name'>header-name</a></i> <i ><a href='#nt:pp-import-suffix'>pp-import-suffix</a></i><span class="mjx-chtml"><span class="mjx-math" aria-label="_\mathit{opt}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <span class='terminal'>;</span>
&#9;<span class='terminal'><span class='keyword'>import</span></span> <i ><a href='cpp.cond#nt:header-name-tokens'>header-name-tokens</a></i> <i ><a href='#nt:pp-import-suffix'>pp-import-suffix</a></i><span class="mjx-chtml"><span class="mjx-math" aria-label="_\mathit{opt}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <span class='terminal'>;</span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-import-suffix' id='nt:pp-import-suffix'>pp-import-suffix:</a>
&#9;<i ><a href='#nt:pp-import-suffix-token'>pp-import-suffix-token</a></i>
&#9;<i ><a href='#nt:pp-import-suffix'>pp-import-suffix</a></i> <i ><a href='#nt:pp-import-suffix-token'>pp-import-suffix-token</a></i>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-import-suffix-token' id='nt:pp-import-suffix-token'>pp-import-suffix-token:</a>
&#9;<span class='descr'>any <span class='grammarterm'><i ><a href='#nt:pp-balanced-token'>pp-balanced-token</a></i></span> other than <span class='terminal'>;</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-balanced-token-seq' id='nt:pp-balanced-token-seq'>pp-balanced-token-seq:</a>
&#9;<i ><a href='#nt:pp-balanced-token'>pp-balanced-token</a></i>
&#9;<i ><a href='#nt:pp-balanced-token-seq'>pp-balanced-token-seq</a></i> <i ><a href='#nt:pp-balanced-token'>pp-balanced-token</a></i>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-balanced-token' id='nt:pp-balanced-token'>pp-balanced-token:</a>
&#9;<i ><a href='#nt:pp-ldelim'>pp-ldelim</a></i> <i ><a href='#nt:pp-balanced-token-seq'>pp-balanced-token-seq</a></i><span class="mjx-chtml"><span class="mjx-math" aria-label="_\mathit{opt}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <i ><a href='#nt:pp-rdelim'>pp-rdelim</a></i>
&#9;<span class='descr'>any <span class='grammarterm'><i ><a href='lex.pptoken#nt:preprocessing-token'>preprocessing-token</a></i></span> other than a <span class='grammarterm'><i ><a href='#nt:pp-ldelim'>pp-ldelim</a></i></span> or <span class='grammarterm'><i ><a href='#nt:pp-rdelim'>pp-rdelim</a></i></span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-ldelim' id='nt:pp-ldelim'>pp-ldelim:</a> <span class='descr'>one of</span>
&#9;<span class='terminal'><span class='parenthesis'>(</span>    <span class='squarebracket'>[</span>    <span class='curlybracket'>{</span>    <span class='anglebracket'>&lt;</span><span class='operator'>:</span>    <span class='anglebracket'>&lt;</span><span class='operator'>%</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:pp-rdelim' id='nt:pp-rdelim'>pp-rdelim:</a> <span class='descr'>one of</span>
&#9;<span class='terminal'><span class='parenthesis'>)</span>    <span class='squarebracket'>]</span>    <span class='curlybracket'>}</span>    <span class='operator'>:</span><span class='anglebracket'>&gt;</span>    <span class='operator'>%</span><span class='anglebracket'>&gt;</span></span>
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L734'>#</a></div><div id='1.sentence-1' class='sentence'>A sequence of <i ><a href='lex.pptoken#nt:preprocessing-token'>preprocessing-token</a></i><span class='textit'>s</span>
matching the form of a <i ><a href='#nt:pp-import'>pp-import</a></i>
instructs the preprocessor to import macros
from the header unit (<a href='module.import'>[module.import]</a>)
denoted by the <i ><a href='lex.header#nt:header-name'>header-name</a></i><a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>A <i ><a href='#nt:pp-import'>pp-import</a></i> is only recognized
when the sequence of tokens
produced by phase 4 of translation
up to the <span class='texttt'><span class='keyword'>import</span></span> token
forms an <i ><a href='#nt:import-seq'>import-seq</a></i>,
and the <span class='texttt'><span class='keyword'>import</span></span> token is not within
the <i ><a href='cpp.cond#nt:header-name-tokens'>header-name-tokens</a></i> or <i ><a href='#nt:pp-import-suffix'>pp-import-suffix</a></i>
of another <i ><a href='#nt:pp-import'>pp-import</a></i><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>The <span class='texttt'>;</span> <i ><a href='lex.pptoken#nt:preprocessing-token'>preprocessing-token</a></i>
terminating a <i ><a href='#nt:pp-import'>pp-import</a></i>
shall not have been produced by
macro replacement (<a href='cpp.replace'>[cpp.replace]</a>)<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>The <a class='hidden_link' href='#def:macro_import,point_of' id='def:macro_import,point_of'><i >point of macro import</i></a> for a <i ><a href='#nt:pp-import'>pp-import</a></i> is
immediately after the <span class='texttt'>;</span> terminating the <i ><a href='#nt:pp-import'>pp-import</a></i><a class='hidden_link' href='#1.sentence-4'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L755'>#</a></div><div id='2.sentence-1' class='sentence'>In the second form of <i ><a href='#nt:pp-import'>pp-import</a></i>,
a <i ><a href='lex.header#nt:header-name'>header-name</a></i> token is formed as if
the <i ><a href='cpp.cond#nt:header-name-tokens'>header-name-tokens</a></i>
were the <i ><a href='cpp#nt:pp-tokens'>pp-tokens</a></i> of a <span class='texttt'><span class='preprocessordirective'>#include</span></span> directive<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>The <i ><a href='cpp.cond#nt:header-name-tokens'>header-name-tokens</a></i> are replaced by
the <i ><a href='lex.header#nt:header-name'>header-name</a></i> token<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-3' class='sentence'>This ensures that imports are treated consistently by
the preprocessor and later phases of translation<a class='hidden_link' href='#2.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L767'>#</a></div><div id='3.sentence-1' class='sentence'>Each <span class='texttt'><span class='preprocessordirective'>#define</span></span> directive encountered when preprocessing
each translation unit in a program results in a distinct
<a class='hidden_link' href='#def:macro_definition' id='def:macro_definition'><i >macro definition</i></a><a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>Importing macros from a header unit makes macro definitions
from a translation unit visible in other translation units<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>Each macro definition has at most one point of definition in
each translation unit and at most one point of undefinition, as follows:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.1'>(3.1)</a></div><div id='3.1.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:macro_definition,point_of_definition' id='def:macro_definition,point_of_definition'><i >point of definition</i></a>
of a macro definition within a translation unit
is the point at which its <span class='texttt'><span class='preprocessordirective'>#define</span></span> directive occurs (in the translation
unit containing the <span class='texttt'><span class='preprocessordirective'>#define</span></span> directive), or,
if the macro name is not lexically identical to a keyword (<a href='lex.key'>[lex.key]</a>)
or to the <i ><a href='lex.name#nt:identifier'>identifier</a></i><span class='textit'>s</span> <span class='texttt'><span class='keyword'>module</span></span> or <span class='texttt'><span class='keyword'>import</span></span>,
the first point
of macro import of a translation unit containing a point of definition for the
macro definition, if any (in any other translation unit)<a class='hidden_link' href='#3.1.sentence-1'>.</a></div></li><li id='3.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.2'>(3.2)</a></div><div id='3.2.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:macro_definition,point_of_undefinition' id='def:macro_definition,point_of_undefinition'><i >point of undefinition</i></a>
of a macro definition within a translation unit
is the first point at which a <span class='texttt'><span class='preprocessordirective'>#undef</span></span> directive naming the macro occurs
after its point of definition, or the first point
of macro import of a translation unit containing a point of undefinition for the
macro definition, whichever (if any) occurs first<a class='hidden_link' href='#3.2.sentence-1'>.</a></div></li></ul></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L796'>#</a></div><div id='4.sentence-1' class='sentence'>A macro directive is <a class='hidden_link' href='#def:macro_definition,active' id='def:macro_definition,active'><i >active</i></a> at a source location
if it has a point of definition in that translation unit preceding the location,
and does not have a point of undefinition in that translation unit preceding
the location<a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L802'>#</a></div><div id='5.sentence-1' class='sentence'>If a macro would be replaced or redefined, and multiple macro definitions
are active for that macro name, the active macro definitions shall all be
valid redefinitions of the same macro (<a href='cpp.replace'>[cpp.replace]</a>)<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#5.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='5.sentence-2' class='sentence'>The relative order of <i ><a href='#nt:pp-import'>pp-import</a></i><span class='textit'>s</span> has no bearing on whether a
particular macro definition is active<a class='hidden_link' href='#5.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/aa9fe1fc99da36602e2600ac16636fa7b504b4e5/source/preprocessor.tex#L811'>#</a></div><div id='6.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <p>Importable header <span class='texttt'><span class='literal'>"a.h"</span></span>:<pre class='codeblock'>
<span class='preprocessordirective'>#define</span> X <span class='literal'>123</span>   <span class='comment'>// #1</span>
<span class='preprocessordirective'>#define</span> Y <span class='literal'>45</span>    <span class='comment'>// #2</span>
<span class='preprocessordirective'>#define</span> Z a     <span class='comment'>// #3</span>
<span class='preprocessordirective'>#undef</span> X        <span class='comment'>// point of undefinition of #1 in <span class='tcode_in_codeblock'>"a.h"</span></span>
</pre><p>Importable header <span class='texttt'><span class='literal'>"b.h"</span></span>:<pre class='codeblock'>
<span class='keyword'>import</span> <span class='literal'>"a.h"</span>;   <span class='comment'>// point of definition of #1, #2, and #3, point of undefinition of #1 in <span class='tcode_in_codeblock'>"b.h"</span></span>
<span class='preprocessordirective'>#define</span> X <span class='literal'>456</span>   <span class='comment'>// OK, #1 is not active</span>
<span class='preprocessordirective'>#define</span> Y <span class='literal'>6</span>     <span class='comment'>// error: #2 is active</span>
</pre><p>Importable header <span class='texttt'><span class='literal'>"c.h"</span></span>:<pre class='codeblock'>
<span class='preprocessordirective'>#define</span> Y <span class='literal'>45</span>    <span class='comment'>// #4</span>
<span class='preprocessordirective'>#define</span> Z c     <span class='comment'>// #5</span>
</pre><p>Importable header <span class='texttt'><span class='literal'>"d.h"</span></span>:<pre class='codeblock'>
<span class='keyword'>import</span> <span class='literal'>"a.h"</span>;   <span class='comment'>// point of definition of #1, #2, and #3, point of undefinition of #1 in <span class='tcode_in_codeblock'>"d.h"</span></span>
<span class='keyword'>import</span> <span class='literal'>"c.h"</span>;   <span class='comment'>// point of definition of #4 and #5 in <span class='tcode_in_codeblock'>"d.h"</span></span>
<span class='keyword'>int</span> a <span class='operator'>=</span> Y;      <span class='comment'>// OK, active macro definitions #2 and #3 are valid redefinitions</span>
<span class='keyword'>int</span> c <span class='operator'>=</span> Z;      <span class='comment'>// error: active macro definitions #2 and #3 are not valid redefinitions of <span class='tcode_in_codeblock'>Z</span></span>
</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></body></html>