<!DOCTYPE html><html lang='en'><head><title>[diff.cpp11]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:73pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>C.3</a> C++ and ISO C++ 2011 <a class='abbr_ref'>[diff.cpp11]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/04eb7aa1d517df2712d1298ed7551ebb77523483/source/compatibility.tex#L1334'>#</a></div><div id='1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':summary,compatibility_with_ISO_C++_2011'></a></span>This subclause lists the differences between C++ and
ISO C++ 2011 (ISO/IEC 14882:2011, <span class='textit'>Programming Languages — C++</span>),
by the chapters of this document<a class='hidden_link' href='#1.sentence-1'>.</a></div></div><div id='lex' class='section'><h3 ><a class='secnum' href='#lex' style='min-width:103pt'>C.3.1</a> <a href='lex'>[lex]</a>: lexical conventions <a class='abbr_ref' href='diff.cpp11.lex'>[diff.cpp11.lex]</a></h3><div class='para' id='lex-1'><div class='marginalizedparent'><a class='marginalized' href='#lex-1'>1</a></div><div id='lex-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='lex.ppnumber'>[lex.ppnumber]</a>
<br/><b>Change:</b> <i ><a href='lex.ppnumber#nt:pp-number'>pp-number</a></i> can contain one or more single quotes<a class='hidden_link' href='#lex-1.sentence-1'>.</a></div> <div id='lex-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Necessary to enable single quotes as digit separators<a class='hidden_link' href='#lex-1.sentence-2'>.</a></div> <div id='lex-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> Valid C++ 2011 code may fail to compile or may change meaning in this
International Standard<a class='hidden_link' href='#lex-1.sentence-3'>.</a></div> <div id='lex-1.sentence-4' class='sentence'>For example, the following code is valid both in C++ 2011 and in
this International Standard, but the macro invocation produces different outcomes
because the single quotes delimit a character literal in C++ 2011, whereas they are digit
separators in this International Standard:</div><pre class='codeblock'>
#define M(x, ...) __VA_ARGS__
int x[2] = { M(1'2,3'4, 5) };
<span class='comment'>// <span class='tcode_in_codeblock'>int x[2] = { 5 };&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> — C++ 2011
</span><span class='comment'>// <span class='tcode_in_codeblock'>int x[2] = { 3'4, 5 };</span> — this International Standard
</span></pre></div></div><div id='basic' class='section'><h3 ><a class='secnum' href='#basic' style='min-width:103pt'>C.3.2</a> <a href='basic'>[basic]</a>: basic concepts <a class='abbr_ref' href='diff.cpp11.basic'>[diff.cpp11.basic]</a></h3><div class='para' id='basic-1'><div class='marginalizedparent'><a class='marginalized' href='#basic-1'>1</a></div><div id='basic-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>
<br/><b>Change:</b> New usual (non-placement) deallocator<a class='hidden_link' href='#basic-1.sentence-1'>.</a></div> <div id='basic-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Required for sized deallocation<a class='hidden_link' href='#basic-1.sentence-2'>.</a></div> <div id='basic-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> Valid C++ 2011 code could declare a global placement allocation function and
deallocation function as follows:</div><pre class='codeblock'>
void* operator new(std::size_t, std::size_t);
void operator delete(void*, std::size_t) noexcept;</pre><div id='basic-1.sentence-4' class='sentence'>In this International Standard, however, the declaration of <span class='texttt'>operator delete</span>
might match a predefined usual (non-placement)
<span class='texttt'>operator delete</span> (<a href='basic.stc.dynamic'>[basic.stc.dynamic]</a>)<a class='hidden_link' href='#basic-1.sentence-4'>.</a></div> <div id='basic-1.sentence-5' class='sentence'>If so, the
program is ill-formed, as it was for class member allocation functions and
deallocation functions (<a href='expr.new'>[expr.new]</a>)<a class='hidden_link' href='#basic-1.sentence-5'>.</a></div></div></div><div id='expr' class='section'><h3 ><a class='secnum' href='#expr' style='min-width:103pt'>C.3.3</a> <a href='expr'>[expr]</a>: expressions <a class='abbr_ref' href='diff.cpp11.expr'>[diff.cpp11.expr]</a></h3><div class='para' id='expr-1'><div class='marginalizedparent'><a class='marginalized' href='#expr-1'>1</a></div><div id='expr-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='expr.cond'>[expr.cond]</a>
<br/><b>Change:</b> A conditional expression with a throw expression as its second or third
operand keeps the type and value category of the other operand<a class='hidden_link' href='#expr-1.sentence-1'>.</a></div> <div id='expr-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Formerly mandated conversions (<a href='conv.lval'>lvalue-to-rvalue</a>,
<a href='conv.array'>array-to-pointer</a>, and <a href='conv.func'>function-to-pointer</a>
standard conversions), especially the creation of the temporary due to
lvalue-to-rvalue conversion, were considered gratuitous and surprising<a class='hidden_link' href='#expr-1.sentence-2'>.</a></div> <div id='expr-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> Valid C++ 2011 code that relies on the conversions may behave differently
in this International Standard:</div><pre class='codeblock'>
struct S {
  int x = 1;
  void mf() { x = 2; }
};
int f(bool cond) {
  S s;
  (cond ? s : throw 0).mf();
  return s.x;
}</pre><div id='expr-1.sentence-4' class='sentence'>In C++ 2011, <span class='texttt'>f(true)</span> returns <span class='texttt'>1</span><a class='hidden_link' href='#expr-1.sentence-4'>.</a></div> <div id='expr-1.sentence-5' class='sentence'>In this International Standard,
it returns <span class='texttt'>2</span><a class='hidden_link' href='#expr-1.sentence-5'>.</a></div><pre class='codeblock'>
sizeof(true ? "" : throw 0)</pre><div id='expr-1.sentence-6' class='sentence'>In C++ 2011, the expression yields <span class='texttt'>sizeof(const char*)</span><a class='hidden_link' href='#expr-1.sentence-6'>.</a></div> <div id='expr-1.sentence-7' class='sentence'>In this
International Standard, it yields <span class='texttt'>sizeof(const char[1])</span><a class='hidden_link' href='#expr-1.sentence-7'>.</a></div></div></div><div id='dcl.dcl' class='section'><h3 ><a class='secnum' href='#dcl.dcl' style='min-width:103pt'>C.3.4</a> <a href='dcl.dcl'>[dcl.dcl]</a>: declarations <a class='abbr_ref' href='diff.cpp11.dcl.dcl'>[diff.cpp11.dcl.dcl]</a></h3><div class='para' id='dcl.dcl-1'><div class='marginalizedparent'><a class='marginalized' href='#dcl.dcl-1'>1</a></div><div id='dcl.dcl-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='dcl.constexpr'>[dcl.constexpr]</a>
<br/><b>Change:</b> <span class='texttt'>constexpr</span> non-static member functions are not implicitly
<span class='texttt'>const</span> member functions<a class='hidden_link' href='#dcl.dcl-1.sentence-1'>.</a></div> <div id='dcl.dcl-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Necessary to allow <span class='texttt'>constexpr</span> member functions to mutate
the object<a class='hidden_link' href='#dcl.dcl-1.sentence-2'>.</a></div> <div id='dcl.dcl-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> 
Valid C++ 2011 code may fail to compile in this International Standard<a class='hidden_link' href='#dcl.dcl-1.sentence-3'>.</a></div> <div id='dcl.dcl-1.sentence-4' class='sentence'>For example, the following code is valid in C++ 2011
but invalid in this International Standard because it declares the same member
function twice with different return types:</div><pre class='codeblock'>
struct S {
  constexpr const int &amp;f();
  int &amp;f();
};</pre></div></div><div id='dcl.decl' class='section'><h3 ><a class='secnum' href='#dcl.decl' style='min-width:103pt'>C.3.5</a> <a href='dcl.decl'>[dcl.decl]</a>: declarators <a class='abbr_ref' href='diff.cpp11.dcl.decl'>[diff.cpp11.dcl.decl]</a></h3><div class='para' id='dcl.decl-1'><div class='marginalizedparent'><a class='marginalized' href='#dcl.decl-1'>1</a></div><div id='dcl.decl-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='dcl.init.aggr'>[dcl.init.aggr]</a>
<br/><b>Change:</b> Classes with default member initializers can be aggregates<a class='hidden_link' href='#dcl.decl-1.sentence-1'>.</a></div> <div id='dcl.decl-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Necessary to allow default member initializers to be used
by aggregate initialization<a class='hidden_link' href='#dcl.decl-1.sentence-2'>.</a></div> <div id='dcl.decl-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> 
Valid C++ 2011 code may fail to compile or may change meaning in this International Standard<a class='hidden_link' href='#dcl.decl-1.sentence-3'>.</a></div> <div id='dcl.decl-1.sentence-4' class='sentence'>For example:
<pre class='codeblock'>
struct S { <span class='comment'>// Aggregate in C++ 2014 onwards.
</span>  int m = 1;
};
struct X {
  operator int();
  operator S();
};
X a{};
S b{a};  <span class='comment'>// uses copy constructor in C++ 2011,
</span>         <span class='comment'>// performs aggregate initialization in this International Standard
</span></pre></div></div></div><div id='library' class='section'><h3 ><a class='secnum' href='#library' style='min-width:103pt'>C.3.6</a> <a href='library'>[library]</a>: library introduction <a class='abbr_ref' href='diff.cpp11.library'>[diff.cpp11.library]</a></h3><div class='para' id='library-1'><div class='marginalizedparent'><a class='marginalized' href='#library-1'>1</a></div><div id='library-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='headers'>[headers]</a>
<br/><b>Change:</b> New header<a class='hidden_link' href='#library-1.sentence-1'>.</a></div> <div id='library-1.sentence-2' class='sentence'><br/><b>Rationale:</b> New functionality<a class='hidden_link' href='#library-1.sentence-2'>.</a></div> <div id='library-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> 
The C++ header <span class='texttt'>&lt;shared_&shy;mutex&gt;</span> is new<a class='hidden_link' href='#library-1.sentence-3'>.</a></div> <div id='library-1.sentence-4' class='sentence'>Valid C++ 2011 code that <span class='texttt'>#include</span>s a header with that name may be
invalid in this International Standard<a class='hidden_link' href='#library-1.sentence-4'>.</a></div></div></div><div id='input.output' class='section'><h3 ><a class='secnum' href='#input.output' style='min-width:103pt'>C.3.7</a> <a href='input.output'>[input.output]</a>: input/output library <a class='abbr_ref' href='diff.cpp11.input.output'>[diff.cpp11.input.output]</a></h3><div class='para' id='input.output-1'><div class='marginalizedparent'><a class='marginalized' href='#input.output-1'>1</a></div><div id='input.output-1.sentence-1' class='sentence'><b>Affected subclause:</b> <a href='c.files'>[c.files]</a>
<br/><b>Change:</b> <span class='texttt'>gets</span> is not defined<a class='hidden_link' href='#input.output-1.sentence-1'>.</a></div> <div id='input.output-1.sentence-2' class='sentence'><br/><b>Rationale:</b> Use of <span class='texttt'>gets</span> is considered dangerous<a class='hidden_link' href='#input.output-1.sentence-2'>.</a></div> <div id='input.output-1.sentence-3' class='sentence'><br/><b>Effect on original feature:</b> 
Valid C++ 2011 code that uses the <span class='texttt'>gets</span> function may fail to compile
in this International Standard<a class='hidden_link' href='#input.output-1.sentence-3'>.</a></div></div></div></div></body></html>