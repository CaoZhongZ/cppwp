<!DOCTYPE html><html lang='en'><head><title>[buffer.async.read.until]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>17</a> Buffer-oriented streams <a class='abbr_ref' href='./#buffer.stream'>[buffer.stream]</a></h1><div id='buffer.async.read.until'><h2 ><a class='secnum' style='min-width:88pt'>17.10</a> Asynchronous delimited read operations <a class='abbr_ref'>[buffer.async.read.until]</a></h2><p ><span class='indexparent'><a class='index' id='async_read_until'></a></span><code class='itemdecl'>
template&lt;class AsyncReadStream, class DynamicBuffer, class CompletionToken&gt;
  <span class='DEDUCED'></span> async_read_until(AsyncReadStream&amp; s,
                           DynamicBuffer&amp;&amp; b, char delim,
                           CompletionToken&amp;&amp; token);
template&lt;class AsyncReadStream, class DynamicBuffer, class CompletionToken&gt;
  <span class='DEDUCED'></span> async_read_until(AsyncReadStream&amp; s,
                           DynamicBuffer&amp;&amp; b, string_view delim,
                           CompletionToken&amp;&amp; token);
</code></p><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><p >A composed asynchronous operation (<a href='async.reqmts.async.composed'>[async.reqmts.async.composed]</a>).</p></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><p ><span class='completionsig'></span> <span class='texttt'>void(error_code ec, size_t n)</span>.</p></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><p ><i>Effects:</i> Initiates an asynchronous operation to read data from the buffer-oriented asynchronous read stream (<a href='buffer.stream.reqmts.asyncreadstream'>[buffer.stream.reqmts.asyncreadstream]</a>) object <span class='texttt'>stream</span> by performing zero or more asynchronous read_some operations on the stream, until the readable bytes of the dynamic buffer (<a href='buffer.reqmts.dynamicbuffer'>[buffer.reqmts.dynamicbuffer]</a>) object <span class='texttt'>b</span> contain the specified delimiter <span class='texttt'>delim</span>.</p></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><p >Data is placed into the dynamic buffer object <span class='texttt'>b</span>. A mutable buffer sequence (<a href='buffer.reqmts.mutablebuffersequence'>[buffer.reqmts.mutablebuffersequence]</a>) is obtained prior to each <span class='texttt'>async_read_some</span> call using <span class='texttt'>b.prepare(N)</span>, where <span class='texttt'>N</span> is an unspecified value such that <span class='texttt'>N &lt;= max_size() - size()</span>. [&nbsp;<i>Note:</i> Implementations can use <span class='texttt'>b.capacity()</span> when determining <span class='texttt'>N</span>, to minimize the number of asynchronous read_some operations performed on the stream. <i>&nbsp;—&nbsp;end note</i>&nbsp;] After the completion of each asynchronous read_some operation, the implementation performs <span class='texttt'>b.commit(n)</span>, where <span class='texttt'>n</span> is the value passed to the asynchronous read_some operation's completion handler.</p></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><p >The asynchronous read_until operation continues until:</p><ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.1'>(5.1)</a></div><p >the readable bytes of <span class='texttt'>b</span> contain the delimiter <span class='texttt'>delim</span>; or
</p></li><li id='5.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.2'>(5.2)</a></div><p ><span class='texttt'>b.size() == b.max_size()</span>; or
</p></li><li id='5.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.3'>(5.3)</a></div><p >an asynchronous read_some operation fails.
</p></li></ul></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><p >The program shall ensure the <span class='texttt'>AsyncReadStream</span> object <span class='texttt'>stream</span> is valid until the completion handler for the asynchronous operation is invoked.</p></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><p >If <span class='texttt'>delim</span> is of type <span class='texttt'>string_view</span>, the implementation copies the underlying sequence of characters prior to initiating an asynchronous read_some operation on the stream. [&nbsp;<i>Note:</i> This means that the caller is not required to guarantee the validity of the delimiter string after the call to <span class='texttt'>async_read_until</span> returns. <i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><p >On completion of the asynchronous operation, if the readable bytes of <span class='texttt'>b</span> contain the delimiter, <span class='texttt'>ec</span> is set such that <span class='texttt'>!ec</span> is <span class='texttt'>true</span>. Otherwise, if <span class='texttt'>b.size() == b.max_size()</span>, <span class='texttt'>ec</span> is set such that <span class='texttt'>ec == stream_errc::not_found</span>. If <span class='texttt'>b.size() &lt; b.max_size()</span>, <span class='texttt'>ec</span> is the <span class='texttt'>error_code</span> from the most recent asynchronous read_some operation. <span class='texttt'>n</span> is the number of readable bytes in <span class='texttt'>b</span> up to and including the delimiter, if present, otherwise <span class='texttt'>0</span>.
</p></div></div></div></div></body></html>