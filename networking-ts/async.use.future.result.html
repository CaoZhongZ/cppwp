<!DOCTYPE html><html lang='en'><head><title>[async.use.future.result]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>13</a> Asynchronous model <a class='abbr_ref' href='./#async'>[async]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>13.26</a> Class template <span class='texttt'>use_future_t</span> <a class='abbr_ref' href='async.use.future#result'>[async.use.future]</a></h2><div id='async.use.future.result'><h3 ><a class='secnum' style='min-width:103pt'>13.26.3</a> Partial class template specialization <span class='texttt'>async_result</span>
        for <span class='texttt'>use_future_t</span> <a class='abbr_ref'>[async.use.future.result]</a></h3><p ><span class='indexparent'><a class='index' id='async_result'></a></span><span class='indexparent'><a class='index' id='async_result,specialization_for_use_future_t'></a></span></p><pre class='codeblock'>
template&lt;class ProtoAllocator, class Result, class... Args&gt;
class async_result&lt;use_future_t&lt;ProtoAllocator&gt;, Result(Args...)&gt;{
  using completion_handler_type = <i><span class='texttt'>see below</span></i>;
  using return_type =  <i><span class='texttt'>see below</span></i>;

  explicit async_result(completion_handler_type&amp; h);
  async_result(const async_result&amp;) = delete;
  async_result&amp; operator=(const async_result&amp;) = delete;

  return_type get();
};
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >Let <span class='texttt'>R</span> be the type <span class='texttt'>async_result&lt;use_future_t&lt;ProtoAllocator&gt;, Result(Args...)&gt;</span>. Let <span class='texttt'>F</span> be the nested function object type <span class='texttt'>R::completion_handler_type</span>.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >An object <span class='texttt'>t1</span> of type <span class='texttt'>F</span> is an asynchronous provider with an associated shared state (C++Std &sect;<a href='../n4140/futures.state'>[futures.state]</a>). The type <span class='texttt'>F</span> provides <span class='texttt'>F::operator()</span> such that the expression <span class='texttt'>t1(declval&lt;Args&gt;()...)</span> is well formed.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><p >The implementation specializes <span class='texttt'>associated_executor</span> for <span class='texttt'>F</span>. For function objects executed using the associated executor's <span class='texttt'>dispatch()</span>, <span class='texttt'>post()</span> or <span class='texttt'>defer()</span> functions, any exception thrown is caught by the executor and stored in the associated shared state.</p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><p >For any executor type <span class='texttt'>E</span>, the associated object for the associator <span class='texttt'>associated_executor&lt;F, E&gt;</span> is an executor where, for function objects executed using the executor's <span class='texttt'>dispatch()</span>, <span class='texttt'>post()</span> or <span class='texttt'>defer()</span> functions, any exception thrown by a function object is caught by the executor and stored in the associated shared state.</p></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><p >When an object <span class='texttt'>r1</span> of type <span class='texttt'>R</span> is constructed from <span class='texttt'>t1</span>, the expression <span class='texttt'>r1.get()</span> returns a future with the same shared state as <span class='texttt'>t1</span>.</p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><p >The type of <span class='texttt'>R::return_type</span> and the effects of <span class='texttt'>F::operator()</span> are defined in Table <a href='#tab:async.use.future.result.requirements'>[tab:async.use.future.result.requirements]</a>. After establishing these effects, <span class='texttt'>F::operator()</span> makes the shared state ready. In this table, <i>N</i> is the value of <span class='texttt'>sizeof...(Args)</span>; let <i>i</i> be in the range <span class='texttt'>[0, <i>N</i>)</span> and let <span class='texttt'>T</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span> be the <span class='math'><span class='mathalpha'>i</span><sup ><span class='text'>th</span></sup></span> type in <span class='texttt'>Args</span>; let <span class='texttt'>U</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span> be <span class='texttt'>decay_t&lt;T</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span><span class='texttt'>&gt;</span> for each type <span class='texttt'>T</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span> in <span class='texttt'>Args</span>; let <span class='texttt'>A</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span> be the deduced type of the <span class='math'><span class='mathalpha'>i</span><sup ><span class='text'>th</span></sup></span> argument to <span class='texttt'>F::operator()</span>; and let <span class='texttt'>a</span><span class='math'><sub ><span class='mathalpha'>i</span></sub></span> be the <span class='math'><span class='mathalpha'>i</span><sup ><span class='text'>th</span></sup></span> argument to <span class='texttt'>F::operator()</span>.</p><div class='numberedTable' id='tab:async.use.future.result.requirements'>Table <a href='#tab:async.use.future.result.requirements'>10</a> â€” <span class='texttt'>async_result&lt;use_future_t&lt;ProtoAllocator&gt;, Result(Args...)&gt;</span> semantics<br><table ><tr class='rowsep'><td colspan='1' class='center'><b>N</b></td><td colspan='1' class='center'><b>U<span class='math'><sub >0</sub></span></b></td><td colspan='1' class='center'><b><span class='texttt'>R::return_type</span></b></td><td colspan='1' class='center'><b><span class='texttt'>F::operator()</span> effects</b></td></tr><tr class='capsep'><td class='center'> 
 0  </td><td class='left'>
  </td><td class='left'>
<span class='texttt'>future&lt;void&gt;</span>  </td><td class='justify'>
 None.  </td></tr><tr class='rowsep'><td class='center'>  1  </td><td class='left'>
<span class='texttt'>error_code</span>  </td><td class='left'>
<span class='texttt'>future&lt;void&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> evaluates to <span class='texttt'>true</span>, atomically stores the exception pointer produced by <span class='texttt'>make_exception_ptr(system_error(a<span class='math'><sub >0</sub></span>))</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  1  </td><td class='left'>
<span class='texttt'>exception_ptr</span>  </td><td class='left'>
<span class='texttt'>future&lt;void&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> is non-null, atomically stores the exception pointer a<span class='math'><sub >0</sub></span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  1  </td><td class='left'>
 all other types  </td><td class='left'>
<span class='texttt'>future&lt;U<span class='math'><sub >0</sub></span>&gt;</span>  </td><td class='justify'>
Atomically stores <span class='texttt'>forward&lt;A<span class='math'><sub >0</sub></span>&gt;(a<span class='math'><sub >0</sub></span>)</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  2  </td><td class='left'>
<span class='texttt'>error_code</span>  </td><td class='left'>
<span class='texttt'>future&lt;U<span class='math'><sub >1</sub></span>&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> evaluates to <span class='texttt'>true</span>, atomically stores the exception pointer produced by <span class='texttt'>make_exception_ptr(system_error(a<span class='math'><sub >0</sub></span>))</span> in the shared state; otherwise, atomically stores <span class='texttt'>forward&lt;A<span class='math'><sub >1</sub></span>&gt;(a<span class='math'><sub >1</sub></span>)</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  2  </td><td class='left'>
<span class='texttt'>exception_ptr</span>  </td><td class='left'>
<span class='texttt'>future&lt;U<span class='math'><sub >1</sub></span>&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> is non-null, atomically stores the exception pointer in the shared state; otherwise, atomically stores <span class='texttt'>forward&lt;A<span class='math'><sub >1</sub></span>&gt;(a<span class='math'><sub >1</sub></span>)</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  2  </td><td class='left'>
 all other types  </td><td class='left'>
<span class='texttt'>future&lt;tuple&lt;U<span class='math'><sub >0</sub></span>, U<span class='math'><sub >1</sub></span>&gt;&gt;</span>  </td><td class='justify'>
Atomically stores <span class='texttt'>forward_as_tuple(<br/>forward&lt;A<span class='math'><sub >0</sub></span>&gt;(a<span class='math'><sub >0</sub></span>), forward&lt;A<span class='math'><sub >1</sub></span>&gt;(a<span class='math'><sub >1</sub></span>))</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  &gt;2  </td><td class='left'>
<span class='texttt'>error_code</span>  </td><td class='left'>
<span class='texttt'>future&lt;tuple&lt;U<span class='math'><sub >1</sub></span>, <span class='math'>&hellip;</span>, U<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> evaluates to <span class='texttt'>true</span>, atomically stores the exception pointer produced by <span class='texttt'>make_exception_ptr(system_error(a<span class='math'><sub >0</sub></span>))</span> in the shared state; otherwise, atomically stores <span class='texttt'>forward_as_tuple(forward&lt;A<span class='math'><sub >1</sub></span>&gt;(a<span class='math'><sub >1</sub></span>), <span class='math'>&hellip;</span>, forward&lt;A<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;(a<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>))</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  &gt;2  </td><td class='left'>
<span class='texttt'>exception_ptr</span>  </td><td class='left'>
<span class='texttt'>future&lt;tuple&lt;U<span class='math'><sub >1</sub></span>, <span class='math'>&hellip;</span>, U<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;&gt;</span>  </td><td class='justify'>
If <span class='texttt'>a<span class='math'><sub >0</sub></span></span> is non-null, atomically stores the exception pointer in the shared state; otherwise, atomically stores <span class='texttt'>forward_as_tuple(forward&lt;A<span class='math'><sub >1</sub></span>&gt;(a<span class='math'><sub >1</sub></span>), <span class='math'>&hellip;</span>, forward&lt;A<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;(a<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>))</span> in the shared state.  </td></tr><tr class='rowsep'><td class='center'>  &gt;2  </td><td class='left'>
 all other types  </td><td class='left'>
<span class='texttt'>future&lt;tuple&lt;U<span class='math'><sub >0</sub></span>, <span class='math'>&hellip;</span>, U<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;&gt;</span>  </td><td class='justify'>
Atomically stores <span class='texttt'>forward_as_tuple(<br/>forward&lt;A<span class='math'><sub >0</sub></span>&gt;(a<span class='math'><sub >0</sub></span>), <span class='math'>&hellip;</span>, forward&lt;A<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>&gt;(a<span class='math'><sub ><span class='mathalpha'>N</span>-1</sub></span>))</span> in the shared state.  </td></tr></table></div></div></div></div></body></html>