<!DOCTYPE html><html lang='en'><head><title>[lex.phases]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>2</a> Lexical conventions <a class='abbr_ref' href='./#lex'>[lex]</a></h1><div id='lex.phases'><h2 ><a class='secnum' style='min-width:88pt'>2.2</a> Phases of translation <a class='abbr_ref'>[lex.phases]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/25fb80b3521531d71bb45c677ed9eace5b39f7ae/source/lex.tex#L54'>#</a></div><p ><span class='indexparent'><a class='index' id='translation,phases'></a></span>The precedence among the syntax rules of translation is specified by the
following phases.<a class='footnotenum' href='#footnote-12'>12</a></p><ol class='enumerate'><li id='1.1'><p><a class='enumerated_item_num' href='#1.1'>1.</a><span class='indexparent'><a class='index' id='character,source_file'></a></span><span class='indexparent'><a class='index' id='character_set,basic_source'></a></span>Physical source file characters are mapped, in an
<span class='indexparent'><a class='index' id='mapping_physical_source_file_characters_to_basic_source_character_set'></a></span>implementation-defined manner,
to the basic source character set (introducing new-line characters for end-of-line
indicators) if necessary.
The set of physical source file characters accepted is <span class='indexparent'><a class='index' id='physical_source_file_characters'></a></span>implementation-defined.
Any
source file character not in the basic source character
set (<a href='lex.charset'>[lex.charset]</a>) is replaced by the
<span class='indexparent'><a class='index' id='universal_character_name'></a></span><i ><a href='lex.charset#nt:universal-character-name'>universal-character-name</a></i> that
designates that character. An implementation may use any internal
encoding, so long as an actual extended character encountered in the
source file, and the same extended character expressed in the source
file as a <i ><a href='lex.charset#nt:universal-character-name'>universal-character-name</a></i> (e.g., using the <span class='texttt'>\uXXXX</span> notation), are handled equivalently
except where this replacement is reverted (<a href='lex.pptoken'>[lex.pptoken]</a>) in a raw string literal.</p><p ><span class='indexparent'><a class='index' id='line_splicing'></a></span></p></li><li id='1.2'><p><a class='enumerated_item_num' href='#1.2'>2.</a>Each instance of a backslash character (\)
immediately followed by a new-line character is deleted, splicing
physical source lines to form logical source lines. Only the last
backslash on any physical source line shall be eligible for being part
of such a splice.
Except for splices reverted in a raw string literal, if a splice results in
a character sequence that matches the
syntax of a <i ><a href='lex.charset#nt:universal-character-name'>universal-character-name</a></i>, the behavior is
undefined. A source file that is not empty and that does not end in a new-line
character, or that ends in a new-line character immediately preceded by a
backslash character before any such splicing takes place,
shall be processed as if an additional new-line character were appended
to the file.</p></li><li id='1.3'><p><a class='enumerated_item_num' href='#1.3'>3.</a>The source file is decomposed into preprocessing
tokens (<a href='lex.pptoken'>[lex.pptoken]</a>) and sequences of white-space characters
(including comments). A source file shall not end in a partial
preprocessing token or in a partial comment.<a class='footnotenum' href='#footnote-13'>13</a>
Each comment is replaced by one space character. New-line characters are
retained. Whether each nonempty sequence of white-space characters other
than new-line is retained or replaced by one space character is
unspecified. The process of dividing a source file's
characters into preprocessing tokens is context-dependent.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span>
see the handling of <span class='texttt'>&lt;</span> within a <span class='texttt'>#include</span> preprocessing
directive.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>]</p></li><li id='1.4'><p><a class='enumerated_item_num' href='#1.4'>4.</a>Preprocessing directives are executed, macro invocations are
expanded, and <span class='texttt'>_&shy;Pragma</span> unary operator expressions are executed.
If a character sequence that matches the syntax of a
<i ><a href='lex.charset#nt:universal-character-name'>universal-character-name</a></i> is produced by token
concatenation (<a href='cpp.concat'>[cpp.concat]</a>), the behavior is undefined. A
<span class='texttt'>#include</span> preprocessing directive causes the named header or
source file to be processed from phase 1 through phase 4, recursively.
All preprocessing directives are then deleted.</p></li><li id='1.5'><p><a class='enumerated_item_num' href='#1.5'>5.</a>Each source character set member in a character literal or a string
literal, as well as each escape sequence and <i ><a href='lex.charset#nt:universal-character-name'>universal-character-name</a></i> in a
character literal or a non-raw string literal, is converted to the corresponding
member of the execution character set (<a href='lex.ccon'>[lex.ccon]</a>, <a href='lex.string'>[lex.string]</a>); if
there is no corresponding member, it is converted to an <span class='indexparent'><a class='index' id='converting_characters_from_source_character_set_to_execution_character_set'></a></span>implementation-defined member other
than the null (wide) character.<a class='footnotenum' href='#footnote-14'>14</a></p></li><li id='1.6'><p><a class='enumerated_item_num' href='#1.6'>6.</a>Adjacent string literal tokens are concatenated.</p></li><li id='1.7'><p><a class='enumerated_item_num' href='#1.7'>7.</a>White-space characters separating tokens are no longer
significant. Each preprocessing token is converted into a
token. (<a href='lex.token'>[lex.token]</a>). The resulting tokens are syntactically and
semantically analyzed and translated as a translation unit. [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span>
The process of analyzing and translating the tokens may occasionally
result in one token being replaced by a sequence of other
tokens (<a href='temp.names'>[temp.names]</a>).<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> Source files, translation
units and translated translation units need not necessarily be stored as
files, nor need there be any one-to-one correspondence between these
entities and any external representation. The description is conceptual
only, and does not specify any particular implementation. <span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>]</p></li><li id='1.8'><p><a class='enumerated_item_num' href='#1.8'>8.</a>Translated translation units and instantiation units are combined
as follows: [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> Some or all of these may be supplied from a
library. <span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] Each translated translation unit is examined to
produce a list of required instantiations. [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> This may include
instantiations which have been explicitly
requested (<a href='temp.explicit'>[temp.explicit]</a>). <span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] The definitions of the
required templates are located. It is <span class='indexparent'><a class='index' id='whether_source_of_translation_units_must_be_available_to_locate_template_definitions'></a></span>implementation-defined whether the
source of the translation units containing these definitions is required
to be available. [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> An implementation could encode sufficient
information into the translated translation unit so as to ensure the
source is not required here. <span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] All the required instantiations
are performed to produce
<a class='hidden_link' href='#def:instantiation_units' id='def:instantiation_units'><i>instantiation units</i></a>. [<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> These are similar
to translated translation units, but contain no references to
uninstantiated templates and no template definitions. <span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] The
program is ill-formed if any instantiation fails.</p></li><li id='1.9'><p><a class='enumerated_item_num' href='#1.9'>9.</a>All external entity references are resolved. Library
components are linked to satisfy external references to
entities not defined in the current translation. All such translator
output is collected into a program image which contains information
needed for execution in its execution environment.<span class='indexparent'><a class='index' id='translation,phases'></a></span>
</p></li></ol></div><div class='footnote' id='footnote-12'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-12'>12)</a></div><p >Implementations must behave as if these separate phases
occur, although in practice different phases might be folded together.</p></div><div class='footnote' id='footnote-13'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-13'>13)</a></div><p >A partial preprocessing
token would arise from a source file
ending in the first portion of a multi-character token that requires a
terminating sequence of characters, such as a <i ><a href='lex.header#nt:header-name'>header-name</a></i>
that is missing the closing <span class='texttt'>"</span>
or <span class='texttt'>&gt;</span>. A partial comment
would arise from a source file ending with an unclosed <span class='texttt'>/*</span>
comment.</p></div><div class='footnote' id='footnote-14'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-14'>14)</a></div><p >An implementation need not convert all
non-corresponding source characters to the same execution character.</p></div></div></div></body></html>