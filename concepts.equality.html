<!DOCTYPE html><html lang='en'><head><title>[concepts.equality]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>17</a> Concepts library <a class='abbr_ref' href='./#concepts'>[concepts]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>17.2</a> Equality preservation <a class='abbr_ref'>[concepts.equality]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L26'>#</a></div><div id='1.sentence-1' class='sentence'>An expression is <a class='hidden_link' href='#def:expression,equality-preserving' id='def:expression,equality-preserving'><i >equality-preserving</i></a> if,
given equal inputs, the expression results in equal outputs<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>The inputs to an
expression are the set of the expression's operands<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>The output of an expression
is the expression's result and all operands modified by the expression<a class='hidden_link' href='#1.sentence-3'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L32'>#</a></div><div id='2.sentence-1' class='sentence'>Not all input values need be valid for a given expression; e.g., for integers
<span class='texttt'>a</span> and <span class='texttt'>b</span>, the expression <span class='texttt'>a / b</span> is not well-defined when
<span class='texttt'>b</span> is <span class='texttt'>0</span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>This does not preclude the expression <span class='texttt'>a / b</span>
being equality-preserving<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>The <a class='hidden_link' href='#def:domain' id='def:domain'><i>domain</i></a> of an expression is the set of
input values for which the expression is required to be well-defined<a class='hidden_link' href='#2.sentence-3'>.</a></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L39'>#</a></div><div id='3.sentence-1' class='sentence'>Expressions required by this document to be equality-preserving are further
required to be stable: two evaluations of such an expression with the same input
objects are required to have equal outputs absent any explicit intervening
modification of those input objects<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-2' class='sentence'>This requirement allows generic code to reason about the current values of
objects based on knowledge of the prior values as observed via
equality-preserving expressions<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>It effectively forbids spontaneous changes to
an object, changes to an object from another thread of execution, changes to an
object as side effects of non-modifying expressions, and changes to an object as
side effects of modifying a distinct object if those changes could be observable
to a library function via an equality-preserving expression that is required to
be valid for that object<a class='hidden_link' href='#3.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L55'>#</a></div><div id='4.sentence-1' class='sentence'>Expressions declared in a <i ><a href='expr.prim.req#nt:requires-expression'>requires-expression</a></i> in this document are
required to be equality-preserving, except for those annotated with the comment
“not required to be equality-preserving<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>” An expression so annotated
may be equality-preserving, but is not required to be so<a class='hidden_link' href='#4.sentence-2'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L61'>#</a></div><div id='5.sentence-1' class='sentence'>An expression that may alter the value of one or more of its inputs in a manner
observable to equality-preserving expressions is said to modify those inputs<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>This document uses a notational convention to specify which expressions declared
in a <i ><a href='expr.prim.req#nt:requires-expression'>requires-expression</a></i> modify which inputs: except where
otherwise specified, an expression operand that is a non-constant lvalue or
rvalue may be modified<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>Operands that are constant lvalues or rvalues are
required to not be modified<a class='hidden_link' href='#5.sentence-3'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L70'>#</a></div><div id='6.sentence-1' class='sentence'>Where a <i ><a href='expr.prim.req#nt:requires-expression'>requires-expression</a></i> declares an expression that is
non-modifying for some constant lvalue operand, additional variations of that
expression that accept a non-constant lvalue or (possibly constant) rvalue for
the given operand are also required except where such an expression variation is
explicitly required with differing semantics<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>These
<a class='hidden_link' href='#def:implicit_expression_variations' id='def:implicit_expression_variations'><i>implicit expression variations</i></a> are required to meet the semantic
requirements of the declared expression<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='6.sentence-3' class='sentence'>The extent to which an implementation
validates the syntax of the variations is unspecified<a class='hidden_link' href='#6.sentence-3'>.</a></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L80'>#</a></div><div id='7.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#7.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
template&lt;class T&gt; concept C = requires(T a, T b, const T c, const T d) {
  c == d;           <span class='comment'>// #1
</span>  a = std::move(b); <span class='comment'>// #2
</span>  a = c;            <span class='comment'>// #3
</span>};</pre><div id='7.sentence-1' class='sentence'>For the above example:
<ul class='itemize'><li ><div id='7.sentence-1' class='sentence'>Expression #1 does not modify either of its operands, #2 modifies both of its
operands, and #3 modifies only its first operand <span class='texttt'>a</span><a class='hidden_link' href='#7.sentence-1'>.</a></div></li><li ><div id='7.sentence-1' class='sentence'>Expression #1 implicitly requires additional expression variations that meet
the requirements for <span class='texttt'>c == d</span> (including non-modification), as if the
expressions
<pre class='codeblock'>
                                            c  ==           b;
          c  == std::move(d);               c  == std::move(b);
std::move(c) ==           d;      std::move(c) ==           b;
std::move(c) == std::move(d);     std::move(c) == std::move(b);

          a  ==           d;                a  ==           b;
          a  == std::move(d);               a  == std::move(b);
std::move(a) ==           d;      std::move(a) ==           b;
std::move(a) == std::move(d);     std::move(a) == std::move(b);</pre>
had been declared as well<a class='hidden_link' href='#7.sentence-1'>.</a></div></li><li ><div id='7.sentence-1' class='sentence'>Expression #3 implicitly requires additional expression variations that meet
the requirements for <span class='texttt'>a = c</span> (including non-modification of the second
operand), as if the expressions <span class='texttt'>a = b</span> and <span class='texttt'>a = std&#x200b;::&#x200b;move(c)</span> had
been declared<a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.sentence-2' class='sentence'>Expression #3 does not implicitly require an expression
variation with a non-constant rvalue second operand, since expression #2
already specifies exactly such an expression explicitly<a class='hidden_link' href='#7.sentence-2'>.</a></div></li></ul></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/72f1bb19b4700cf4c6478b84a517150a43a91dd2/source/concepts.tex#L123'>#</a></div><div id='8.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#8.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='8.sentence-1' class='sentence'>The following type <span class='texttt'>T</span> meets the explicitly stated syntactic requirements
of concept <span class='texttt'>C</span> above but does not meet the additional implicit
requirements:</div><pre class='codeblock'>
struct T {
  bool operator==(const T&amp;) const { return true; }
  bool operator==(T&amp;) = delete;
};</pre><div id='8.sentence-2' class='sentence'><span class='texttt'>T</span> fails to meet the implicit requirements of <span class='texttt'>C</span>, so <span class='texttt'>C&lt;T&gt;</span>
is not satisfied<a class='hidden_link' href='#8.sentence-2'>.</a></div> <div id='8.sentence-3' class='sentence'>Since implementations are not required to validate the syntax
of implicit requirements, it is unspecified whether an implementation diagnoses
as ill-formed a program that requires <span class='texttt'>C&lt;T&gt;</span><a class='hidden_link' href='#8.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></body></html>