<!DOCTYPE html><html lang='en'><head><title>[ratio]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>23</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>23.16</a> Compile-time rational arithmetic <a class='abbr_ref'>[ratio]</a></h2><div id='general' class='section'><h3 ><a class='secnum' href='#general' style='min-width:103pt'>23.16.1</a> In general <a class='abbr_ref' href='ratio.general'>[ratio.general]</a></h3><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17058'>#</a></div><div id='general-1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id='lib:ratio'></a></span>This subclause describes the ratio library<a class='hidden_link' href='#general-1.sentence-1'>.</a></div> <div id='general-1.sentence-2' class='sentence'>It provides a class template
<span class='texttt'>ratio</span> which exactly represents any finite rational number with a
numerator and denominator representable by compile-time constants of type
<span class='texttt'>intmax_&shy;t</span><a class='hidden_link' href='#general-1.sentence-2'>.</a></div></div><div class='para' id='general-2'><div class='marginalizedparent'><a class='marginalized' href='#general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17065'>#</a></div><div id='general-2.sentence-1' class='sentence'>Throughout this subclause, the names of template parameters are used to express
type requirements<a class='hidden_link' href='#general-2.sentence-1'>.</a></div> <div id='general-2.sentence-2' class='sentence'>If a template parameter is named <span class='texttt'>R1</span> or <span class='texttt'>R2</span>,
and the template argument is not a specialization of the <span class='texttt'>ratio</span> template,
the program is ill-formed<a class='hidden_link' href='#general-2.sentence-2'>.</a></div></div></div><div id='syn' class='section'><h3 ><a class='secnum' href='#syn' style='min-width:103pt'>23.16.2</a> Header <span class='texttt'>&lt;ratio&gt;</span> synopsis <a class='abbr_ref' href='ratio.syn'>[ratio.syn]</a></h3><span class='indexparent'><a class='index' id=':<ratio>'></a></span><span class='indexparent'><a class='index' id='lib:<ratio>'></a></span><pre class='codeblock'>
namespace std {
  <span class='comment'>// <a href='ratio.ratio'>[ratio.ratio]</a>, class template <span class='tcode_in_codeblock'>ratio</span>
</span>  template &lt;intmax_t N, intmax_t D = 1&gt; class ratio;

  <span class='comment'>// <a href='ratio.arithmetic'>[ratio.arithmetic]</a>, ratio arithmetic
</span>  template &lt;class R1, class R2&gt; using ratio_add = <span class='textit'><span class='texttt'>see below</span></span>;
  template &lt;class R1, class R2&gt; using ratio_subtract = <span class='textit'><span class='texttt'>see below</span></span>;
  template &lt;class R1, class R2&gt; using ratio_multiply = <span class='textit'><span class='texttt'>see below</span></span>;
  template &lt;class R1, class R2&gt; using ratio_divide = <span class='textit'><span class='texttt'>see below</span></span>;

  <span class='comment'>// <a href='ratio.comparison'>[ratio.comparison]</a>, ratio comparison
</span>  template &lt;class R1, class R2&gt; struct ratio_equal;
  template &lt;class R1, class R2&gt; struct ratio_not_equal;
  template &lt;class R1, class R2&gt; struct ratio_less;
  template &lt;class R1, class R2&gt; struct ratio_less_equal;
  template &lt;class R1, class R2&gt; struct ratio_greater;
  template &lt;class R1, class R2&gt; struct ratio_greater_equal;

  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_equal_v = ratio_equal&lt;R1, R2&gt;::value;
  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_not_equal_v = ratio_not_equal&lt;R1, R2&gt;::value;
  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_less_v = ratio_less&lt;R1, R2&gt;::value;
  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_less_equal_v = ratio_less_equal&lt;R1, R2&gt;::value;
  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_greater_v = ratio_greater&lt;R1, R2&gt;::value;
  template &lt;class R1, class R2&gt;
    inline constexpr bool ratio_greater_equal_v = ratio_greater_equal&lt;R1, R2&gt;::value;

  <span class='comment'>// <a href='ratio.si'>[ratio.si]</a>, convenience SI typedefs
</span>  using yocto = ratio&lt;1, 1'000'000'000'000'000'000'000'000&gt;;  <span class='comment'>// see below
</span>  using zepto = ratio&lt;1,     1'000'000'000'000'000'000'000&gt;;  <span class='comment'>// see below
</span>  using atto  = ratio&lt;1,         1'000'000'000'000'000'000&gt;;
  using femto = ratio&lt;1,             1'000'000'000'000'000&gt;;
  using pico  = ratio&lt;1,                 1'000'000'000'000&gt;;
  using nano  = ratio&lt;1,                     1'000'000'000&gt;;
  using micro = ratio&lt;1,                         1'000'000&gt;;
  using milli = ratio&lt;1,                             1'000&gt;;
  using centi = ratio&lt;1,                               100&gt;;
  using deci  = ratio&lt;1,                                10&gt;;
  using deca  = ratio&lt;                               10, 1&gt;;
  using hecto = ratio&lt;                              100, 1&gt;;
  using kilo  = ratio&lt;                            1'000, 1&gt;;
  using mega  = ratio&lt;                        1'000'000, 1&gt;;
  using giga  = ratio&lt;                    1'000'000'000, 1&gt;;
  using tera  = ratio&lt;                1'000'000'000'000, 1&gt;;
  using peta  = ratio&lt;            1'000'000'000'000'000, 1&gt;;
  using exa   = ratio&lt;        1'000'000'000'000'000'000, 1&gt;;
  using zetta = ratio&lt;    1'000'000'000'000'000'000'000, 1&gt;;  <span class='comment'>// see below
</span>  using yotta = ratio&lt;1'000'000'000'000'000'000'000'000, 1&gt;;  <span class='comment'>// see below
</span>}</pre></div><div id='ratio' class='section'><h3 ><a class='secnum' href='#ratio' style='min-width:103pt'>23.16.3</a> Class template <span class='texttt'>ratio</span> <a class='abbr_ref' href='ratio.ratio'>[ratio.ratio]</a></h3><span class='indexparent'><a class='index' id='lib:ratio_'></a></span><pre class='codeblock'>
namespace std {
  template &lt;intmax_t N, intmax_t D = 1&gt;
  class ratio {
  public:
    static constexpr intmax_t num;
    static constexpr intmax_t den;
    using type = ratio&lt;num, den&gt;;
  };
}</pre><div class='para' id='ratio-1'><div class='marginalizedparent'><a class='marginalized' href='#ratio-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17146'>#</a></div><div id='ratio-1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':signed_integer_representation,two&#39;s_complement'></a></span>If the template argument <span class='texttt'>D</span> is zero or the absolute values of either of the
template arguments <span class='texttt'>N</span> and <span class='texttt'>D</span> is not representable by type
<span class='texttt'>intmax_&shy;t</span>, the program is ill-formed<a class='hidden_link' href='#ratio-1.sentence-1'>.</a></div> <div id='ratio-1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#ratio-1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='ratio-1.sentence-2' class='sentence'>These rules ensure that infinite
ratios are avoided and that for any negative input, there exists a representable value
of its absolute value which is positive<a class='hidden_link' href='#ratio-1.sentence-2'>.</a></div> <div id='ratio-1.sentence-3' class='sentence'>In a two's complement representation, this
excludes the most negative value<a class='hidden_link' href='#ratio-1.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='ratio-2'><div class='marginalizedparent'><a class='marginalized' href='#ratio-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17155'>#</a></div><div id='ratio-2.sentence-1' class='sentence'>The static data members <span class='texttt'>num</span> and <span class='texttt'>den</span> shall have the following values,
where <span class='texttt'>gcd</span> represents the greatest common divisor of the absolute values of
<span class='texttt'>N</span> and <span class='texttt'>D</span>:</div><div id='ratio-2.sentence-2' class='sentence'><ul class='itemize'><li id='ratio-2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#ratio-2.1'>(2.1)</a></div><div id='ratio-2.1.sentence-1' class='sentence'><span class='texttt'>num</span> shall have the value <span class='texttt'>sign(N) * sign(D) * abs(N) / gcd</span><a class='hidden_link' href='#ratio-2.1.sentence-1'>.</a></div></li><li id='ratio-2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#ratio-2.2'>(2.2)</a></div><div id='ratio-2.2.sentence-1' class='sentence'><span class='texttt'>den</span> shall have the value <span class='texttt'>abs(D) / gcd</span><a class='hidden_link' href='#ratio-2.2.sentence-1'>.</a></div></li></ul></div></div></div><div id='arithmetic' class='section'><h3 ><a class='secnum' href='#arithmetic' style='min-width:103pt'>23.16.4</a> Arithmetic on <span class='texttt'>ratio</span>s <a class='abbr_ref' href='ratio.arithmetic'>[ratio.arithmetic]</a></h3><div class='para' id='arithmetic-1'><div class='marginalizedparent'><a class='marginalized' href='#arithmetic-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17167'>#</a></div><div id='arithmetic-1.sentence-1' class='sentence'>Each of the alias templates <span class='texttt'>ratio_&shy;add</span>, <span class='texttt'>ratio_&shy;subtract</span>, <span class='texttt'>ratio_&shy;multiply</span>,
and <span class='texttt'>ratio_&shy;divide</span> denotes the result of an arithmetic computation on two
<span class='texttt'>ratio</span>s <span class='texttt'>R1</span> and <span class='texttt'>R2</span><a class='hidden_link' href='#arithmetic-1.sentence-1'>.</a></div> <div id='arithmetic-1.sentence-2' class='sentence'>With <span class='texttt'>X</span> and <span class='texttt'>Y</span> computed (in the
absence of arithmetic overflow) as specified by Table <a href='#tab:ratio.arithmetic'>51</a>, each alias
denotes a <span class='texttt'>ratio&lt;U, V&gt;</span> such that <span class='texttt'>U</span> is the same as <span class='texttt'>ratio&lt;X, Y&gt;&#x200b;::&#x200b;num</span> and
<span class='texttt'>V</span> is the same as <span class='texttt'>ratio&lt;X, Y&gt;&#x200b;::&#x200b;den</span><a class='hidden_link' href='#arithmetic-1.sentence-2'>.</a></div></div><div class='para' id='arithmetic-2'><div class='marginalizedparent'><a class='marginalized' href='#arithmetic-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17175'>#</a></div><div id='arithmetic-2.sentence-1' class='sentence'>If it is not possible to represent <span class='texttt'>U</span> or <span class='texttt'>V</span> with <span class='texttt'>intmax_&shy;t</span>, the program is
ill-formed<a class='hidden_link' href='#arithmetic-2.sentence-1'>.</a></div> <div id='arithmetic-2.sentence-2' class='sentence'>Otherwise, an implementation should yield correct values of <span class='texttt'>U</span> and
<span class='texttt'>V</span><a class='hidden_link' href='#arithmetic-2.sentence-2'>.</a></div> <div id='arithmetic-2.sentence-3' class='sentence'>If it is not possible to represent <span class='texttt'>X</span> or <span class='texttt'>Y</span> with <span class='texttt'>intmax_&shy;t</span>, the
program is ill-formed unless the implementation yields correct values of <span class='texttt'>U</span> and
<span class='texttt'>V</span><a class='hidden_link' href='#arithmetic-2.sentence-3'>.</a></div><div class='numberedTable' id='tab:ratio.arithmetic'>Table <a href='#tab:ratio.arithmetic'>51</a> — Expressions used to perform ratio arithmetic<br><table ><tr class='rowsep'><td colspan='1' class='center'><div id='arithmetic-2.sentence-4' class='sentence'><b>Type</b></div></td><td colspan='1' class='center'><div id='arithmetic-2.sentence-5' class='sentence'><b>Value of <span class='texttt'>X</span></b></div></td><td colspan='1' class='center'><div id='arithmetic-2.sentence-6' class='sentence'><b>Value of <span class='texttt'>Y</span></b></div></td></tr><tr class='rowsep'><td class='left'><div style='height:0.6em;display:block'></div><div id='arithmetic-2.sentence-7' class='sentence'><span class='texttt'>ratio_&shy;add&lt;R1, R2&gt;</span></div></td><td class='left'><div id='arithmetic-2.sentence-8' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;num * R2&#x200b;::&#x200b;den +</span></div></td><td class='left'><div id='arithmetic-2.sentence-9' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;den * R2&#x200b;::&#x200b;den</span></div></td></tr><tr ><td class='left'></td><td class='left'><div id='arithmetic-2.sentence-10' class='sentence'><span class='texttt'>R2&#x200b;::&#x200b;num * R1&#x200b;::&#x200b;den</span></div></td><td class='left'></td></tr><tr class='rowsep'><td class='left'><div style='height:0.6em;display:block'></div><div id='arithmetic-2.sentence-11' class='sentence'><span class='texttt'>ratio_&shy;subtract&lt;R1, R2&gt;</span></div></td><td class='left'><div id='arithmetic-2.sentence-12' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;num * R2&#x200b;::&#x200b;den -</span></div></td><td class='left'><div id='arithmetic-2.sentence-13' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;den * R2&#x200b;::&#x200b;den</span></div></td></tr><tr ><td class='left'></td><td class='left'><div id='arithmetic-2.sentence-14' class='sentence'><span class='texttt'>R2&#x200b;::&#x200b;num * R1&#x200b;::&#x200b;den</span></div></td><td class='left'></td></tr><tr class='rowsep'><td class='left'><div style='height:0.6em;display:block'></div><div id='arithmetic-2.sentence-15' class='sentence'><span class='texttt'>ratio_&shy;multiply&lt;R1, R2&gt;</span></div></td><td class='left'><div id='arithmetic-2.sentence-16' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;num * R2&#x200b;::&#x200b;num</span></div></td><td class='left'><div id='arithmetic-2.sentence-17' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;den * R2&#x200b;::&#x200b;den</span></div></td></tr><tr class='rowsep'><td class='left'><div style='height:0.6em;display:block'></div><div id='arithmetic-2.sentence-18' class='sentence'><span class='texttt'>ratio_&shy;divide&lt;R1, R2&gt;</span></div></td><td class='left'><div id='arithmetic-2.sentence-19' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;num * R2&#x200b;::&#x200b;den</span></div></td><td class='left'><div id='arithmetic-2.sentence-20' class='sentence'><span class='texttt'>R1&#x200b;::&#x200b;den * R2&#x200b;::&#x200b;num</span></div></td></tr></table></div></div><div class='para' id='arithmetic-3'><div class='marginalizedparent'><a class='marginalized' href='#arithmetic-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17212'>#</a></div><div id='arithmetic-3.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#arithmetic-3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
static_assert(ratio_add&lt;ratio&lt;1, 3&gt;, ratio&lt;1, 6&gt;&gt;::num == 1, "1/3+1/6 == 1/2");
static_assert(ratio_add&lt;ratio&lt;1, 3&gt;, ratio&lt;1, 6&gt;&gt;::den == 2, "1/3+1/6 == 1/2");
static_assert(ratio_multiply&lt;ratio&lt;1, 3&gt;, ratio&lt;3, 2&gt;&gt;::num == 1, "1/3*3/2 == 1/2");
static_assert(ratio_multiply&lt;ratio&lt;1, 3&gt;, ratio&lt;3, 2&gt;&gt;::den == 2, "1/3*3/2 == 1/2");

<span class='comment'>// The following cases may cause the program to be ill-formed under some implementations
</span>static_assert(ratio_add&lt;ratio&lt;1, INT_MAX&gt;, ratio&lt;1, INT_MAX&gt;&gt;::num == 2,
  "1/MAX+1/MAX == 2/MAX");
static_assert(ratio_add&lt;ratio&lt;1, INT_MAX&gt;, ratio&lt;1, INT_MAX&gt;&gt;::den == INT_MAX,
  "1/MAX+1/MAX == 2/MAX");
static_assert(ratio_multiply&lt;ratio&lt;1, INT_MAX&gt;, ratio&lt;INT_MAX, 2&gt;&gt;::num == 1,
  "1/MAX * MAX/2 == 1/2");
static_assert(ratio_multiply&lt;ratio&lt;1, INT_MAX&gt;, ratio&lt;INT_MAX, 2&gt;&gt;::den == 2,
  "1/MAX * MAX/2 == 1/2");</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div id='comparison' class='section'><h3 ><a class='secnum' href='#comparison' style='min-width:103pt'>23.16.5</a> Comparison of <span class='texttt'>ratio</span>s <a class='abbr_ref' href='ratio.comparison'>[ratio.comparison]</a></h3><span class='indexparent'><a class='index' id='lib:ratio_equal'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_equal : bool_constant&lt;R1::num == R2::num &amp;&amp; R1::den == R2::den&gt; { };
</code><span class='indexparent'><a class='index' id='lib:ratio_not_equal'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_not_equal : bool_constant&lt;!ratio_equal_v&lt;R1, R2&gt;&gt; { };
</code><span class='indexparent'><a class='index' id='lib:ratio_less'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_less : bool_constant&lt;<span class='textit'><span class='texttt'>see below</span></span>&gt; { };
</code><div class='itemdescr'></div><div class='para' id='comparison-1'><div class='marginalizedparent'><a class='marginalized' href='#comparison-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17255'>#</a></div><div id='comparison-1.sentence-1' class='sentence'>If <span class='texttt'>R1&#x200b;::&#x200b;num</span> <span class='math'>&times;</span> <span class='texttt'>R2&#x200b;::&#x200b;den</span> is less than <span class='texttt'>R2&#x200b;::&#x200b;num</span> <span class='math'>&times;</span> <span class='texttt'>R1&#x200b;::&#x200b;den</span>,
<span class='texttt'>ratio_&shy;less&lt;R1, R2&gt;</span> shall be
derived from <span class='texttt'>bool_&shy;constant&lt;true&gt;</span>; otherwise it shall be derived from
<span class='texttt'>bool_&shy;constant&lt;false&gt;</span><a class='hidden_link' href='#comparison-1.sentence-1'>.</a></div> <div id='comparison-1.sentence-2' class='sentence'>Implementations may use other algorithms to
compute this relationship to avoid overflow<a class='hidden_link' href='#comparison-1.sentence-2'>.</a></div> <div id='comparison-1.sentence-3' class='sentence'>If overflow occurs, the program is ill-formed<a class='hidden_link' href='#comparison-1.sentence-3'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:ratio_less_equal'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_less_equal : bool_constant&lt;!ratio_less_v&lt;R2, R1&gt;&gt; { };
</code><span class='indexparent'><a class='index' id='lib:ratio_greater'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_greater : bool_constant&lt;ratio_less_v&lt;R2, R1&gt;&gt; { };
</code><span class='indexparent'><a class='index' id='lib:ratio_greater_equal'></a></span><code class='itemdecl'>template &lt;class R1, class R2&gt;
  struct ratio_greater_equal : bool_constant&lt;!ratio_less_v&lt;R1, R2&gt;&gt; { };
</code></div><div id='si' class='section'><h3 ><a class='secnum' href='#si' style='min-width:103pt'>23.16.6</a> SI types for <span class='texttt'>ratio</span> <a class='abbr_ref' href='ratio.si'>[ratio.si]</a></h3><div class='para' id='si-1'><div class='marginalizedparent'><a class='marginalized' href='#si-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/32fffbe4796ab0852f7bdf66b6d48d2e2b5e61ea/source/utilities.tex#L17283'>#</a></div><div id='si-1.sentence-1' class='sentence'>For each of the <i ><a href='dcl.typedef#nt:typedef-name'>typedef-name</a></i><span class='textit'>s</span> <span class='texttt'>yocto</span>, <span class='texttt'>zepto</span>,
<span class='texttt'>zetta</span>, and <span class='texttt'>yotta</span>, if both of the constants used in its
specification are representable by <span class='texttt'>intmax_&shy;t</span>, the typedef shall be
defined; if either of the constants is not representable by <span class='texttt'>intmax_&shy;t</span>,
the typedef shall not be defined<a class='hidden_link' href='#si-1.sentence-1'>.</a></div></div></div></div></body></html>