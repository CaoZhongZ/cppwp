<!DOCTYPE html><html lang='en'><head><title>[atomics.fences]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>32</a> Atomic operations library <a class='abbr_ref' href='./#atomics'>[atomics]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>32.9</a> Fences <a class='abbr_ref'>[atomics.fences]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1419'>#</a></div><p >This section introduces synchronization primitives called <a class='hidden_link' href='#def:fences' id='def:fences'><i>fences</i></a>. Fences can have
acquire semantics, release semantics, or both. A fence with acquire semantics is called
an <a class='hidden_link' href='#def:acquire_fence' id='def:acquire_fence'><i>acquire fence</i></a>. A fence with release semantics is called a <a class='hidden_link' href='#def:release_fence' id='def:release_fence'><i>release
fence</i></a>.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1425'>#</a></div><p >A release fence <span class='textit'>A</span> synchronizes with an acquire fence <span class='textit'>B</span> if there exist
atomic operations <span class='textit'>X</span> and <span class='textit'>Y</span>, both operating on some atomic object
<span class='textit'>M</span>, such that <span class='textit'>A</span> is sequenced before <span class='textit'>X</span>, <span class='textit'>X</span> modifies
<span class='textit'>M</span>, <span class='textit'>Y</span> is sequenced before <span class='textit'>B</span>, and <span class='textit'>Y</span> reads the value
written by <span class='textit'>X</span> or a value written by any side effect in the hypothetical release
sequence <span class='textit'>X</span> would head if it were a release operation.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1433'>#</a></div><p >A release fence <span class='textit'>A</span> synchronizes with an atomic operation <span class='textit'>B</span> that
performs an acquire operation on an atomic object <span class='textit'>M</span> if there exists an atomic
operation <span class='textit'>X</span> such that <span class='textit'>A</span> is sequenced before <span class='textit'>X</span>, <span class='textit'>X</span>
modifies <span class='textit'>M</span>, and <span class='textit'>B</span> reads the value written by <span class='textit'>X</span> or a value
written by any side effect in the hypothetical release sequence <span class='textit'>X</span> would head if
it were a release operation.</p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1441'>#</a></div><p >An atomic operation <span class='textit'>A</span> that is a release operation on an atomic object
<span class='textit'>M</span> synchronizes with an acquire fence <span class='textit'>B</span> if there exists some atomic
operation <span class='textit'>X</span> on <span class='textit'>M</span> such that <span class='textit'>X</span> is sequenced before <span class='textit'>B</span>
and reads the value written by <span class='textit'>A</span> or a value written by any side effect in the
release sequence headed by <span class='textit'>A</span>.</p><p ><span class='indexparent'><a class='index' id='lib:atomic_thread_fence'></a></span></p></div><p ><code class='itemdecl'>extern "C" void atomic_thread_fence(memory_order order) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1454'>#</a></div><p ><span class='textit'>Effects:</span> Depending on the value of <span class='texttt'>order</span>, this operation:</p><ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#5.1'>(5.1)</a></div><p >has no effects, if <span class='texttt'>order == memory_&shy;order_&shy;relaxed</span>;</p></li><li id='5.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#5.2'>(5.2)</a></div><p >is an acquire fence, if <span class='texttt'>order == memory_&shy;order_&shy;acquire || order ==
memory_&shy;order_&shy;consume</span>;</p></li><li id='5.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#5.3'>(5.3)</a></div><p >is a release fence, if <span class='texttt'>order == memory_&shy;order_&shy;release</span>;</p></li><li id='5.4'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#5.4'>(5.4)</a></div><p >is both an acquire fence and a release fence, if <span class='texttt'>order ==
memory_&shy;order_&shy;acq_&shy;rel</span>;</p></li><li id='5.5'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#5.5'>(5.5)</a></div><p >is a sequentially consistent acquire and release fence, if <span class='texttt'>order == memory_&shy;order_&shy;seq_&shy;cst</span>.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='lib:atomic_signal_fence'></a></span></p><p ><code class='itemdecl'>extern "C" void atomic_signal_fence(memory_order order) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1478'>#</a></div><p ><span class='textit'>Effects:</span> Equivalent to <span class='texttt'>atomic_&shy;thread_&shy;fence(order)</span>, except that
the resulting ordering constraints are established only between a thread and a
signal handler executed in the same thread.</p></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/33316c99af9acd689e81d52f6e13bb102301f5d8/source/atomics.tex#L1483'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
<span class='texttt'>atomic_&shy;signal_&shy;fence</span> can be used to specify the order in which actions
performed by the thread become visible to the signal handler.
Compiler optimizations and reorderings of loads and stores are inhibited in
the same way as with <span class='texttt'>atomic_&shy;thread_&shy;fence</span>, but the hardware fence instructions
that <span class='texttt'>atomic_&shy;thread_&shy;fence</span> would have inserted are not emitted.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>â€”<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] 
</p></div></div></div></body></html>