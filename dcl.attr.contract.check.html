<!DOCTYPE html><html lang='en'><head><title>[dcl.attr.contract.check]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>9</a> Declarations <a class='abbr_ref' href='./#dcl.dcl'>[dcl.dcl]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>9.11</a> Attributes <a class='abbr_ref' href='dcl.attr#contract.check'>[dcl.attr]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>9.11.4</a> Contract attributes <a class='abbr_ref' href='dcl.attr.contract#check'>[dcl.attr.contract]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>9.11.4.3</a> Checking contracts <a class='abbr_ref'>[dcl.attr.contract.check]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8427'>#</a></div><div id='1.sentence-1' class='sentence'>If the <i ><a href='dcl.attr.contract.syn#nt:contract-level'>contract-level</a></i>
of a <i ><a href='dcl.attr.contract.syn#nt:contract-attribute-specifier'>contract-attribute-specifier</a></i> is absent,
it is assumed to be <span class='texttt'>default</span><a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.sentence-2' class='sentence'>A <span class='texttt'>default</span> <i ><a href='dcl.attr.contract.syn#nt:contract-level'>contract-level</a></i> is expected to be used
for those contracts where
the cost of run-time checking is assumed to be
small (or at least not expensive) compared to
the cost of executing the function<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>An <span class='texttt'>audit</span> <i ><a href='dcl.attr.contract.syn#nt:contract-level'>contract-level</a></i> is expected to be used
for those contracts where
the cost of run-time checking is assumed to be
large (or at least significant) compared to
the cost of executing the function<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>An <span class='texttt'>axiom</span> <i ><a href='dcl.attr.contract.syn#nt:contract-level'>contract-level</a></i> is expected to be used
for those contracts that are formal comments
and are not evaluated at run-time<a class='hidden_link' href='#1.sentence-4'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8447'>#</a></div><div id='2.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-1' class='sentence'>Multiple contract conditions may be applied to a function type
with the same or different <i ><a href='dcl.attr.contract.syn#nt:contract-level'>contract-level</a></i><span class='textit'>s</span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#2.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
int z;

bool is_prime(int k);

void f(int x)
  [[expects: x &gt; 0]]
  [[expects audit: is_prime(x)]]
  [[ensures: z &gt; 10]]
{
  <span class='tcode_in_codeblock'>/* ...&nbsp;*/</span>
}</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div>  —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8468'>#</a></div><div id='3.sentence-1' class='sentence'>A translation may be performed
with one of the following <a class='hidden_link' href='#def:build_level' id='def:build_level'><i >build levels</i></a>:
<a class='hidden_link' href='#def:off' id='def:off'><i>off</i></a>, <a class='hidden_link' href='#def:default' id='def:default'><i>default</i></a>, or <a class='hidden_link' href='#def:audit' id='def:audit'><i>audit</i></a><a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>A translation with build level set to <a class='hidden_link' href='#def:off' id='def:off'><i>off</i></a>
performs no checking for any contract<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>A translation with build level set to <a class='hidden_link' href='#def:default' id='def:default'><i>default</i></a>
performs checking for <span class='texttt'>default</span> contracts<a class='hidden_link' href='#3.sentence-3'>.</a></div> <div id='3.sentence-4' class='sentence'>A translation with build level set to <a class='hidden_link' href='#def:audit' id='def:audit'><i>audit</i></a>
performs checking for <span class='texttt'>default</span> and <span class='texttt'>audit</span> contracts<a class='hidden_link' href='#3.sentence-4'>.</a></div> <div id='3.sentence-5' class='sentence'>If no build level is explicitly selected, the build level is <a class='hidden_link' href='#def:default' id='def:default'><i>default</i></a><a class='hidden_link' href='#3.sentence-5'>.</a></div> <div id='3.sentence-6' class='sentence'>The mechanism for selecting the build level is
<span class='indexparent'><a class='index' id=':mechanism_for_selecting_the_build_level'></a></span>implementation-defined<a class='hidden_link' href='#3.sentence-6'>.</a></div> <div id='3.sentence-7' class='sentence'>The translation of a program consisting of translation units
where the build level is not the same in all translation units
is conditionally-supported<a class='hidden_link' href='#3.sentence-7'>.</a></div> <div id='3.sentence-8' class='sentence'>There should be no programmatic way of setting, modifying, or querying
the build level of a translation unit<a class='hidden_link' href='#3.sentence-8'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8487'>#</a></div><div id='4.sentence-1' class='sentence'>During constant expression evaluation (<a href='expr.const'>[expr.const]</a>),
only predicates of checked contracts are evaluated<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>In other contexts,
it is unspecified whether the predicate for a contract
that is not checked under the current build level is evaluated;
if the predicate of such a contract
would evaluate to <span class='texttt'>false</span>, the behavior is undefined<a class='hidden_link' href='#4.sentence-2'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8496'>#</a></div><div id='5.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:violation_handler' id='def:violation_handler'><i >violation handler</i></a> of a program is a function of type
“<span class='texttt'>noexcept</span><span class="mjx-chtml"><span class="mjx-math" aria-label="Subscript o p t"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> function of
(lvalue reference to <span class='texttt'>const std&#x200b;::&#x200b;contract_&shy;violation</span>)
returning <span class='texttt'>void</span>”, and is specified in an
<span class='indexparent'><a class='index' id=':specification_of_violation_handler'></a></span>implementation-defined manner<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>The violation handler is invoked
when the predicate of a checked contract evaluates to <span class='texttt'>false</span>
(called a <a class='hidden_link' href='#def:contract_violation' id='def:contract_violation'><i >contract violation</i></a>)<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>There should be no programmatic way of
setting or modifying the violation handler<a class='hidden_link' href='#5.sentence-3'>.</a></div> <div id='5.sentence-4' class='sentence'>It is <span class='indexparent'><a class='index' id=':argument_for_violation_handler'></a></span>implementation-defined
how the violation handler is established for a program and
how
the <span class='texttt'>std&#x200b;::&#x200b;contract_&shy;violation</span> (<a href='support.contract.cviol'>[support.contract.cviol]</a>) argument value
is set,
except as specified below<a class='hidden_link' href='#5.sentence-4'>.</a></div> <div id='5.sentence-5' class='sentence'>If a precondition is violated, the source location of the violation is
<span class='indexparent'><a class='index' id=':source_location_of_precondition_violation'></a></span>implementation-defined<a class='hidden_link' href='#5.sentence-5'>.</a></div> <div id='5.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#5.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='5.sentence-8' class='sentence'>Implementations are encouraged but not required to report the caller site<a class='hidden_link' href='#5.sentence-8'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='5.sentence-6' class='sentence'>
If a postcondition is violated, the source location of the violation is
the source location of the function definition<a class='hidden_link' href='#5.sentence-6'>.</a></div> <div id='5.sentence-7' class='sentence'>If an assertion is violated, the source location of the violation is
the source location of the statement to which the assertion is applied<a class='hidden_link' href='#5.sentence-7'>.</a></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8523'>#</a></div><div id='6.sentence-1' class='sentence'>If a user-provided violation handler exits by throwing an exception
and a contract is violated on a call to a function
with a non-throwing exception specification,
then the behavior is as if the exception escaped the function body<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#6.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='6.sentence-2' class='sentence'>The function <span class='texttt'>std&#x200b;::&#x200b;terminate</span> is invoked (<a href='except.terminate'>[except.terminate]</a>)<a class='hidden_link' href='#6.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='6.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
void f(int x) noexcept [[expects: x &gt; 0]];

void g() {
  f(0);                                         <span class='comment'>// <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;terminate()</span> if violation handler throws
</span>  <span class='tcode_in_codeblock'>/* ...&nbsp;*/</span>
}</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e160ea1300e21eb412feaa7733f1e7cd0e1875d8/source/declarations.tex#L8542'>#</a></div><div id='7.sentence-1' class='sentence'>A translation may be performed with one of the following
<a class='hidden_link' href='#def:violation_continuation_mode' id='def:violation_continuation_mode'><i >violation continuation modes</i></a>:
<a class='hidden_link' href='#def:off' id='def:off'><i>off</i></a> or <a class='hidden_link' href='#def:on' id='def:on'><i>on</i></a><a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.sentence-2' class='sentence'>A translation with violation continuation mode set to <a class='hidden_link' href='#def:off' id='def:off'><i>off</i></a>
terminates execution
by invoking the function <span class='texttt'>std&#x200b;::&#x200b;terminate</span> (<a href='except.terminate'>[except.terminate]</a>)
after completing the execution of the violation handler<a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='7.sentence-3' class='sentence'>A translation with a violation continuation mode set to <a class='hidden_link' href='#def:on' id='def:on'><i>on</i></a>
continues execution after completing the execution of the violation handler<a class='hidden_link' href='#7.sentence-3'>.</a></div> <div id='7.sentence-4' class='sentence'>If no continuation mode is explicitly selected,
the default continuation mode is <a class='hidden_link' href='#def:off' id='def:off'><i>off</i></a><a class='hidden_link' href='#7.sentence-4'>.</a></div> <div id='7.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#7.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='7.sentence-5' class='sentence'>A continuation mode set to <a class='hidden_link' href='#def:on' id='def:on'><i>on</i></a> provides the opportunity
to install a logging handler to instrument a pre-existing code base
and fix errors before enforcing checks<a class='hidden_link' href='#7.sentence-5'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='7.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#7.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
void f(int x) [[expects: x &gt; 0]];

void g() {
  f(0);         <span class='comment'>// <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;terminate()</span> after handler if continuation mode is off;
</span>                <span class='comment'>// proceeds after handler if continuation mode is on
</span>  <span class='tcode_in_codeblock'>/* ...&nbsp;*/</span>
}</pre> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></body></html>