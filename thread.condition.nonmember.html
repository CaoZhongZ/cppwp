<!DOCTYPE html><html lang='en'><head><title>[thread.condition.nonmember]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>33</a> Thread support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>33.5</a> Condition variables <a class='abbr_ref' href='thread.condition#nonmember'>[thread.condition]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>33.5.2</a> Non-member functions <a class='abbr_ref'>[thread.condition.nonmember]</a></h3><p ><span class='indexparent'><a class='index' id='lib:notify_all_at_thread_exit'></a></span></p><p ><code class='itemdecl'>void notify_all_at_thread_exit(condition_variable&amp; cond, unique_lock&lt;mutex&gt; lk);
</code></p><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ad1c6bb8e53bd32bd475d8b199e5ce01b8556f1/source/threads.tex#L2906'>#</a></div><p ><span class='textit'>Requires:</span> <span class='texttt'>lk</span> is locked by the calling thread and either</p><ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#1.1'>(1.1)</a></div><p >no other thread is waiting on <span class='texttt'>cond</span>, or
</p></li><li id='1.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#1.2'>(1.2)</a></div><p ><span class='texttt'>lk.mutex()</span> returns the same value for each of the lock arguments
supplied by all concurrently waiting (via <span class='texttt'>wait</span>, <span class='texttt'>wait_&shy;for</span>,
or <span class='texttt'>wait_&shy;until</span>) threads.
</p></li></ul></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ad1c6bb8e53bd32bd475d8b199e5ce01b8556f1/source/threads.tex#L2916'>#</a></div><p ><span class='textit'>Effects:</span> Transfers ownership of the lock associated with <span class='texttt'>lk</span> into
internal storage and schedules <span class='texttt'>cond</span> to be notified when the current
thread exits, after all objects of thread storage duration associated with
the current thread have been destroyed. This notification shall be as if:
</p><pre class='codeblock'>
lk.unlock();
cond.notify_all();</pre></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ad1c6bb8e53bd32bd475d8b199e5ce01b8556f1/source/threads.tex#L2926'>#</a></div><p ><span class='textit'>Synchronization:</span> The implied <span class='texttt'>lk.unlock()</span> call is sequenced after the destruction of
all objects with thread storage duration associated with the current thread.</p></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ad1c6bb8e53bd32bd475d8b199e5ce01b8556f1/source/threads.tex#L2930'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
The supplied lock will be held until the thread exits, and care
must be taken to ensure that this does not cause deadlock due to lock
ordering issues. After calling <span class='texttt'>notify_&shy;all_&shy;at_&shy;thread_&shy;exit</span> it is
recommended that the thread should be exited as soon as possible, and
that no blocking or time-consuming tasks are run on that thread.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ad1c6bb8e53bd32bd475d8b199e5ce01b8556f1/source/threads.tex#L2939'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
It is the user's responsibility to ensure that waiting threads
do not erroneously assume that the thread has finished if they experience
spurious wakeups. This typically requires that the condition being waited
for is satisfied while holding the lock on <span class='texttt'>lk</span>, and that this lock
is not released and reacquired prior to calling <span class='texttt'>notify_&shy;all_&shy;at_&shy;thread_&shy;exit</span>.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] 
</p></div></div></div></body></html>