<!DOCTYPE html><html lang='en'><head><title>[expr.const]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>7</a> Expressions <a class='abbr_ref' href='./#expr'>[expr]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>7.7</a> Constant expressions <a class='abbr_ref'>[expr.const]</a></h2><span class='indexparent'><a class='index' id=':expression,constant'></a></span><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L6798'>#</a></div><div id='1.sentence-1' class='sentence'>Certain contexts require expressions that satisfy additional
requirements as detailed in this subclause; other contexts have different
semantics depending on whether or not an expression satisfies these requirements<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>Expressions that satisfy these requirements,
assuming that copy elision (<a href='class.copy.elision'>[class.copy.elision]</a>) is not performed,
are called
<span class='indexparent'><a class='index' id=':expression,constant_'></a></span><a class='hidden_link' href='#def:constant_expression' id='def:constant_expression'><i >constant expressions</i></a><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.note-1' class='note'>[&nbsp;<a class='note_link' href='#1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.sentence-3' class='sentence'>Constant expressions can be evaluated
during translation<a class='hidden_link' href='#1.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> <pre class='bnf'><a class='nontermdef' href='#nt:constant-expression' id='nt:constant-expression'>constant-expression:</a>
&#9;<i ><a href='expr.cond#nt:conditional-expression'>conditional-expression</a></i>
</pre></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L6814'>#</a></div><div id='2.sentence-1' class='sentence'>A variable or temporary object <span class='texttt'>o</span> is <a class='hidden_link' href='#def:constant-initialized' id='def:constant-initialized'><i >constant-initialized</i></a> if
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div>either it has an initializer or
  its default-initialization results in some initialization being performed, and</li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div>its initialization full-expression is a constant expression
  when interpreted as a <i ><a href='#nt:constant-expression'>constant-expression</a></i>,
  except that if <span class='texttt'>o</span> is an object,
  the initialization full-expression
  may also invoke constexpr constructors
  for <span class='texttt'>o</span> and its subobjects
  even if those objects are of non-literal class types<a class='hidden_link' href='#2.sentence-1'>.</a> <div id='2.2.note-1' class='note'>[&nbsp;<a class='note_link' href='#2.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> Such a class may have a non-trivial destructor. Within this evaluation,
  <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>is_&shy;constant_&shy;evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> (<a href='meta.const.eval'>[meta.const.eval]</a>)
  returns <span class='texttt'><span class='literal'>true</span></span>. —&nbsp;<i>end note</i></div>&nbsp;]</div> </li></ul></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L6836'>#</a></div><div id='3.sentence-1' class='sentence'>A variable is <a class='hidden_link' href='#def:usable_in_constant_expressions' id='def:usable_in_constant_expressions'><i >usable in constant expressions</i></a> after
its initializing declaration is encountered if it is a constexpr variable, or
it is a constant-initialized variable
of reference type or of const-qualified integral or enumeration type<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>An object or reference is <a class='hidden_link' href='#def:usable_in_constant_expressions_' id='def:usable_in_constant_expressions_'><i >usable in constant expressions</i></a> if it is
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.1'>(3.1)</a></div>a variable that is usable in constant expressions, or</li><li id='3.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.2'>(3.2)</a></div>a template parameter object (<a href='temp.param'>[temp.param]</a>), or</li><li id='3.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.3'>(3.3)</a></div>a string literal object (<a href='lex.string'>[lex.string]</a>), or</li><li id='3.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.4'>(3.4)</a></div>a non-mutable subobject or reference member of any of the above, or</li><li id='3.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.5'>(3.5)</a></div>a complete temporary object of
  non-volatile const-qualified integral or enumeration type
  that is initialized with a constant expression<a class='hidden_link' href='#3.sentence-2'>.</a></li></ul></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L6852'>#</a></div><div id='4.sentence-1' class='sentence'>An expression <span class='texttt'>e</span> is a <a class='hidden_link' href='#def:expression,core_constant' id='def:expression,core_constant'><i >core constant expression</i></a>
unless the evaluation of <span class='texttt'>e</span>, following the rules of the <a href='intro.execution'>abstract
machine</a>, would evaluate one of the following:
<ul class='itemize'><li id='4.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>this</span></span> (<a href='expr.prim.this'>[expr.prim.this]</a>), except in a constexpr
function (<a href='dcl.constexpr'>[dcl.constexpr]</a>) that is being evaluated as part
of <span class='texttt'>e</span>;</li><li id='4.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.2'>(4.2)</a></div>an invocation of a non-constexpr function
<div id='4.2.note-1' class='note'>[&nbsp;<a class='note_link' href='#4.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> Overload resolution (<a href='over.match'>[over.match]</a>)
is applied as usual. —&nbsp;<i>end note</i></div>&nbsp;]</div> ;</li><li id='4.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.3'>(4.3)</a></div>an invocation of an undefined constexpr function;</li><li id='4.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.4'>(4.4)</a></div>an invocation of an instantiated constexpr function
that fails to satisfy the requirements
for a constexpr function;</li><li id='4.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.5'>(4.5)</a></div>an invocation of a virtual function (<a href='class.virtual'>[class.virtual]</a>)
for an object unless
  <ul class='itemize'><li id='4.5.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.5.1'>(4.5.1)</a></div>the object is usable in constant expressions or</li><li id='4.5.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.5.2'>(4.5.2)</a></div>its lifetime began within the evaluation of <span class='texttt'>e</span>;</li></ul></li><li id='4.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.6'>(4.6)</a></div>an expression that would exceed the implementation-defined
limits (see <a href='implimits'>[implimits]</a>);</li><li id='4.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.7'>(4.7)</a></div>an operation that would have undefined behavior
as specified in <a href='intro'>[intro]</a> through <a href='cpp'>[cpp]</a>
of this document <div id='4.7.note-2' class='note'>[&nbsp;<a class='note_link' href='#4.7.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> including,
for example, signed integer overflow (<a href='expr.prop'>[expr.prop]</a>), certain
pointer arithmetic (<a href='expr.add'>[expr.add]</a>), <a href='expr.mul'>division by
zero</a>, or certain <a href='expr.shift'>shift operations</a> —&nbsp;<i>end note</i></div>&nbsp;]</div> ;</li><li id='4.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.8'>(4.8)</a></div>an <a href='conv.lval'>lvalue-to-rvalue conversion</a> unless
it is applied to
<ul class='itemize'><li id='4.8.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.8.1'>(4.8.1)</a></div>a non-volatile glvalue that refers to an object that is
  usable in constant expressions, or</li><li id='4.8.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.8.2'>(4.8.2)</a></div>a non-volatile glvalue of literal type that refers to a non-volatile object
  whose lifetime began within the evaluation of <span class='texttt'>e</span>;</li></ul></li><li id='4.9'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.9'>(4.9)</a></div>an <a href='conv.lval'>lvalue-to-rvalue conversion</a>
that is applied to a glvalue
that refers to a non-active member of a union or a subobject thereof;</li><li id='4.10'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.10'>(4.10)</a></div>an lvalue-to-rvalue conversion that is applied to
an object with an indeterminate value (<a href='basic.indet'>[basic.indet]</a>);</li><li id='4.11'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.11'>(4.11)</a></div>an invocation of an implicitly-defined copy/move constructor or
copy/move assignment operator
for a union whose active member (if any) is mutable,
unless the lifetime of the union object began within the evaluation of <span class='texttt'>e</span>;</li><li id='4.12'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.12'>(4.12)</a></div>an <i ><a href='expr.prim.id#nt:id-expression'>id-expression</a></i> that refers to a variable or
data member of reference type
unless the reference has a preceding initialization and either
<ul class='itemize'><li id='4.12.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.12.1'>(4.12.1)</a></div>it is usable in constant expressions or</li><li id='4.12.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#4.12.2'>(4.12.2)</a></div>its lifetime began within the evaluation of <span class='texttt'>e</span>;</li></ul></li><li id='4.13'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.13'>(4.13)</a></div>in a <i ><a href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a></i>,
a reference to <span class='texttt'><span class='keyword'>this</span></span> or to a variable with
automatic storage duration defined outside that
<i ><a href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a></i>, where
the reference would be an <a href='basic.def.odr'>odr-use</a>;
<div id='4.13.example-1' class='example'>[&nbsp;<a class='example_link' href='#4.13.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> n <span class='operator'>=</span> <span class='literal'>0</span>;
  <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>int</span> i <span class='operator'>=</span> n;        <span class='comment'>// OK, <span class='tcode_in_codeblock'>n</span> is not odr-used here</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>int</span> j <span class='operator'>=</span> <span class='operator'>*</span><span class='operator'>&amp;</span>n;      <span class='comment'>// ill-formed, <span class='tcode_in_codeblock'>&amp;n</span> would be an odr-use of <span class='tcode_in_codeblock'>n</span></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> 
<div id='4.13.note-3' class='note'>[&nbsp;<a class='note_link' href='#4.13.note-3'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> If the odr-use occurs in an invocation
of a function call operator of a closure type,
it no longer refers to <span class='texttt'><span class='keyword'>this</span></span> or to an enclosing automatic variable
due to the transformation (<a href='expr.prim.lambda.capture'>[expr.prim.lambda.capture]</a>)
of the <i ><a href='expr.prim.id#nt:id-expression'>id-expression</a></i> into
an access of the corresponding data member. <div id='4.13.example-2' class='example'>[&nbsp;<a class='example_link' href='#4.13.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>auto</span> monad <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> v<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> v; <span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> bind <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> m<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> fvm<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> fvm<span class='parenthesis'>(</span>m<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>;

<span class='comment'>// OK to have captures to automatic objects created during constant expression evaluation.</span>
<span class='keyword'>static_assert</span><span class='parenthesis'>(</span>bind<span class='parenthesis'>(</span>monad<span class='parenthesis'>(</span><span class='literal'>2</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>monad<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> monad<span class='parenthesis'>(</span><span class='literal'>2</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </li><li id='4.14'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.14'>(4.14)</a></div>a conversion from type <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span><span class='operator'>*</span></span> to a pointer-to-object type;</li><li id='4.15'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.15'>(4.15)</a></div>a <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span></span> (<a href='expr.reinterpret.cast'>[expr.reinterpret.cast]</a>);</li><li id='4.16'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.16'>(4.16)</a></div>modification of an object (<a href='expr.ass'>[expr.ass]</a>, <a href='expr.post.incr'>[expr.post.incr]</a>,
<a href='expr.pre.incr'>[expr.pre.incr]</a>)
unless it is applied to a non-volatile lvalue of literal type
that refers to a non-volatile object
whose lifetime began within the evaluation of <span class='texttt'>e</span>;</li><li id='4.17'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.17'>(4.17)</a></div>a <i ><a href='expr.new#nt:new-expression'>new-expression</a></i> (<a href='expr.new'>[expr.new]</a>),
unless the selected allocation function is
a replaceable global allocation function (<a href='new.delete.single'>[new.delete.single]</a>,
<a href='new.delete.array'>[new.delete.array]</a>) and
the allocated storage is deallocated within the evaluation of <span class='texttt'>e</span>;</li><li id='4.18'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.18'>(4.18)</a></div>a <i ><a href='expr.delete#nt:delete-expression'>delete-expression</a></i> (<a href='expr.delete'>[expr.delete]</a>),
unless it deallocates a region of storage
allocated within the evaluation of <span class='texttt'>e</span>;</li><li id='4.19'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.19'>(4.19)</a></div>a call to an instance of
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>allocate</span> (<a href='allocator.members'>[allocator.members]</a>),
unless the allocated storage is deallocated within the evaluation of <span class='texttt'>e</span>;</li><li id='4.20'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.20'>(4.20)</a></div>a call to an instance of
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>deallocate</span> (<a href='allocator.members'>[allocator.members]</a>),
unless it deallocates a region of storage
allocated within the evaluation of <span class='texttt'>e</span>;</li><li id='4.21'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.21'>(4.21)</a></div>an <i ><a href='expr.await#nt:await-expression'>await-expression</a></i> (<a href='expr.await'>[expr.await]</a>);</li><li id='4.22'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.22'>(4.22)</a></div>a <i ><a href='expr.yield#nt:yield-expression'>yield-expression</a></i> (<a href='expr.yield'>[expr.yield]</a>);</li><li id='4.23'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.23'>(4.23)</a></div>a three-way comparison (<a href='expr.spaceship'>[expr.spaceship]</a>),
relational (<a href='expr.rel'>[expr.rel]</a>), or equality (<a href='expr.eq'>[expr.eq]</a>)
operator where the result is unspecified;</li><li id='4.24'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.24'>(4.24)</a></div>a <i ><a href='expr.throw#nt:throw-expression'>throw-expression</a></i> (<a href='expr.throw'>[expr.throw]</a>) or
a dynamic cast (<a href='expr.dynamic.cast'>[expr.dynamic.cast]</a>) or <span class='texttt'><span class='keyword'>typeid</span></span> (<a href='expr.typeid'>[expr.typeid]</a>) expression
that would throw an exception;</li><li id='4.25'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.25'>(4.25)</a></div>an <i ><a href='dcl.asm#nt:asm-declaration'>asm-declaration</a></i> (<a href='dcl.asm'>[dcl.asm]</a>); or</li><li id='4.26'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.26'>(4.26)</a></div>an invocation of the <span class='texttt'>va_&shy;arg</span> macro (<a href='cstdarg.syn'>[cstdarg.syn]</a>)<a class='hidden_link' href='#4.sentence-1'>.</a></li></ul></div><div id='4.sentence-2' class='sentence'>If <span class='texttt'>e</span> satisfies the constraints of a core constant expression, but
evaluation of <span class='texttt'>e</span> would evaluate an operation that has undefined behavior
as specified in <a href='library'>[library]</a> through <a href='thread'>[thread]</a> of this document, or
an invocation of the <span class='texttt'>va_&shy;start</span> macro (<a href='cstdarg.syn'>[cstdarg.syn]</a>),
it is unspecified whether <span class='texttt'>e</span> is a core constant expression<a class='hidden_link' href='#4.sentence-2'>.</a></div><div style='height:0.6em;display:block'></div><div id='4.example-3' class='example'>[&nbsp;<a class='example_link' href='#4.example-3'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> x;                              <span class='comment'>// not constant</span>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> A<span class='parenthesis'>(</span><span class='keyword'>bool</span> b<span class='parenthesis'>)</span> <span class='operator'>:</span> m<span class='parenthesis'>(</span>b<span class='operator'>?</span><span class='literal'>42</span><span class='operator'>:</span>x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
  <span class='keyword'>int</span> m;
<span class='curlybracket'>}</span>;
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> v <span class='operator'>=</span> A<span class='parenthesis'>(</span><span class='literal'>true</span><span class='parenthesis'>)</span><span class='operator'>.</span>m;        <span class='comment'>// OK: constructor call initializes <span class='tcode_in_codeblock'>m</span> with the value <span class='tcode_in_codeblock'>42</span></span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> w <span class='operator'>=</span> A<span class='parenthesis'>(</span><span class='literal'>false</span><span class='parenthesis'>)</span><span class='operator'>.</span>m;       <span class='comment'>// error: initializer for <span class='tcode_in_codeblock'>m</span> is <span class='tcode_in_codeblock'>x</span>, which is non-constant</span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f1<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>int</span> x <span class='operator'>=</span> k;              <span class='comment'>// error: <span class='tcode_in_codeblock'>x</span> is not initialized by a constant expression</span>
                                    <span class='comment'>// because lifetime of <span class='tcode_in_codeblock'>k</span> began outside the initializer of <span class='tcode_in_codeblock'>x</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f2<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> k;                        <span class='comment'>// OK: not required to be a constant expression</span>
                                    <span class='comment'>// because <span class='tcode_in_codeblock'>x</span> is not <span class='tcode_in_codeblock'>constexpr</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> incr<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>&amp;</span>n<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='operator'>+</span><span class='operator'>+</span>n;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> g<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>int</span> x <span class='operator'>=</span> incr<span class='parenthesis'>(</span>k<span class='parenthesis'>)</span>;        <span class='comment'>// error: <span class='tcode_in_codeblock'>incr(k)</span> is not a core constant expression</span>
                                    <span class='comment'>// because lifetime of <span class='tcode_in_codeblock'>k</span> began outside the expression <span class='tcode_in_codeblock'>incr(k)</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> h<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> incr<span class='parenthesis'>(</span>k<span class='parenthesis'>)</span>;                  <span class='comment'>// OK: <span class='tcode_in_codeblock'>incr(k)</span> is not required to be a core constant expression</span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> y <span class='operator'>=</span> h<span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>;             <span class='comment'>// OK: initializes <span class='tcode_in_codeblock'>y</span> with the value <span class='tcode_in_codeblock'>2</span></span>
                                    <span class='comment'>// <span class='tcode_in_codeblock'>h(1)</span> is a core constant expression because</span>
                                    <span class='comment'>// the lifetime of <span class='tcode_in_codeblock'>k</span> begins inside <span class='tcode_in_codeblock'>h(1)</span></span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7079'>#</a></div><div id='5.sentence-1' class='sentence'>For the purposes of determining
whether an expression is a core constant expression,
the evaluation of a call to a member function of <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span>
as defined in <a href='allocator.members'>[allocator.members]</a>, where <span class='texttt'>T</span> is a literal type,
does not disqualify the expression from being a core constant expression,
even if the actual evaluation of such a call
would otherwise fail the requirements for a core constant expression<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>Similarly, the evaluation of a call to
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>, or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>
is a valid core constant expression unless:
<ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.1'>(5.1)</a></div>for a call to <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span> or <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>,
  the first argument, of type <span class='texttt'>T<span class='operator'>*</span></span>,
  does not point to storage allocated with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> or
  the evaluation of the underlying constructor call
  is not a core constant expression, or</li><li id='5.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.2'>(5.2)</a></div>for a call to <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span> or <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
  the first argument, of type <span class='texttt'>T<span class='operator'>*</span></span>,
  does not point to storage allocated with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> or
  the evaluation of the underlying destructor call
  is not a core constant expression<a class='hidden_link' href='#5.sentence-2'>.</a></li></ul></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7108'>#</a></div><div id='6.sentence-1' class='sentence'>An object <span class='texttt'>a</span> is said to have <a class='hidden_link' href='#def:destruction,constant' id='def:destruction,constant'><i >constant destruction</i></a> if:
<ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.1'>(6.1)</a></div>it is not of class type nor (possibly multi-dimensional) array thereof, or</li><li id='6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.2'>(6.2)</a></div>it is of class type or (possibly multi-dimensional) array thereof,
  that class type has a constexpr destructor, and
  for a hypothetical expression <span class='texttt'>e</span>
  whose only effect is to destroy <span class='texttt'>a</span>,
  <span class='texttt'>e</span> would be a core constant expression
  if the lifetime of <span class='texttt'>a</span> and its non-mutable subobjects
  (but not its mutable subobjects) were considered to start within <span class='texttt'>e</span><a class='hidden_link' href='#6.sentence-1'>.</a></li></ul></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7123'>#</a></div><div id='7.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:expression,integral_constant' id='def:expression,integral_constant'><i >integral constant expression</i></a>
is an expression of integral or
unscoped enumeration type, implicitly converted to a prvalue, where the converted expression is a core constant expression<a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.note-1' class='note'>[&nbsp;<a class='note_link' href='#7.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='7.sentence-2' class='sentence'>Such expressions may be
used as <a href='class.bit'>bit-field</a> lengths, as enumerator
initializers if the underlying type is not fixed (<a href='dcl.enum'>[dcl.enum]</a>),
and as <a href='dcl.align'>alignments</a><a class='hidden_link' href='#7.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7134'>#</a></div><div id='8.sentence-1' class='sentence'>If an expression of literal class type is used in a context where an
integral constant expression is required, then that expression is
contextually implicitly converted (<a href='conv'>[conv]</a>) to an integral or unscoped
enumeration type
and the selected conversion function shall be <span class='texttt'><span class='keyword'>constexpr</span></span><a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='8.example-1' class='example'>[&nbsp;<a class='example_link' href='#8.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> A<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='operator'>:</span> val<span class='parenthesis'>(</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> val; <span class='curlybracket'>}</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> <span class='keyword'>long</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>42</span>; <span class='curlybracket'>}</span>
<span class='keyword'>private</span><span class='operator'>:</span>
  <span class='keyword'>int</span> val;
<span class='curlybracket'>}</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> X <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>constexpr</span> A a <span class='operator'>=</span> <span class='keyword'>alignof</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>;
<span class='keyword'>alignas</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='keyword'>int</span> n;               <span class='comment'>// error: ambiguous conversion</span>
<span class='keyword'>struct</span> B <span class='curlybracket'>{</span> <span class='keyword'>int</span> n <span class='operator'>:</span> a; <span class='curlybracket'>}</span>;        <span class='comment'>// error: ambiguous conversion</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7155'>#</a></div><div id='9.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:expression,converted_constant' id='def:expression,converted_constant'><i >converted constant expression</i></a>
of type <span class='texttt'>T</span> is an
expression, implicitly converted to type <span class='texttt'>T</span>, where
the converted expression is a constant expression and the
implicit conversion sequence contains only
<ul class='itemize'><li id='9.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.1'>(9.1)</a></div>user-defined conversions,</li><li id='9.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.2'>(9.2)</a></div><a href='conv.lval'>lvalue-to-rvalue conversions</a>,</li><li id='9.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.3'>(9.3)</a></div><a href='conv.array'>array-to-pointer conversions</a>,</li><li id='9.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.4'>(9.4)</a></div><a href='conv.func'>function-to-pointer conversions</a>,</li><li id='9.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.5'>(9.5)</a></div><a href='conv.qual'>qualification conversions</a>,</li><li id='9.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.6'>(9.6)</a></div><a href='conv.prom#def:integral_promotions'>integral promotions</a>,</li><li id='9.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.7'>(9.7)</a></div><a href='conv.integral'>integral conversions</a> other than
<a href='dcl.init.list#def:narrowing_conversion'>narrowing conversions</a>,</li><li id='9.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.8'>(9.8)</a></div><a href='conv.ptr#def:null_pointer_conversion'>null pointer conversions</a> from <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>nullptr_&shy;t</span>,</li><li id='9.9'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.9'>(9.9)</a></div><a href='conv.mem#def:null_member_pointer_conversion'>null member pointer conversions</a> from <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>nullptr_&shy;t</span>, and</li><li id='9.10'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#9.10'>(9.10)</a></div><a href='conv.fctptr'>function pointer conversions</a>,</li></ul>
and where the reference binding (if any) binds directly<a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='9.note-1' class='note'>[&nbsp;<a class='note_link' href='#9.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='9.sentence-2' class='sentence'>Such expressions may be used in <a href='expr.new'><span class='texttt'>new</span>
expressions</a>, as <a href='stmt.switch'>case expressions</a>,
as enumerator initializers if the underlying type is
<a href='dcl.enum#def:type,underlying,fixed'>fixed</a>, as <a href='dcl.array'>array</a> bounds, and
as non-type <a href='temp.arg'>template arguments</a><a class='hidden_link' href='#9.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='9.sentence-3' class='sentence'><span class='indexparent'><a class='index' id=':conversion,contextual_to_constant_expression_of_type_bool'></a></span>A <a class='hidden_link' href='#def:contextually_converted_constant_expression_of_type_bool' id='def:contextually_converted_constant_expression_of_type_bool'><i>contextually converted constant expression of type <span class='texttt'><span class='keyword'>bool</span></span></i></a> is
an expression, <a href='conv#def:conversion,contextual_to_bool'>contextually converted to <span class='texttt'>bool</span></a>,
where the converted expression is a constant expression and
the conversion sequence contains only the conversions above<a class='hidden_link' href='#9.sentence-3'>.</a></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7190'>#</a></div><div id='10.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:expression,constant' id='def:expression,constant'><i >constant expression</i></a> is either
a glvalue core constant expression that refers to
an entity that is a permitted result of a constant expression (as defined below), or
a prvalue core constant expression whose value
satisfies the following constraints:
<ul class='itemize'><li id='10.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.1'>(10.1)</a></div>if the value is an object of class type,
  each non-static data member of reference type refers to
  an entity that is a permitted result of a constant expression,</li><li id='10.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.2'>(10.2)</a></div>if the value is of pointer type, it contains
  the address of an object with static storage duration,
  the address past the end of such an object (<a href='expr.add'>[expr.add]</a>),
  the address of a non-immediate function,
  or a null pointer value,</li><li id='10.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.3'>(10.3)</a></div>if the value is of pointer-to-member-function type,
  it does not designate an immediate function, and</li><li id='10.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.4'>(10.4)</a></div>if the value is an object of class or array type,
  each subobject satisfies these constraints for the value<a class='hidden_link' href='#10.sentence-1'>.</a></li></ul></div> <div id='10.sentence-2' class='sentence'>
An entity is a
<a class='hidden_link' href='#def:constant_expression,permitted_result_of' id='def:constant_expression,permitted_result_of'><i >permitted result of a constant expression</i></a>
if it is an
object with static storage duration that either is not a temporary object or is
a temporary object whose value satisfies the above constraints, or if
it is a non-immediate function<a class='hidden_link' href='#10.sentence-2'>.</a></div> <div id='10.example-1' class='example'>[&nbsp;<a class='example_link' href='#10.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>consteval</span> <span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>42</span>; <span class='curlybracket'>}</span>
<span class='keyword'>consteval</span> <span class='keyword'>auto</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> f; <span class='curlybracket'>}</span>
<span class='keyword'>consteval</span> <span class='keyword'>int</span> h<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='parenthesis'>(</span><span class='operator'>*</span>p<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> p<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> r <span class='operator'>=</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                          <span class='comment'>// OK</span>
<span class='keyword'>constexpr</span> <span class='keyword'>auto</span> e <span class='operator'>=</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// ill-formed: a pointer to an immediate function is</span>
                                                <span class='comment'>// not a permitted result of a constant expression</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7233'>#</a></div><div id='11.note-1' class='note'>[&nbsp;<a class='note_link' href='#11.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='11.sentence-1' class='sentence'>Since this document
imposes no restrictions on the accuracy of floating-point operations, it is unspecified whether the
evaluation of a floating-point expression during translation yields the same result as the
evaluation of the same expression (or the same operations on the same values) during program
execution<a class='hidden_link' href='#11.sentence-1'>.</a><a class='footnotenum' href='#footnote-80' id='footnoteref-80'>80</a></div>  <div id='11.example-1' class='example'>[&nbsp;<a class='example_link' href='#11.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>bool</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>char</span> array<span class='squarebracket'>[</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='literal'>0.2</span> <span class='operator'>-</span> <span class='literal'>0.1</span> <span class='operator'>-</span> <span class='literal'>0.1</span><span class='parenthesis'>)</span><span class='squarebracket'>]</span>;   <span class='comment'>// Must be evaluated during translation</span>
    <span class='keyword'>int</span> size <span class='operator'>=</span> <span class='literal'>1</span> <span class='operator'>+</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='literal'>0.2</span> <span class='operator'>-</span> <span class='literal'>0.1</span> <span class='operator'>-</span> <span class='literal'>0.1</span><span class='parenthesis'>)</span>;    <span class='comment'>// May be evaluated at runtime</span>
    <span class='keyword'>return</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>array<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> size;
<span class='curlybracket'>}</span>
</pre> <div id='11.sentence-2' class='sentence'>
It is unspecified whether the value of <span class='texttt'>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> will be <span class='texttt'><span class='literal'>true</span></span> or <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#11.sentence-2'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7251'>#</a></div><div id='12.sentence-1' class='sentence'>An expression or conversion is in an <a class='hidden_link' href='#def:immediate_function_context' id='def:immediate_function_context'><i >immediate function context</i></a>
if it is potentially evaluated and
its innermost non-block scope is
a function parameter scope of an immediate function<a class='hidden_link' href='#12.sentence-1'>.</a></div> <div id='12.sentence-2' class='sentence'>An expression or conversion is an <a class='hidden_link' href='#def:immediate_invocation' id='def:immediate_invocation'><i >immediate invocation</i></a>
if it is an explicit or implicit invocation of an immediate function and
is not in an immediate function context<a class='hidden_link' href='#12.sentence-2'>.</a></div> <div id='12.sentence-3' class='sentence'>An immediate invocation shall be a constant expression<a class='hidden_link' href='#12.sentence-3'>.</a></div> <div id='12.note-1' class='note'>[&nbsp;<a class='note_link' href='#12.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='12.sentence-4' class='sentence'>An immediate invocation is evaluated even in an unevaluated operand<a class='hidden_link' href='#12.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7264'>#</a></div><div id='13.sentence-1' class='sentence'>An expression or conversion <span class='texttt'>e</span> is <a class='hidden_link' href='#def:manifestly_constant-evaluated' id='def:manifestly_constant-evaluated'><i >manifestly constant-evaluated</i></a>
if it is:
<ul class='itemize'><li id='13.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#13.1'>(13.1)</a></div>a <i ><a href='#nt:constant-expression'>constant-expression</a></i>, or</li><li id='13.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#13.2'>(13.2)</a></div>the condition of a constexpr if statement (<a href='stmt.if'>[stmt.if]</a>), or</li><li id='13.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#13.3'>(13.3)</a></div>an immediate invocation, or</li><li id='13.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#13.4'>(13.4)</a></div>a <i ><a href='temp.constr.decl#nt:constraint-expression'>constraint-expression</a></i> (<a href='temp.constr.decl'>[temp.constr.decl]</a>)
including one formed from the <i ><a href='temp#nt:constraint-logical-or-expression'>constraint-logical-or-expression</a></i>
of a <i ><a href='temp#nt:requires-clause'>requires-clause</a></i>, or</li><li id='13.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#13.5'>(13.5)</a></div>the initializer of a variable
that is usable in constant expressions or
has constant initialization<a class='hidden_link' href='#13.sentence-1'>.</a><a class='footnotenum' href='#footnote-81' id='footnoteref-81'>81</a> <div id='13.5.example-1' class='example'>[&nbsp;<a class='example_link' href='#13.5.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> X <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
X<span class='anglebracket'>&lt;</span>std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span> x;                      <span class='comment'>// type <span class='tcode_in_codeblock'>X&lt;true&gt;</span></span>
<span class='keyword'>int</span> y;
<span class='keyword'>const</span> <span class='keyword'>int</span> a <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> y <span class='operator'>:</span> <span class='literal'>1</span>;     <span class='comment'>// dynamic initialization to 1</span>
<span class='keyword'>double</span> z<span class='squarebracket'>[</span>a<span class='squarebracket'>]</span>;                                            <span class='comment'>// ill-formed: <span class='tcode_in_codeblock'>a</span> is not usable</span>
                                                        <span class='comment'>// in constant expressions</span>
<span class='keyword'>const</span> <span class='keyword'>int</span> b <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>2</span> <span class='operator'>:</span> y;     <span class='comment'>// static initialization to 2</span>
<span class='keyword'>int</span> c <span class='operator'>=</span> y <span class='operator'>+</span> <span class='parenthesis'>(</span>std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>2</span> <span class='operator'>:</span> y<span class='parenthesis'>)</span>;     <span class='comment'>// dynamic initialization to <span class='tcode_in_codeblock'>y+y</span></span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> n <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>13</span> <span class='operator'>:</span> <span class='literal'>17</span>; <span class='comment'>// <span class='tcode_in_codeblock'>n</span> is 13</span>
  <span class='keyword'>int</span> m <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>13</span> <span class='operator'>:</span> <span class='literal'>17</span>;       <span class='comment'>// <span class='tcode_in_codeblock'>m</span> might be 13 or 17 (see below)</span>
  <span class='keyword'>char</span> arr<span class='squarebracket'>[</span>n<span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='comment'>// char[13]</span>
  <span class='keyword'>return</span> m <span class='operator'>+</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>arr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>int</span> p <span class='operator'>=</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                                            <span class='comment'>// <span class='tcode_in_codeblock'>m</span> is 13; initialized to 26</span>
<span class='keyword'>int</span> q <span class='operator'>=</span> p <span class='operator'>+</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                                        <span class='comment'>// <span class='tcode_in_codeblock'>m</span> is 17 for this call; initialized to 56</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </li></ul></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/63928eee09bc0b1adddd10b1781d139eb60628c0/source/expressions.tex#L7301'>#</a></div><div id='14.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':expression,potentially_constant_evaluated'></a></span>An expression or conversion is <a class='hidden_link' href='#def:potentially_constant_evaluated' id='def:potentially_constant_evaluated'><i >potentially constant evaluated</i></a>
if it is:</div><ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.1'>(14.1)</a></div><div id='14.1.sentence-1' class='sentence'>a manifestly constant-evaluated expression,</div></li><li id='14.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.2'>(14.2)</a></div><div id='14.2.sentence-1' class='sentence'>a potentially-evaluated expression (<a href='basic.def.odr'>[basic.def.odr]</a>),</div></li><li id='14.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.3'>(14.3)</a></div><div id='14.3.sentence-1' class='sentence'>an immediate subexpression of a <i ><a href='dcl.init#nt:braced-init-list'>braced-init-list</a></i>,<a class='footnotenum' href='#footnote-82' id='footnoteref-82'>82</a></div></li><li id='14.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.4'>(14.4)</a></div><div id='14.4.sentence-1' class='sentence'>an expression of the form <span class='texttt'><span class='operator'>&amp;</span></span> <i ><a href='expr.cast#nt:cast-expression'>cast-expression</a></i>
that occurs within a templated entity,<a class='footnotenum' href='#footnote-83' id='footnoteref-83'>83</a>
or</div></li><li id='14.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.5'>(14.5)</a></div><div id='14.5.sentence-1' class='sentence'>a subexpression of one of the above
that is not a subexpression of a nested unevaluated operand<a class='hidden_link' href='#14.5.sentence-1'>.</a></div></li></ul><div id='14.sentence-2' class='sentence'><span class='indexparent'><a class='index' id=':function,needed_for_constant_evaluation'></a></span><span class='indexparent'><a class='index' id=':variable,needed_for_constant_evaluation'></a></span>A function or variable is
<a class='hidden_link' href='#def:needed_for_constant_evaluation' id='def:needed_for_constant_evaluation'><i >needed for constant evaluation</i></a>
if it is:</div><ul class='itemize'><li id='14.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.6'>(14.6)</a></div><div id='14.6.sentence-1' class='sentence'>a constexpr function that is named by an expression (<a href='basic.def.odr'>[basic.def.odr]</a>)
that is potentially constant evaluated, or</div></li><li id='14.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.7'>(14.7)</a></div><div id='14.7.sentence-1' class='sentence'>a variable whose name appears as a potentially constant evaluated expression
that is either a constexpr variable or
is of non-volatile const-qualified integral type or of reference type<a class='hidden_link' href='#14.7.sentence-1'>.</a></div></li></ul><div id='14.example-1' class='example'>[&nbsp;<a class='example_link' href='#14.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> N <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> N<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  N<span class='parenthesis'>(</span>N <span class='keyword'>const</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>constexpr</span> <span class='keyword'>void</span> bad_assert_copyable<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> T t; T t2 <span class='operator'>=</span> t; <span class='curlybracket'>}</span>
<span class='keyword'>using</span> ineffective <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>bad_assert_copyable<span class='anglebracket'>&lt;</span>N<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
                        <span class='comment'>// <span class='tcode_in_codeblock'>bad_&shy;assert_&shy;copyable&lt;N&gt;</span> is not needed for constant evaluation</span>
                        <span class='comment'>// (and thus not instantiated)</span>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> assert_copyable<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> T t; T t2 <span class='operator'>=</span> t; <span class='curlybracket'>}</span>
<span class='keyword'>using</span> check <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>assert_copyable<span class='anglebracket'>&lt;</span>N<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
                        <span class='comment'>// error: <span class='tcode_in_codeblock'>assert_&shy;copyable&lt;N&gt;</span> is instantiated (because it is needed for constant</span>
                        <span class='comment'>// evaluation), but the attempt to copy <span class='tcode_in_codeblock'>t</span> is ill-formed</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='footnote' id='footnote-80'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-80'>80)</a></div><div id='footnote-80.sentence-1' class='sentence'>Nonetheless, implementations should provide consistent results,
irrespective of whether the evaluation was performed during translation and/or during program
execution<a class='hidden_link' href='#footnote-80.sentence-1'>.</a></div> <a href='#footnoteref-80'>⮥</a></div><div class='footnote' id='footnote-81'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-81'>81)</a></div><div id='footnote-81.sentence-1' class='sentence'>Testing this condition
may involve a trial evaluation of its initializer as described above<a class='hidden_link' href='#footnote-81.sentence-1'>.</a></div> <a href='#footnoteref-81'>⮥</a></div><div class='footnote' id='footnote-82'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-82'>82)</a></div><div id='footnote-82.sentence-1' class='sentence'>Constant evaluation may be necessary to determine whether a narrowing conversion is performed (<a href='dcl.init.list'>[dcl.init.list]</a>)<a class='hidden_link' href='#footnote-82.sentence-1'>.</a></div> <a href='#footnoteref-82'>⮥</a></div><div class='footnote' id='footnote-83'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-83'>83)</a></div><div id='footnote-83.sentence-1' class='sentence'>Constant evaluation may be necessary to determine whether such an expression is value-dependent (<a href='temp.dep.constexpr'>[temp.dep.constexpr]</a>)<a class='hidden_link' href='#footnote-83.sentence-1'>.</a></div> <a href='#footnoteref-83'>⮥</a></div></div></body></html>