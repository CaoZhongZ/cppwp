<!DOCTYPE html><html lang='en'><head><title>[basic.stc.dynamic.allocation]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>6</a> Basics <a class='abbr_ref' href='./#basic'>[basic]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>6.6</a> Memory and objects <a class='abbr_ref' href='basic.memobj#basic.stc.dynamic.allocation'>[basic.memobj]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>6.6.4</a> Storage duration <a class='abbr_ref' href='basic.stc#dynamic.allocation'>[basic.stc]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>6.6.4.4</a> Dynamic storage duration <a class='abbr_ref' href='basic.stc.dynamic#allocation'>[basic.stc.dynamic]</a></h4><h4 ><a class='secnum' style='min-width:133pt'>6.6.4.4.1</a> Allocation functions <a class='abbr_ref'>[basic.stc.dynamic.allocation]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/04eb7aa1d517df2712d1298ed7551ebb77523483/source/basic.tex#L3244'>#</a></div><div id='1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':function,allocation'></a></span>An allocation function shall be a class member function or a global
function; a program is ill-formed if an allocation function is declared
in a namespace scope other than global scope or declared static in
global scope<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>The return type shall be <span class='texttt'>void*</span><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>The first
parameter shall have type <span class='texttt'>std&#x200b;::&#x200b;size_&shy;t</span> (<a href='support.types'>[support.types]</a>)<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>The
first parameter shall not have an associated default
argument (<a href='dcl.fct.default'>[dcl.fct.default]</a>)<a class='hidden_link' href='#1.sentence-4'>.</a></div> <div id='1.sentence-5' class='sentence'>The value of the first parameter
is interpreted as the requested size of the allocation<a class='hidden_link' href='#1.sentence-5'>.</a></div> <div id='1.sentence-6' class='sentence'>An allocation
function can be a function template<a class='hidden_link' href='#1.sentence-6'>.</a></div> <div id='1.sentence-7' class='sentence'>Such a template shall declare its
return type and first parameter as specified above (that is, template
parameter types shall not be used in the return type and first parameter
type)<a class='hidden_link' href='#1.sentence-7'>.</a></div> <div id='1.sentence-8' class='sentence'>Template allocation functions shall have two or more parameters<a class='hidden_link' href='#1.sentence-8'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/04eb7aa1d517df2712d1298ed7551ebb77523483/source/basic.tex#L3259'>#</a></div><div id='2.sentence-1' class='sentence'>An allocation function attempts to allocate the requested amount of
storage<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>If it is successful, it returns the address of the start
of a block of storage whose length in bytes is at least as large
as the requested size<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>The order,
contiguity, and initial value of storage allocated by successive calls
to an allocation function are unspecified<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>For an allocation function other than
a reserved placement allocation function (<a href='new.delete.placement'>[new.delete.placement]</a>),
the pointer returned is
suitably aligned so that it can be converted to a pointer to any
suitable complete object type (<a href='new.delete.single'>[new.delete.single]</a>)
and then used to access the object or array in the
storage allocated (until the storage is explicitly deallocated by a call
to a corresponding deallocation function)<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>Even if the size of the space
requested is zero, the request can fail<a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'>If the request succeeds, the
value returned by a replaceable allocation function
is a non-null pointer value (<a href='conv.ptr'>[conv.ptr]</a>)
<span class='texttt'>p0</span> different from any previously returned value <span class='texttt'>p1</span>,
unless that value <span class='texttt'>p1</span> was subsequently passed to a
replaceable deallocation function<a class='hidden_link' href='#2.sentence-6'>.</a></div> <div id='2.sentence-7' class='sentence'>Furthermore, for the library allocation functions
in <a href='new.delete.single'>[new.delete.single]</a> and <a href='new.delete.array'>[new.delete.array]</a>,
<span class='texttt'>p0</span> represents the address of a block of storage disjoint from the storage
for any other object accessible to the caller<a class='hidden_link' href='#2.sentence-7'>.</a></div> <div id='2.sentence-8' class='sentence'>The effect of indirecting through a pointer
returned from a request for zero size is undefined<a class='hidden_link' href='#2.sentence-8'>.</a><a class='footnotenum' href='#footnote-36'>36</a></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/04eb7aa1d517df2712d1298ed7551ebb77523483/source/basic.tex#L3292'>#</a></div><div id='3.sentence-1' class='sentence'>An allocation function that fails to allocate storage can invoke the
currently installed new-handler function (<a href='new.handler'>[new.handler]</a>), if any<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-4' class='sentence'><span class='indexparent'><a class='index' id=':new_handler'></a></span>A program-supplied allocation function can obtain the address of the
currently installed <span class='texttt'>new_&shy;handler</span> using the
<span class='texttt'>std&#x200b;::&#x200b;get_&shy;new_&shy;handler</span> function (<a href='set.new.handler'>[set.new.handler]</a>)<a class='hidden_link' href='#3.sentence-4'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div>  <div id='3.sentence-2' class='sentence'>
An allocation function that has a non-throwing
exception specification (<a href='except.spec'>[except.spec]</a>)
indicates failure by returning
a null pointer value<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>Any other allocation function
never returns a null pointer value and
indicates failure only by throwing an exception (<a href='except.throw'>[except.throw]</a>) of a type
that would match a handler (<a href='except.handle'>[except.handle]</a>) of type
<span class='texttt'>std&#x200b;::&#x200b;bad_&shy;alloc</span> (<a href='bad.alloc'>[bad.alloc]</a>)<a class='hidden_link' href='#3.sentence-3'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/04eb7aa1d517df2712d1298ed7551ebb77523483/source/basic.tex#L3310'>#</a></div><div id='4.sentence-1' class='sentence'>A global allocation function is only called as the result of a <a href='expr.new'>new
expression</a>, or called directly using the <a href='expr.call'>function call</a>
syntax, or called indirectly through calls to the
functions in the C++ standard library<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='4.sentence-2' class='sentence'>In particular, a
global allocation function is not called to allocate storage for objects
with <a href='basic.stc.static'>static storage duration</a>, for objects or references
with <a href='basic.stc.thread'>thread storage duration</a>, for objects of
type <a href='expr.typeid'><span class='texttt'>std&#x200b;::&#x200b;type_&shy;info</span></a>, or for an
<a href='except.throw'>exception object</a><a class='hidden_link' href='#4.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='footnote' id='footnote-36'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-36'>36)</a></div><div id='footnote-36.sentence-1' class='sentence'>The intent is
to have <span class='texttt'>operator new()</span> implementable by
calling <span class='texttt'>std&#x200b;::&#x200b;malloc()</span> or <span class='texttt'>std&#x200b;::&#x200b;calloc()</span>, so the rules are
substantially the same<a class='hidden_link' href='#footnote-36.sentence-1'>.</a></div> <div id='footnote-36.sentence-2' class='sentence'>C++ differs from C in requiring a zero request
to return a non-null pointer<a class='hidden_link' href='#footnote-36.sentence-2'>.</a></div></div></div></body></html>